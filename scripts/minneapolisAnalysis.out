
R version 4.5.0 (2025-04-11) -- "How About a Twenty-Six"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # minneapolisAnalysis.R
> # Analyze the ppsf slope in sf and infill, as in Vancouver
> # Tom Davidoff
> # Adapted from Portland code for Minneapolis 2040 analysis
> 
> library(data.table)
> library(fixest)
> library(ggplot2)
> library(xtable)
> 
> # 1. Load ------------------------------------------------------------------
> permits <- readRDS("~/OneDrive - UBC/dataProcessed/minneapolis_zip_propensity.rds")
> slopes  <- readRDS("~/OneDrive - UBC/dataProcessed/minneapolis_attom_slopes_by_zip.rds")
> 
> setDT(permits); setDT(slopes)
> 
> 
> 
> # 2. Align -----------------------------------------------------------------
> # Ensure ZIPs are 5-character strings and types match
> print(head(permits))
   geo_id land_use_c  geo_name infill_lot_count total_lots_active total_units
   <char>     <char>    <char>            <int>             <int>       <num>
1:  55411        UN2 ZIP 55411               14                94         227
2:  55410        UN1 ZIP 55410               10                56          65
3:  55414        UN2 ZIP 55414               39                41          98
4:  55406        UN2 ZIP 55406                9                34          48
5:  55405        UN2 ZIP 55405               23                32          72
6:  55412        UN1 ZIP 55412                2                29          32
   propensity
        <num>
1: 0.14893617
2: 0.17857143
3: 0.95121951
4: 0.26470588
5: 0.71875000
6: 0.06896552
> print(head(slopes))
      zip      slope     N mean_ppsf
   <char>      <num> <int>     <num>
1:  55412 -0.6169026  1245  157.8467
2:  55422 -0.3313725  1125  203.3167
3:  55406 -0.5471409   936  246.6931
4:  55430 -0.6420519   900  178.3547
5:  55418 -0.5045785   898  224.6673
6:  55423 -0.6410559   884  226.4542
> 
> 
> setnames(permits, "geo_id", "zip")
> permits[, zip := sprintf("%05s", as.character(zip))]
> slopes[,  zip := sprintf("%05s", as.character(zip))]
> 
> # Merge on Zip
> dt <- merge(permits, slopes, by = "zip")
> print(head(dt))
Key: <zip>
      zip land_use_c  geo_name infill_lot_count total_lots_active total_units
   <char>     <char>    <char>            <int>             <int>       <num>
1:  55403        UN2 ZIP 55403                1                 2           4
2:  55404        UN2 ZIP 55404                3                 7          18
3:  55404        UN3 ZIP 55404                1                 1           4
4:  55405        UN2 ZIP 55405               23                32          72
5:  55405        UN1 ZIP 55405                0                 1           1
6:  55405        UN3 ZIP 55405                1                 1         100
   propensity        slope     N mean_ppsf
        <num>        <num> <int>     <num>
1:  0.5000000 -0.342384139    26  334.5986
2:  0.4285714 -0.499871340    69  173.5262
3:  1.0000000 -0.499871340    69  173.5262
4:  0.7187500  0.006914055   156  248.4731
5:  0.0000000  0.006914055   156  248.4731
6:  1.0000000  0.006914055   156  248.4731
> print(summary(dt))
     zip             land_use_c          geo_name         infill_lot_count
 Length:41          Length:41          Length:41          Min.   : 0.00   
 Class :character   Class :character   Class :character   1st Qu.: 1.00   
 Mode  :character   Mode  :character   Mode  :character   Median : 3.00   
                                                          Mean   : 4.78   
                                                          3rd Qu.: 6.00   
                                                          Max.   :39.00   
 total_lots_active  total_units       propensity         slope          
 Min.   : 1.00     Min.   :  1.00   Min.   :0.0000   Min.   :-0.724817  
 1st Qu.: 3.00     1st Qu.: 11.00   1st Qu.:0.2000   1st Qu.:-0.547141  
 Median : 5.00     Median : 32.00   Median :0.5000   Median :-0.352628  
 Mean   :12.37     Mean   : 53.95   Mean   :0.5113   Mean   :-0.394526  
 3rd Qu.:12.00     3rd Qu.: 85.00   3rd Qu.:0.7778   3rd Qu.:-0.256443  
 Max.   :94.00     Max.   :227.00   Max.   :1.0000   Max.   : 0.006914  
       N            mean_ppsf    
 Min.   :  26.0   Min.   :138.5  
 1st Qu.: 156.0   1st Qu.:221.4  
 Median : 600.0   Median :224.7  
 Mean   : 527.7   Mean   :237.3  
 3rd Qu.: 847.0   3rd Qu.:249.5  
 Max.   :1245.0   Max.   :355.8  
> 
> # 3. Clean -----------------------------------------------------------------
> # Convert slope to numeric (it was <char>) and take absolute value
> # (A larger negative slope = a steeper 'size discount')
> dt[, price_level := as.numeric(mean_ppsf)]
> 
> # Focus on Zips with enough data to be credible
> MINOBS <- 2
> dt <- dt[N >= MINOBS & total_lots_active >= MINOBS]
> 
> dtCensus <- fread("~/OneDrive - UBC/dataRaw/ACSDT5Y2024/ACSDT5Y2024.B19013-Data.csv", skip=1,select = c("Estimate!!Median household income in the past 12 months (in 2024 inflation-adjusted dollars)","Geographic Area Name"),header=TRUE)
> print(head(dtCensus))
   Estimate!!Median household income in the past 12 months (in 2024 inflation-adjusted dollars)
                                                                                         <char>
1:                                                                                        19454
2:                                                                                        21420
3:                                                                                        20933
4:                                                                                        20992
5:                                                                                        24496
6:                                                                                        20360
   Geographic Area Name
                 <char>
1:          ZCTA5 00601
2:          ZCTA5 00602
3:          ZCTA5 00603
4:          ZCTA5 00606
5:          ZCTA5 00610
6:          ZCTA5 00611
> setnames(dtCensus, old=c("Estimate!!Median household income in the past 12 months (in 2024 inflation-adjusted dollars)"), new=c("medianIncome"))
> dtCensus[, medianIncome := log(as.numeric(medianIncome))]
Warning message:
In eval(jsub, SDenv, parent.frame()) : NAs introduced by coercion
> setnames(dtCensus,"Geographic Area Name","zip")
> dtCensus[,zip:=substring(zip,7,11)]
> dt <- merge(dt,dtCensus,by="zip")
> print(table(dt[,land_use_c]))

UN1 UN2 UN3 
  9  14  11 
> 
> print(xtable(cor(dt[, .(slope, price_level, propensity,medianIncome)])))
% latex table generated in R 4.5.0 by xtable 1.8-4 package
% Wed Feb 11 20:12:09 2026
\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & slope & price\_level & propensity & medianIncome \\ 
  \hline
slope & 1.00 & 0.59 & 0.28 & 0.30 \\ 
  price\_level & 0.59 & 1.00 & 0.03 & 0.69 \\ 
  propensity & 0.28 & 0.03 & 1.00 & -0.14 \\ 
  medianIncome & 0.30 & 0.69 & -0.14 & 1.00 \\ 
   \hline
\end{tabular}
\end{table}
> print(xtable(cor(dt[land_use_c=="UN3", .(slope, price_level, propensity,medianIncome)])))
% latex table generated in R 4.5.0 by xtable 1.8-4 package
% Wed Feb 11 20:12:09 2026
\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & slope & price\_level & propensity & medianIncome \\ 
  \hline
slope & 1.00 & 0.61 & 0.32 & 0.31 \\ 
  price\_level & 0.61 & 1.00 & 0.24 & 0.82 \\ 
  propensity & 0.32 & 0.24 & 1.00 & 0.01 \\ 
  medianIncome & 0.31 & 0.82 & 0.01 & 1.00 \\ 
   \hline
\end{tabular}
\end{table}
> print(xtable(cor(dt[land_use_c!="UN3", .(slope, price_level, propensity,medianIncome)])))
% latex table generated in R 4.5.0 by xtable 1.8-4 package
% Wed Feb 11 20:12:09 2026
\begin{table}[ht]
\centering
\begin{tabular}{rrrrr}
  \hline
 & slope & price\_level & propensity & medianIncome \\ 
  \hline
slope & 1.00 & 0.58 & 0.36 & 0.29 \\ 
  price\_level & 0.58 & 1.00 & -0.05 & 0.64 \\ 
  propensity & 0.36 & -0.05 & 1.00 & -0.30 \\ 
  medianIncome & 0.29 & 0.64 & -0.30 & 1.00 \\ 
   \hline
\end{tabular}
\end{table}
> 
> 
> # 4. Model -----------------------------------------------------------------
> # Does the price-size gradient predict development propensity?
> # we use robust standard errors (hc1)
> m1 <- feols(propensity ~ slope, dt, vcov = "hc1")
> m2 <- feols(propensity ~ slope + price_level, dt, vcov = "hc1")
> m3 <- feols(propensity ~ price_level, dt, vcov = "hc1")
> m4 <- feols(propensity ~ price_level + medianIncome, dt, vcov = "hc1")
> 
> # Zen summary: No complex tables, just the facts
> print(etable(m1, m2, m3,m4))
                                m1               m2               m3
Dependent Var.:         propensity       propensity       propensity
                                                                    
Constant        0.7264*** (0.1301) 1.095** (0.3793) 0.4831. (0.2700)
slope              0.4812 (0.2928) 0.6878. (0.3424)                 
price_level                        -0.0012 (0.0012)  0.0002 (0.0011)
medianIncome                                                        
_______________ __________________ ________________ ________________
S.E. type       Heteroskedas.-rob. Heterosked.-rob. Heterosked.-rob.
Observations                    34               34               34
R2                         0.08065          0.10846          0.00109
Adj. R2                    0.05192          0.05094         -0.03013

                              m4
Dependent Var.:       propensity
                                
Constant           3.585 (2.350)
slope                           
price_level      0.0014 (0.0014)
medianIncome    -0.2982 (0.2224)
_______________ ________________
S.E. type       Heterosked.-rob.
Observations                  34
R2                       0.05105
Adj. R2                 -0.01017
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> # 5. Plot ------------------------------------------------------------------
> ggplot(dt, aes(slope, propensity)) +
+   geom_point(alpha = 0.5) +
+   geom_smooth(method = "lm", color = "black", fill = "gray80") +
+   theme_minimal() +
+   labs(x = "Price-Size Gradient (Absolute)", 
+        y = "Permit Propensity",
+        title = "Minneapolis Supply Response")
`geom_smooth()` using formula = 'y ~ x'
> 
> ggsave("~/OneDrive - UBC/dataProcessed/minneapolis_supply_response.png", 
+        width = 8, height = 6)
`geom_smooth()` using formula = 'y ~ x'
> 
> # 6. Export ----------------------------------------------------------------
> saveRDS(dt, "~/OneDrive - UBC/dataProcessed/minneapolis_analysis_final.rds")
> 
> proc.time()
   user  system elapsed 
  1.420   0.315   0.888 
