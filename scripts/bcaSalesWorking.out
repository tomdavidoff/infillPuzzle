
R version 4.5.0 (2025-04-11) -- "How About a Twenty-Six"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # bcaSales.R
> # R to use 2019 sales to get census-tract level coefficients on duplex vs single family and also square footage coefficients on ppsf
> # Tom Davidoff
> # 01/14/26
> 
> # strategy:
> # Get 2026 roll centroids, merge on roll/1000 (for subdivisions), confirm coverage for 2019 sales data (through 2018)
> # merge with census tract centroids
> # Regress coefficients, etc.
> 
> library(data.table)
> library(sf)
Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE
> library(RSQLite)
> library(fixest)
> library(ggplot2)
> library(scales)

Attaching package: ‘scales’

The following object is masked from ‘package:fixest’:

    pvalue

> library(stringr)
> library(readxl)
> library(geosphere)
> library(nnet)
> 
> # per google
> latDowntown <- 49.2827
> lonDowntown <- -123.1207
> WIDTHTOL <- .10
> MAXAGE <- 25
> MINOBS <- 20
> 
> centroidsFile <- "~/OneDrive - UBC/dataProcessed/bca25Centroids.rds"
> print(centroidsFile)
[1] "~/OneDrive - UBC/dataProcessed/bca25Centroids.rds"
> print(file.exists(centroidsFile))
[1] TRUE
> if (!file.exists(centroidsFile)) {
+   source("scripts/getBCAVancouverCentroids.R")
+ }
> dtCentroids <- readRDS(centroidsFile)
> # add to data.table
> 
> dtInventory <- fread("~/OneDrive\ -\ UBC/Documents/data/bca/Residential_inventory_202501/20250101_A09_Residential_Inventory_Extract.txt",select=c("Roll_Number","MB_Total_Finished_Area","Zoning","Land_Width_Width","Land_Depth_Depth","MB_Effective_Year"),colClasses=c(Roll_Number="character",MB_Total_Finished_Area="numeric",Zoning="character",Land_Width_Width="numeric",Land_Depth_Depth="numeric"))
> print(head(dtInventory))
       Roll_Number MB_Total_Finished_Area Zoning Land_Width_Width
            <char>                  <num> <char>            <num>
1: 001019632060000                  11895   R1-1               NA
2: 001019632290000                   7760   R1-1              195
3: 001019632450000                   3215   R1-1              150
4: 001019632650000                   8673   R1-1              150
5: 001019632760000                   2942   R1-1              170
6: 001019635070000                   4739   R1-1              170
   Land_Depth_Depth MB_Effective_Year
              <num>             <int>
1:                0              2020
2:              252              1997
3:              250              1945
4:              250              2011
5:              215              2022
6:              219              1995
> dtSales <- fread("~/OneDrive\ -\ UBC/Documents/data/bca/data_advice_REVD25_20250331/bca_folio_sales_20250331_REVD25.csv",select=c("ROLL_NUMBER","FOLIO_ID","CONVEYANCE_DATE","CONVEYANCE_PRICE","CONVEYANCE_TYPE_DESCRIPTION"))
> dtSales <- dtSales[CONVEYANCE_TYPE_DESCRIPTION=="Improved Single Property Transaction"]
> dtSales[,saleYear:=as.numeric(substring(CONVEYANCE_DATE,1,4))]
> print(head(dtSales))
       ROLL_NUMBER   FOLIO_ID CONVEYANCE_DATE CONVEYANCE_PRICE
            <char>     <char>           <i64>            <int>
1: 001029650840000 A000000045  20080415000000          2775000
2: 001029650840000 A000000045  19880830000000           570000
3: 001029650840000 A000000045  19830127000000           266000
4: 001029650870000 A000000046  20121031000000          2698000
5: 001029650950000 A000000047  19771115000000           111500
6: 001030683570000 A00000004C  19950427000000           751000
            CONVEYANCE_TYPE_DESCRIPTION saleYear
                                 <char>    <num>
1: Improved Single Property Transaction     2008
2: Improved Single Property Transaction     1988
3: Improved Single Property Transaction     1983
4: Improved Single Property Transaction     2012
5: Improved Single Property Transaction     1977
6: Improved Single Property Transaction     1995
> MINYEAR <- 2012
> MAXYEAR <- 2018
> dtSales <- dtSales[saleYear>=MINYEAR & saleYear<=MAXYEAR]
> dtDescription <- fread("~/OneDrive\ -\ UBC/Documents/data/bca/data_advice_REVD25_20250331/bca_folio_descriptions_20250331_REVD25.csv",select=c("FOLIO_ID","ROLL_NUMBER","ACTUAL_USE_DESCRIPTION","NEIGHBOURHOOD","JURISDICTION_CODE"))
> dtDescription <- dtDescription[JURISDICTION_CODE==200]
> dtMerge <- merge(dtDescription,dtCentroids,by="ROLL_NUMBER")
> dtMerge <- merge(dtMerge,dtInventory,by.x="ROLL_NUMBER",by.y="Roll_Number")
> print(nrow(dtMerge))
[1] 199693
> dtMerge <- merge(dtMerge,dtSales,by="ROLL_NUMBER")
> # order by frequency
> print(table(dtMerge[,ACTUAL_USE_DESCRIPTION])[order(table(dtMerge[,ACTUAL_USE_DESCRIPTION]),decreasing=TRUE)])

                Strata-Lot Residence (Condominium) 
                                             51652 
                   Residential Dwelling with Suite 
                                             11182 
                            Single Family Dwelling 
                                              8018 
               Row Housing (Single Unit Ownership) 
                                              5151 
                       Duplex, Strata Front / Back 
                                              1076 
                       Duplex, Strata Side by Side 
                                               545 
   Duplex, Non-Strata Side by Side or Front / Back 
                                               145 
                          Duplex, Strata Up / Down 
                                                50 
              Vacant Residential Less Than 2 Acres 
                                                36 
  Stratified Rental Apartment (Frame Construction) 
                                                32 
                      Duplex, Non-Strata Up / Down 
                                                27 
                 Property Subject To Section 19(8) 
                                                13 
                                           Triplex 
                                                 8 
  2 Acres Or More (Single Family Dwelling, Duplex) 
                                                 7 
Stratified Rental Apartment (Hi-Rise Construction) 
                                                 5 
       Bed & Breakfast Operation Less Than 4 Units 
                                                 3 
                     2 Acres Or More (Outbuilding) 
                                                 1 
                      Residential Outbuilding Only 
                                                 1 
                       Stratified Rental Townhouse 
                                                 1 
> dtMerge <- dtMerge[ACTUAL_USE_DESCRIPTION %in% c("Strata-Lot Residence (Condominium)", "Residential Dwelling with Suite", "Single Family Dwelling", "Row Housing (Single Unit Ownership)") | grepl("Duplex",ACTUAL_USE_DESCRIPTION)]
> # first question: among single family homes are neighbourhoods relevant?
> dtMerge[,age:=saleYear-MB_Effective_Year]
> # citywide optimal square feet?
> 
> dtMerge[,distDowntown:=distGeo(cbind(lon,lat),c(lonDowntown,latDowntown))]
> regValue1 <- feols(log(CONVEYANCE_PRICE) ~ log(MB_Total_Finished_Area) + log(age+1) +lon*distDowntown|saleYear^ACTUAL_USE_DESCRIPTION,data=dtMerge )
NOTE: 4,197 observations removed because of NA and infinite values (LHS: 1, RHS: 4,196).
Warning message:
In log(age + 1) : NaNs produced
> regValue2 <- feols(log(CONVEYANCE_PRICE) ~ log(MB_Total_Finished_Area) + log(age+1) +lon*distDowntown + i(NEIGHBOURHOOD)|saleYear^ACTUAL_USE_DESCRIPTION,data=dtMerge )
NOTE: 4,197 observations removed because of NA and infinite values (LHS: 1, RHS: 4,196).
Warning message:
In log(age + 1) : NaNs produced
> # add census tract merge from Lon/Lat
> ct_file <- "~/OneDrive - UBC/dataRaw/lct_000b21a_e/lct_000b21a_e.shp"
> sCT <- st_read(ct_file, quiet = TRUE)
> sCT <- st_make_valid(sCT)
> 
> # turn lon/lat into a spatial point, then merge with census tract geometry as a spatial merge
> # plain vanilla crs lat lon
> sMerge <- st_as_sf(dtMerge, coords = c("lon", "lat"),crs=4326)
> sMerge <- st_transform(sMerge, crs = st_crs(sCT))
> sMerge <- st_join(sMerge, sCT, left = TRUE)
> # reconvert to better crs and get lon/lat familiarly
> sMerge <- st_transform(sMerge, crs = 4326)
> sMerge$lon <- st_coordinates(sMerge)[,1]
> sMerge$lat <- st_coordinates(sMerge)[,2]
> df <- as.data.table(sMerge)
> print(nrow(df))
[1] 77853
> print(nrow(df))
[1] 77853
> regValue3 <- feols(log(CONVEYANCE_PRICE) ~ log(MB_Total_Finished_Area) + log(age+1) +lon*distDowntown |saleYear^ACTUAL_USE_DESCRIPTION + CTNAME,data=df )
NOTE: 4,197 observations removed because of NA and infinite values (LHS: 1, RHS: 4,196).
Warning message:
In log(age + 1) : NaNs produced
> regValue4 <- feols(log(CONVEYANCE_PRICE) ~ log(MB_Total_Finished_Area) + log(age+1) |saleYear^ACTUAL_USE_DESCRIPTION + CTNAME,data=df )
NOTE: 4,197 observations removed because of NA and infinite values (LHS: 1, RHS: 4,196).
Warning message:
In log(age + 1) : NaNs produced
> # print etable with adjusted r2
> print(etable(regValue1,regValue2,regValue3,regValue4,fitstat="ar2"))
                                            regValue1             regValue2
Dependent Var.:                 log(CONVEYANCE_PRICE) log(CONVEYANCE_PRICE)
                                                                           
log(MB_Total_Finished_Area)         1.124*** (0.0275)     1.071*** (0.0311)
log(age+1)                        -0.0403*** (0.0111)    -0.0358** (0.0111)
lon                                -5.394*** (0.3731)     -9.232*** (1.021)
distDowntown                       0.0446*** (0.0068)    0.0805*** (0.0150)
lon x distDowntown                0.0004*** (5.56e-5)    0.0007*** (0.0001)
NEIGHBOURHOOD = Cambie                                     0.0988* (0.0435)
NEIGHBOURHOOD = CedarCottage                              0.1605** (0.0507)
NEIGHBOURHOOD = CoalHarbour                              0.4580*** (0.0374)
NEIGHBOURHOOD = Collingwood                              0.3261*** (0.0621)
NEIGHBOURHOOD = Downtown                                    0.0440 (0.0421)
NEIGHBOURHOOD = DowntownSouth                              -0.0086 (0.0319)
NEIGHBOURHOOD = Dunbar                                     -0.0006 (0.0226)
NEIGHBOURHOOD = Fairview                                  -0.0512* (0.0226)
NEIGHBOURHOOD = FalseCreekNorth                           0.1296** (0.0382)
NEIGHBOURHOOD = Fraserview                               0.2198*** (0.0568)
NEIGHBOURHOOD = Grandview                                0.2194*** (0.0612)
NEIGHBOURHOOD = HastingsEast                             0.2654*** (0.0654)
NEIGHBOURHOOD = Kerrisdale                                0.0578** (0.0217)
NEIGHBOURHOOD = Killarney                                0.2811*** (0.0526)
NEIGHBOURHOOD = Kitsilano                               -0.1276*** (0.0171)
NEIGHBOURHOOD = Knight                                     0.1338* (0.0565)
NEIGHBOURHOOD = Main&Fraser                                0.1042* (0.0505)
NEIGHBOURHOOD = MarineDrive                              0.2961*** (0.0572)
NEIGHBOURHOOD = Marpole                                  0.2017*** (0.0370)
NEIGHBOURHOOD = MountPleasant                               0.0735 (0.0464)
NEIGHBOURHOOD = Oakridge                                 0.2055*** (0.0308)
NEIGHBOURHOOD = PointGrey                                   0.0435 (0.0352)
NEIGHBOURHOOD = Renfrew                                   0.1742** (0.0634)
NEIGHBOURHOOD = RenfrewHeights                           0.2814*** (0.0589)
NEIGHBOURHOOD = Shaughnessy                              0.1824*** (0.0408)
NEIGHBOURHOOD = SouthGranville                           0.1736*** (0.0298)
NEIGHBOURHOOD = SouthVancouver                             0.0918* (0.0437)
NEIGHBOURHOOD = Southlands                               0.0940*** (0.0263)
NEIGHBOURHOOD = WestEnd                                 -0.0892*** (0.0244)
Fixed-Effects:                  --------------------- ---------------------
saleYear-ACTUAL_USE_DESCRIPTION                   Yes                   Yes
CTNAME                                             No                    No
_______________________________ _____________________ _____________________
S.E.: Clustered                 by: saleYear-ACTUAL.. by: saleYear-ACTUAL..
Adj. R2                                       0.90713               0.91701

                                            regValue3             regValue4
Dependent Var.:                 log(CONVEYANCE_PRICE) log(CONVEYANCE_PRICE)
                                                                           
log(MB_Total_Finished_Area)         1.073*** (0.0305)     1.076*** (0.0303)
log(age+1)                         -0.0324** (0.0107)    -0.0304** (0.0110)
lon                                     2.088 (1.422)                      
distDowntown                      -0.1004*** (0.0253)                      
lon x distDowntown                -0.0008*** (0.0002)                      
NEIGHBOURHOOD = Cambie                                                     
NEIGHBOURHOOD = CedarCottage                                               
NEIGHBOURHOOD = CoalHarbour                                                
NEIGHBOURHOOD = Collingwood                                                
NEIGHBOURHOOD = Downtown                                                   
NEIGHBOURHOOD = DowntownSouth                                              
NEIGHBOURHOOD = Dunbar                                                     
NEIGHBOURHOOD = Fairview                                                   
NEIGHBOURHOOD = FalseCreekNorth                                            
NEIGHBOURHOOD = Fraserview                                                 
NEIGHBOURHOOD = Grandview                                                  
NEIGHBOURHOOD = HastingsEast                                               
NEIGHBOURHOOD = Kerrisdale                                                 
NEIGHBOURHOOD = Killarney                                                  
NEIGHBOURHOOD = Kitsilano                                                  
NEIGHBOURHOOD = Knight                                                     
NEIGHBOURHOOD = Main&Fraser                                                
NEIGHBOURHOOD = MarineDrive                                                
NEIGHBOURHOOD = Marpole                                                    
NEIGHBOURHOOD = MountPleasant                                              
NEIGHBOURHOOD = Oakridge                                                   
NEIGHBOURHOOD = PointGrey                                                  
NEIGHBOURHOOD = Renfrew                                                    
NEIGHBOURHOOD = RenfrewHeights                                             
NEIGHBOURHOOD = Shaughnessy                                                
NEIGHBOURHOOD = SouthGranville                                             
NEIGHBOURHOOD = SouthVancouver                                             
NEIGHBOURHOOD = Southlands                                                 
NEIGHBOURHOOD = WestEnd                                                    
Fixed-Effects:                  --------------------- ---------------------
saleYear-ACTUAL_USE_DESCRIPTION                   Yes                   Yes
CTNAME                                            Yes                   Yes
_______________________________ _____________________ _____________________
S.E.: Clustered                 by: saleYear-ACTUAL.. by: saleYear-ACTUAL..
Adj. R2                                       0.92160               0.92065
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> df[,propertyType:=ifelse(ACTUAL_USE_DESCRIPTION %chin% c("Single Family Dwelling","Residential Dwelling with Suite"),"single",ifelse(grepl("Duplex,",ACTUAL_USE_DESCRIPTION),"duplex",ifelse(ACTUAL_USE_DESCRIPTION=="Row Housing (Single Unit Ownership)","TH","condo")))]
> df <- df[propertyType!="single" | Zoning=="R1-1"]
> df[,single:=propertyType=="single"]
> df[,ppsf:=CONVEYANCE_PRICE/MB_Total_Finished_Area]
> df <- df[!is.na(ppsf)]
> EXTREME_VAL <- .005
> minVal <- quantile(df[,ppsf], EXTREME_VAL)
> maxVal <- quantile(df[,ppsf], 1-EXTREME_VAL)
> df <- df[ppsf %between% c(minVal,maxVal)]
> print(summary(df))
 ROLL_NUMBER         FOLIO_ID.x        ACTUAL_USE_DESCRIPTION
 Length:74706       Length:74706       Length:74706          
 Class :character   Class :character   Class :character      
 Mode  :character   Mode  :character   Mode  :character      
                                                             
                                                             
                                                             
                                                             
 NEIGHBOURHOOD      JURISDICTION_CODE MB_Total_Finished_Area    Zoning         
 Length:74706       Min.   :200       Min.   :  329          Length:74706      
 Class :character   1st Qu.:200       1st Qu.:  651          Class :character  
 Mode  :character   Median :200       Median :  911          Mode  :character  
                    Mean   :200       Mean   : 1365                            
                    3rd Qu.:200       3rd Qu.: 1642                            
                    Max.   :200       Max.   :25164                            
                                                                               
 Land_Width_Width Land_Depth_Depth MB_Effective_Year  FOLIO_ID.y       
 Min.   : 16.00   Min.   :  0.00   Min.   :   0      Length:74706      
 1st Qu.: 33.00   1st Qu.:  0.00   1st Qu.:1994      Class :character  
 Median : 34.00   Median :  0.00   Median :2006      Mode  :character  
 Mean   : 42.62   Mean   : 29.91   Mean   :2002                        
 3rd Qu.: 50.00   3rd Qu.:  0.00   3rd Qu.:2014                        
 Max.   :330.00   Max.   :573.00   Max.   :2024                        
 NA's   :56495                     NA's   :1                           
 CONVEYANCE_DATE          CONVEYANCE_PRICE   CONVEYANCE_TYPE_DESCRIPTION
 Min.   :20120103000000   Min.   :   92607   Length:74706               
 1st Qu.:20140203000000   1st Qu.:  435000   Class :character           
 Median :20150903000000   Median :  667000   Mode  :character           
 Mean   :20151713121797   Mean   : 1031658                              
 3rd Qu.:20170316000000   3rd Qu.: 1200000                              
 Max.   :20181231000000   Max.   :24500000                              
                                                                        
    saleYear         age           distDowntown        CTUID          
 Min.   :2012   Min.   : -12.00   Min.   :  169.3   Length:74706      
 1st Qu.:2014   1st Qu.:   1.00   1st Qu.: 1243.3   Class :character  
 Median :2015   Median :   9.00   Median : 3160.6   Mode  :character  
 Mean   :2015   Mean   :  13.43   Mean   : 3883.1                     
 3rd Qu.:2017   3rd Qu.:  21.00   3rd Qu.: 6178.6                     
 Max.   :2018   Max.   :2018.00   Max.   :10819.7                     
                NA's   :1                                             
    DGUID              CTNAME             LANDAREA         PRUID          
 Length:74706       Length:74706       Min.   :0.1238   Length:74706      
 Class :character   Class :character   1st Qu.:0.3375   Class :character  
 Mode  :character   Mode  :character   Median :0.6813   Mode  :character  
                                       Mean   :0.8434                     
                                       3rd Qu.:1.2593                     
                                       Max.   :4.0575                     
                                                                          
          geometry          lon              lat        propertyType      
 POINT        :74706   Min.   :-123.2   Min.   :49.20   Length:74706      
 epsg:4326    :    0   1st Qu.:-123.1   1st Qu.:49.24   Class :character  
 +proj=long...:    0   Median :-123.1   Median :49.26   Mode  :character  
                       Mean   :-123.1   Mean   :49.26                     
                       3rd Qu.:-123.1   3rd Qu.:49.28                     
                       Max.   :-123.0   Max.   :49.29                     
                                                                          
   single             ppsf       
 Mode :logical   Min.   : 259.7  
 FALSE:58309     1st Qu.: 564.9  
 TRUE :16397     Median : 694.6  
                 Mean   : 745.9  
                 3rd Qu.: 881.1  
                 Max.   :1949.9  
                                 
> # turn the below into a regression
> df[,roundSQFT:=round(MB_Total_Finished_Area/200)]
> MINSQFT <- .25*.8*33*122
> MAXSQFT <- 1.5*.8*33*122
> MINWIDTH <- 30
> MAXWIDTH <- 35 # over half of properties
> df <- df[Land_Width_Width %between% c(MINWIDTH,MAXWIDTH)]
> df <- df[MB_Total_Finished_Area %between% c(MINSQFT,MAXSQFT)]
> df[,sfk:=MB_Total_Finished_Area/1000]
> df <- df[propertyType %chin% c("condo","TH")==FALSE] # apples to apples!
> ONTARIOLON <- -123.105 # google
> df[,east:=lon>ONTARIOLON]
> # functional form
> # Automate some of this code
> library(data.table)
> library(fixest)
> 
> setDT(df)
> df[, single := propertyType == "single"]
> 
> 
> setDT(df)
> 
> # precompute raw polynomial terms as plain numeric columns
> df[, `:=`(
+   sfk1 = sfk,
+   sfk2 = sfk^2,
+   sfk3 = sfk^3,
+   single = propertyType == "single"
+ )]
> 
> gvars <- c("east", "NEIGHBOURHOOD", "CTNAME")
> fes   <- "saleYear + age + CTNAME"
> 
> run_triplet <- function(dt, y, x, gvars, fes) {
+   sapply(gvars, function(g) {
+     fml <- as.formula(sprintf("%s ~ (%s)*i(%s) | %s", y, x, g, fes))
+     fitstat(feols(fml, data = dt), "war2")
+   })
+ }
> 
> specs <- list(
+   cubic  = list(dt = df[age < MAXAGE], y = "ppsf",      x = "sfk1 + sfk2 + sfk3"),
+   loglog = list(dt = df[age < MAXAGE], y = "log(ppsf)", x = "log(sfk)"),
+   linear = list(dt = df[age < MAXAGE], y = "ppsf",      x = "sfk"),
+   single = list(dt = df[age < 20],     y = "ppsf",      x = "single")
+ )
> 
> war2_mat <- do.call(rbind, lapply(specs, function(s)
+   run_triplet(s$dt, s$y, s$x, gvars, fes)
+ ))
The variables 'sfk1:east::TRUE' and 'sfk3:east::TRUE' have been removed because of collinearity (see $collin.var).
The variables 'NEIGHBOURHOOD::Fairview', 'NEIGHBOURHOOD::Fraserview', 'NEIGHBOURHOOD::Point Grey', 'NEIGHBOURHOOD::West End', 'sfk1:NEIGHBOURHOOD::Fairview', 'sfk1:NEIGHBOURHOOD::Southlands' and 8 others have been removed because of collinearity (see $collin.var).
The variables 'CTNAME::0002.03', 'CTNAME::0002.04', 'CTNAME::0003.01', 'CTNAME::0003.02', 'CTNAME::0004.01', 'CTNAME::0004.02' and 98 others have been removed because of collinearity (see $collin.var).
The variable 'log(sfk):east::TRUE' has been removed because of collinearity (see $collin.var).
The variables 'NEIGHBOURHOOD::Fairview', 'NEIGHBOURHOOD::Fraserview', 'NEIGHBOURHOOD::Point Grey', 'NEIGHBOURHOOD::West End', 'log(sfk):NEIGHBOURHOOD::Fairview', 'log(sfk):NEIGHBOURHOOD::Southlands' and 'log(sfk):NEIGHBOURHOOD::West End' have been removed because of collinearity (see $collin.var).
The variables 'CTNAME::0002.03', 'CTNAME::0002.04', 'CTNAME::0003.01', 'CTNAME::0003.02', 'CTNAME::0004.01', 'CTNAME::0004.02' and 83 others have been removed because of collinearity (see $collin.var).
The variable 'sfk:east::TRUE' has been removed because of collinearity (see $collin.var).
The variables 'NEIGHBOURHOOD::Fairview', 'NEIGHBOURHOOD::Fraserview', 'NEIGHBOURHOOD::Point Grey', 'NEIGHBOURHOOD::West End', 'sfk:NEIGHBOURHOOD::Fairview', 'sfk:NEIGHBOURHOOD::Southlands' and 'sfk:NEIGHBOURHOOD::West End' have been removed because of collinearity (see $collin.var).
The variables 'CTNAME::0002.03', 'CTNAME::0002.04', 'CTNAME::0003.01', 'CTNAME::0003.02', 'CTNAME::0004.01', 'CTNAME::0004.02' and 83 others have been removed because of collinearity (see $collin.var).
The variables 'singleTRUE:east::FALSE', 'singleFALSE:east::TRUE' and 'singleTRUE:east::TRUE' have been removed because of collinearity (see $collin.var).
The variables 'NEIGHBOURHOOD::Fairview', 'NEIGHBOURHOOD::Fraserview', 'NEIGHBOURHOOD::Point Grey', 'NEIGHBOURHOOD::West End', 'singleTRUE:NEIGHBOURHOOD::Arbutus Ridge - Mackenzie Heights', 'singleTRUE:NEIGHBOURHOOD::Cambie' and 35 others have been removed because of collinearity (see $collin.var).
The variables 'CTNAME::0002.03', 'CTNAME::0002.04', 'CTNAME::0003.01', 'CTNAME::0003.02', 'CTNAME::0004.01', 'CTNAME::0004.02' and 209 others have been removed because of collinearity (see $collin.var).
> df[,lsqft := log(MB_Total_Finished_Area)]
> regT <- feols(log(ppsf) ~ 0+ lsqft*i(CTNAME) | saleYear + age +CTNAME, data=df[age<MAXAGE])
The variables 'CTNAME::0002.03', 'CTNAME::0002.04', 'CTNAME::0003.01', 'CTNAME::0003.02', 'CTNAME::0004.01', 'CTNAME::0004.02' and 82 others have been removed because of collinearity (see $collin.var).
> regN <- feols(log(CONVEYANCE_PRICE) ~ lsqft*i(NEIGHBOURHOOD) + single*i(NEIGHBOURHOOD)| saleYear + age +NEIGHBOURHOOD, data=df[age<MAXAGE])
The variables 'NEIGHBOURHOOD::Cambie', 'NEIGHBOURHOOD::Cedar Cottage', 'NEIGHBOURHOOD::Collingwood', 'NEIGHBOURHOOD::Dunbar', 'NEIGHBOURHOOD::Fairview', 'NEIGHBOURHOOD::Fraserview' and 32 others have been removed because of collinearity (see $collin.var).
> regL <- feols(log(CONVEYANCE_PRICE) ~  lsqft*lon | saleYear + age,data=df[age<MAXAGE])
> regLL <- feols( ppsf ~ MB_Total_Finished_Area*lon| saleYear + age + NEIGHBOURHOOD + CTNAME,data=df[age<MAXAGE])
> regLP <- feols( log(CONVEYANCE_PRICE) ~ lsqft*lon + single*lon| saleYear + age + NEIGHBOURHOOD + CTNAME,data=df[age<MAXAGE])
> regLN <- feols(log(CONVEYANCE_PRICE) ~ 0 + lsqft*lon | saleYear + age + NEIGHBOURHOOD,data=df[age<MAXAGE])
> regLNN <- feols(log(CONVEYANCE_PRICE) ~ 0 + lsqft*lon + lsqft*i(NEIGHBOURHOOD)| saleYear + age + NEIGHBOURHOOD + CTNAME,data=df[age<MAXAGE])
The variables 'NEIGHBOURHOOD::Killarney', 'NEIGHBOURHOOD::Kitsilano', 'NEIGHBOURHOOD::Knight', 'NEIGHBOURHOOD::Main & Fraser', 'NEIGHBOURHOOD::Marine Drive', 'NEIGHBOURHOOD::Marpole' and 10 others have been removed because of collinearity (see $collin.var).
> for (reg in list(regT, regN, regL, regLP,regLL,regLN, regLNN)) {
+   print(fitstat(reg, c("war2","r2","ar2")))
+ }
Within Adj. R2: 0.157911
            R2: 0.858922
       Adj. R2: 0.854232
Within Adj. R2: 0.474091
            R2: 0.885853
       Adj. R2: 0.883914
Within Adj. R2: 0.805763
            R2: 0.855003
       Adj. R2: 0.853986
Within Adj. R2: 0.405264
            R2: 0.894409
       Adj. R2: 0.891798
Within Adj. R2: 0.084643
            R2: 0.824123
       Adj. R2: 0.819831
Within Adj. R2: 0.458651
            R2: 0.8818
       Adj. R2: 0.880506
Within Adj. R2: 0.396937
            R2: 0.893491
       Adj. R2: 0.890283
> #lsqft:NEIGHBOURHOOD::Renfrew Heights  
> # turn coefficients of this form into a data.table
> df <- df[NEIGHBOURHOOD!="Shaughnessy"]
> dtInteractionsNeighbourhood <- data.table(neighbourhood=character(),interactionLSF=numeric(),medianPPSF=numeric())
> interceptLSF <- coef(regN)["lsqft"]
> for (n in unique(df[,NEIGHBOURHOOD])) {
+ 	medianPPSF <- median(df[NEIGHBOURHOOD==n & propertyType=="single" & age<MAXAGE,ppsf])
+ 	x <- data.table(neighbourhood=n,interactionLSF=coef(regN)[paste0("lsqft:NEIGHBOURHOOD::",n)][1]+interceptLSF,medianPPSF=medianPPSF)
+ 	dtInteractionsNeighbourhood <- rbind(dtInteractionsNeighbourhood, x)
+ }
> fwrite(dtInteractionsNeighbourhood,file="~/OneDrive - UBC/dataProcessed/neighbourhoodInteractionsVancouver.csv")
> print(etable(regL,regLL,regLP))
                                              regL             regLL
Dependent Var.:              log(CONVEYANCE_PRICE)              ppsf
                                                                    
lsqft                            -205.7*** (22.95)                  
lon                               8.544*** (1.419) -1,842.5* (638.4)
lsqft x lon                     -1.677*** (0.1865)                  
MB_Total_Finished_Area                                -4.860 (27.68)
MB_Total_Finished_Area x lon                        -0.0387 (0.2249)
singleTRUE                                                          
lon x singleTRUE                                                    
Fixed-Effects:               --------------------- -----------------
saleYear                                       Yes               Yes
age                                            Yes               Yes
NEIGHBOURHOOD                                   No               Yes
CTNAME                                          No               Yes
____________________________ _____________________ _________________
S.E.: Clustered                       by: saleYear      by: saleYear
Observations                                 6,466             6,466
R2                                         0.85500           0.82412
Within R2                                  0.80585           0.08508

                                             regLP
Dependent Var.:              log(CONVEYANCE_PRICE)
                                                  
lsqft                              -178.8* (62.24)
lon                                 9.494* (3.809)
lsqft x lon                       -1.457* (0.5057)
MB_Total_Finished_Area                            
MB_Total_Finished_Area x lon                      
singleTRUE                         -152.9. (71.43)
lon x singleTRUE                  -1.243. (0.5803)
Fixed-Effects:               ---------------------
saleYear                                       Yes
age                                            Yes
NEIGHBOURHOOD                                  Yes
CTNAME                                         Yes
____________________________ _____________________
S.E.: Clustered                       by: saleYear
Observations                                 6,466
R2                                         0.89441
Within R2                                  0.40573
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> q("no")
> proc.time()
   user  system elapsed 
 22.312   6.948   9.646 
