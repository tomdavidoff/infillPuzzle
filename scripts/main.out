
R version 4.4.0 (2024-04-24) -- "Puppy Cup"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # main.R
> # main analysis script
> # Tom Davidoff
> # 01/16/26
> 
> library(data.table)
Warning message:
package ‘data.table’ was built under R version 4.4.1 
> library(ggplot2)
> library(fixest)
> 
> # Vancouver analysis # note neighbourhoodDescription better than tract for analysis level
> # get slopes and mean values from BCA sales analysis by census tract merge
> nameSlope <- "tables/bca19_mean_ppsf_slope_All_by_neighbourhood.csv"
> if (!file.exists(nameSlope)) {
+   source("scripts/bcaSalesAll.R")
+ }
> # specify column CTUID is a number
> dtSlope <- fread(nameSlope)
> 
> # Now get projects merged with BCA and census tracts
> nameSpatial <- "~/OneDrive - UBC/dataProcessed/vancouverPermitLotsTracts.rds"
> if (!file.exists(nameSpatial)) {
+   source("scripts/mergePermitsSpatial.R")
+ }
> dtSpatial <- readRDS(nameSpatial)
> 
> print(head(dtSpatial))
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate     use
       <char>          <char>     <char>                  <IDat>  <char>
1: 9330044.00 001633021620000 A0000000CR              2024-01-17  single
2: 9330029.00 009697153290000 A00000191E              2019-02-21  single
3: 9330030.00 016185716270000 A0000025QE              2018-04-30  single
4: 9330013.01 019237750590000 A000002L99              2025-05-13 laneway
5: 9330008.02 006769050140000 A000000U30              2021-07-15  single
6: 9330043.02 001650034570000 A0000001L4              2024-11-27 laneway
   maxSingle MB_effective_year MB_total_finished_area neighbourhoodDescription
       <int>            <char>                 <char>                   <char>
1:         1              1965                   4002               POINT GREY
2:         1                                                            CAMBIE
3:         1              2019                   3342              MAIN/FRASER
4:         0              2007                   2198                   KNIGHT
5:         1              1978                   3064               SOUTHLANDS
6:         0              1975                   2764               POINT GREY
                                        address LANDAREA landWidth landDepth
                                         <char>    <num>    <char>    <char>
1:   4632 LANGARA AVENUE, Vancouver, BC V6R 1E1   2.8772        65       110
2:     869 W 20TH AVENUE, Vancouver, BC V5Z 1Y3   1.5016        33       122
3:     4427 JAMES STREET, Vancouver, BC V5V 3H9   1.4562      49.5       111
4: 5835 ARGYLE STREET #3, Vancouver, BC V6P 3J8   1.1375        33       122
5:    3280 W 48TH AVENUE, Vancouver, BC V6N 3P8   3.5378     65.99    164.84
6:    3863 W BROADWAY #3, Vancouver, BC V6R 2C2   0.9967     58.54    108.84
               geo_point_2d            typeofwork
                     <char>                <char>
1: 49.2729074, -123.2125593 Addition / Alteration
2: 49.2537249, -123.1237645          New Building
3: 49.2456172, -123.1042038          New Building
4: 49.2313344, -123.0719816          New Building
5: 49.2281967, -123.1779482          New Building
6:  49.2647127, -123.189698          New Building
> print(head(dtSlope))
    neighbourhoodDescription meanPPSF  nobs      slope  elasticity
                      <char>    <num> <int>      <num>       <num>
1: ARBUTUS/MACKENZIE HEIGHTS 868.8378   148 -0.1057823  0.61892479
2:                    CAMBIE 847.4542   179 -0.1349745  0.30759901
3:             CEDAR COTTAGE 741.9518   222 -0.1739847 -0.03167608
4:               COLLINGWOOD 636.5955   384 -0.1918768 -0.15257106
5:                    DUNBAR 886.2351   305 -0.1075784  0.48813395
6:                FRASERVIEW 618.8797   313 -0.1682823  0.09572774
> dtMerge <- merge(dtSpatial,dtSlope,by="neighbourhoodDescription")
> print(head(dtMerge))
Key: <neighbourhoodDescription>
    neighbourhoodDescription      CTUID     ROLL_NUMBER    folioID
                      <char>     <char>          <char>     <char>
1: ARBUTUS/MACKENZIE HEIGHTS 9330026.00 004698070060000 A000000MK2
2: ARBUTUS/MACKENZIE HEIGHTS 9330026.00 004701067070000 A000000MPG
3: ARBUTUS/MACKENZIE HEIGHTS 9330023.00 004726060300000 A000000P3A
4: ARBUTUS/MACKENZIE HEIGHTS 9330023.00 004726054310000 A000000P1R
5: ARBUTUS/MACKENZIE HEIGHTS 9330026.00 004698067070000 A000000MJA
6: ARBUTUS/MACKENZIE HEIGHTS 9330026.00 004710062840000 A000000N4W
   permitnumbercreateddate     use maxSingle MB_effective_year
                    <IDat>  <char>     <int>            <char>
1:              2021-05-04  duplex         0              1940
2:              2023-03-06  single         1              1944
3:              2024-10-11 laneway         0              1996
4:              2025-06-06  single         1              2003
5:              2023-08-30  single         1              1970
6:              2025-10-03 laneway         0              1970
   MB_total_finished_area                                      address LANDAREA
                   <char>                                       <char>    <num>
1:                   1619    2796 W 21ST AVENUE, Vancouver, BC V6L 1K3   1.2593
2:                   1539    2893 W 22ND AVENUE, Vancouver, BC V6L 1M7   1.2593
3:                   2576 2882 W 32ND AVENUE #3, Vancouver, BC V6L 2B6   1.2002
4:                   4339    3131 W 32ND AVENUE, Vancouver, BC V6L 2B9   1.2002
5:                   1829    2895 W 21ST AVENUE, Vancouver, BC V6L 1K5   1.2593
6:                   3387  2806 W KING EDWARD AVENUE #3, Vancouver, BC   1.2593
   landWidth landDepth             geo_point_2d            typeofwork meanPPSF
      <char>    <char>                   <char>                <char>    <num>
1:     40.07    122.07 49.2534415, -123.1675267          New Building 868.8378
2:        33       122 49.2530631, -123.1699259          New Building 868.8378
3:        33    130.25 49.2429853, -123.1696341          New Building 868.8378
4:        50    130.15  49.243546, -123.1748728 Addition / Alteration 868.8378
5:      37.5       122 49.2539631, -123.1698984          New Building 868.8378
6:                     49.2478066, -123.1683513          New Building 868.8378
    nobs      slope elasticity
   <int>      <num>      <num>
1:   148 -0.1057823  0.6189248
2:   148 -0.1057823  0.6189248
3:   148 -0.1057823  0.6189248
4:   148 -0.1057823  0.6189248
5:   148 -0.1057823  0.6189248
6:   148 -0.1057823  0.6189248
> print(summary(dtMerge))
 neighbourhoodDescription    CTUID           ROLL_NUMBER       
 Length:2441              Length:2441        Length:2441       
 Class :character         Class :character   Class :character  
 Mode  :character         Mode  :character   Mode  :character  
                                                               
                                                               
                                                               
   folioID          permitnumbercreateddate     use              maxSingle     
 Length:2441        Min.   :2017-01-04      Length:2441        Min.   :0.0000  
 Class :character   1st Qu.:2020-09-04      Class :character   1st Qu.:0.0000  
 Mode  :character   Median :2022-06-20      Mode  :character   Median :0.0000  
                    Mean   :2022-04-09                         Mean   :0.4015  
                    3rd Qu.:2024-07-29                         3rd Qu.:1.0000  
                    Max.   :2025-10-17                         Max.   :1.0000  
 MB_effective_year  MB_total_finished_area   address             LANDAREA     
 Length:2441        Length:2441            Length:2441        Min.   :0.3178  
 Class :character   Class :character       Class :character   1st Qu.:0.8885  
 Mode  :character   Mode  :character       Mode  :character   Median :1.2593  
                                                              Mean   :1.3065  
                                                              3rd Qu.:1.5340  
                                                              Max.   :3.5378  
  landWidth          landDepth         geo_point_2d        typeofwork       
 Length:2441        Length:2441        Length:2441        Length:2441       
 Class :character   Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character   Mode  :character  
                                                                            
                                                                            
                                                                            
    meanPPSF          nobs         slope           elasticity      
 Min.   :587.9   Min.   : 15   Min.   :-0.1919   Min.   :-0.15257  
 1st Qu.:659.5   1st Qu.:148   1st Qu.:-0.1528   1st Qu.: 0.09573  
 Median :743.6   Median :305   Median :-0.1447   Median : 0.23436  
 Mean   :767.4   Mean   :373   Mean   :-0.1400   Mean   : 0.24888  
 3rd Qu.:868.8   3rd Qu.:584   3rd Qu.:-0.1196   3rd Qu.: 0.41998  
 Max.   :902.4   Max.   :791   Max.   :-0.1058   Max.   : 0.61892  
> print(table(dtMerge[,use]))

 duplex laneway   multi  single 
    765     517     179     980 
> # permitnumbercreateddate     use            MB_effective_year 
> # Min.   :2017-01-03      Length:3762        Length:3762       
> 
> dtMerge[,pYear:=year(permitnumbercreateddate)]
> for (y in sort(unique(dtMerge[,pYear]))) {
+   print(y)
+   print(table(dtMerge[pYear==y,use]))
+ }
[1] 2017

laneway  single 
      8     217 
[1] 2018

 duplex laneway  single 
      1       3     156 
[1] 2019

 duplex laneway   multi  single 
     14       2       1     138 
[1] 2020

 duplex laneway   multi  single 
     36       8       1      70 
[1] 2021

 duplex laneway   multi  single 
    274      13       1     164 
[1] 2022

 duplex laneway   multi  single 
    116       7       3      82 
[1] 2023

 duplex laneway   multi  single 
    101      42       4      72 
[1] 2024

 duplex laneway   multi  single 
    130     291      96      57 
[1] 2025

 duplex laneway   multi  single 
     93     143      73      24 
> 
> 
> dtMerge[,MB_total_finished_area:=as.numeric(MB_total_finished_area)]
> dtMerge[,MB_effective_year:=as.numeric(MB_effective_year)]
> dtMerge[,landWidth:=as.numeric(landWidth)]
> dtMerge[,landDepth:=as.numeric(landDepth)]
> dtMerge[,effectiveAge:=pYear - MB_effective_year]
> dtMerge[maxSingle==0 & use=="laneway",use:="lanewayOnly"]
> # No duplexes under 25 years old (?)
> print(summary(dtMerge[,.(MB_total_finished_area,landWidth,landDepth,effectiveAge)]))
 MB_total_finished_area   landWidth        landDepth      effectiveAge   
 Min.   :  100          Min.   : 16.50   Min.   : 50.0   Min.   : -3.00  
 1st Qu.: 1866          1st Qu.: 33.00   1st Qu.:116.5   1st Qu.: 21.00  
 Median : 2362          Median : 36.00   Median :122.0   Median : 49.00  
 Mean   : 2705          Mean   : 42.69   Mean   :124.0   Mean   : 42.13  
 3rd Qu.: 3089          3rd Qu.: 50.00   3rd Qu.:129.0   3rd Qu.: 62.00  
 Max.   :26505          Max.   :132.00   Max.   :404.0   Max.   :114.00  
 NA's   :21             NA's   :180      NA's   :180     NA's   :21      
> 
> dtMerge[,notSingle:=use!="single" & use!="laneway"]
> ## KEY: Drop Laneway only
> print(dtMerge[effectiveAge>0,summary(effectiveAge),by="use"])
            use               V1
         <char> <summaryDefault>
 1:      duplex            26.00
 2:      duplex            53.00
 3:      duplex            61.00
 4:      duplex            61.11
 5:      duplex            69.00
 6:      duplex           114.00
 7:      single             1.00
 8:      single            29.00
 9:      single            47.00
10:      single            43.86
11:      single            59.00
12:      single           111.00
13: lanewayOnly             1.00
14: lanewayOnly            22.00
15: lanewayOnly            34.00
16: lanewayOnly            38.59
17: lanewayOnly            56.00
18: lanewayOnly           102.00
19:       multi            19.00
20:       multi            54.00
21:       multi            61.00
22:       multi            60.84
23:       multi            70.00
24:       multi           100.00
            use               V1
> print(dtMerge[effectiveAge>0,table(typeofwork),by="use"])
           use      V1
        <char> <table>
1:      duplex       4
2:      duplex     755
3:      single     260
4:      single     322
5: lanewayOnly       2
6: lanewayOnly     507
7:       multi       2
8:       multi     176
> dtMerge <- dtMerge[effectiveAge>25]
> dtMerge <- dtMerge[use!="lanewayOnly" & typeofwork=="New Building"]
> # use geo_point_2d to plot variable notSingle by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=notSingle)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Not Single Family (including laneway) Permits")
>   ggsave("text/notSingleLocation.png",width=8,height=6)
> 
>   # now plot meanPPSF by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=meanPPSF)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Mean PPSF from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/meanPPSFLocation.png",width=8,height=6)
> 
>   # now plot elasticity by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=elasticity)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Elasticity from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/elasticityLocation.png",width=8,height=6)
> 
>   # and slope
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=slope)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Slope from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/slopeLocation.png",width=8,height=6)
> 
>   # mean notSingle by meanPPSF x-y plot
>   dtTract <- dtMerge[pYear>2020,.(notSingle=mean(notSingle,na.rm=TRUE), nobs=mean(nobs),
+                           meanPPSF=mean(meanPPSF,na.rm=TRUE), slope=mean(slope,na.rm=TRUE), elasticity=mean(elasticity,na.rm=TRUE)),
+                       by=.(neighbourhoodDescription)]
>   ggplot(dtTract,aes(x=meanPPSF,y=notSingle)) + geom_point() 
>   ggsave("text/notSingle_vs_meanPPSF.png",width=8,height=6)
> 
>   # ppsf and slope -- make points proportional to nobs
>   ggplot(dtTract,aes(x=meanPPSF,y=slope)) + geom_point(aes(size=nobs)) +
+     theme_minimal() 
>   ggsave("text/ppsfSlopeTract.png",width=8,height=6)
> 
> print(cor(dtTract[,.(notSingle,meanPPSF,slope,elasticity)],use="complete.obs"))
            notSingle   meanPPSF      slope elasticity
notSingle   1.0000000 -0.8276175 -0.5204259 -0.6392914
meanPPSF   -0.8276175  1.0000000  0.6842739  0.7204752
slope      -0.5204259  0.6842739  1.0000000  0.9626253
elasticity -0.6392914  0.7204752  0.9626253  1.0000000
> print(summary(lm(notSingle ~ meanPPSF,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.24597 -0.05792  0.01286  0.03646  0.22778 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.1117896  0.2129379   9.917 6.01e-09 ***
meanPPSF    -0.0017776  0.0002766  -6.427 3.67e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.129 on 19 degrees of freedom
Multiple R-squared:  0.685,	Adjusted R-squared:  0.6684 
F-statistic: 41.31 on 1 and 19 DF,  p-value: 3.669e-06

> print(summary(lm(notSingle ~ meanPPSF + slope ,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + slope, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.25319 -0.06953  0.01386  0.03779  0.21631 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.3167071  0.4801106   4.825 0.000136 ***
meanPPSF    -0.0019044  0.0003872  -4.918 0.000111 ***
slope        0.7522495  1.5714492   0.479 0.637917    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1317 on 18 degrees of freedom
Multiple R-squared:  0.6889,	Adjusted R-squared:  0.6543 
F-statistic: 19.93 on 2 and 18 DF,  p-value: 2.729e-05

> print(summary(lm(notSingle ~ meanPPSF + elasticity ,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + elasticity, data = dtTract)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.250691 -0.048462  0.009666  0.050519  0.234577 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.0273759  0.2816018   7.199 1.06e-06 ***
meanPPSF    -0.0016392  0.0004072  -4.025 0.000794 ***
elasticity  -0.0955776  0.2026146  -0.472 0.642793    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1317 on 18 degrees of freedom
Multiple R-squared:  0.6888,	Adjusted R-squared:  0.6542 
F-statistic: 19.92 on 2 and 18 DF,  p-value: 2.738e-05

> # combinedera
> print(summary(feols(notSingle ~ meanPPSF  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,123
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
          Estimate Std. Error  t value Pr(>|t|)    
meanPPSF -0.001891   0.000455 -4.15244 0.014232 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.349173     Adj. R2: 0.268979
                 Within R2: 0.228528
> print(summary(feols(notSingle ~ slope  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,123
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
      Estimate Std. Error  t value Pr(>|t|)    
slope -5.17655    1.29283 -4.00406 0.016076 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.376399     Adj. R2: 0.150535
                 Within R2: 0.10353 
> print(summary(feols(notSingle ~ elasticity  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,123
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
           Estimate Std. Error  t value Pr(>|t|)    
elasticity -0.72997   0.170602 -4.27879  0.01286 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.368616     Adj. R2: 0.1853  
                 Within R2: 0.140219
> print(summary(feols(notSingle ~ meanPPSF + elasticity  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,123
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
            Estimate Std. Error   t value Pr(>|t|)    
meanPPSF   -0.001847   0.000481 -3.837569 0.018498 *  
elasticity -0.027910   0.053813 -0.518642 0.631381    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.349154     Adj. R2: 0.268403
                 Within R2: 0.228611
> print(summary(feols(notSingle ~ meanPPSF + slope  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,123
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
          Estimate Std. Error  t value Pr(>|t|)    
meanPPSF -0.002041   0.000482 -4.23514 0.013315 *  
slope     0.841101   0.501523  1.67709 0.168830    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.348879     Adj. R2: 0.269554
                 Within R2: 0.229825
> print(summary(feols(notSingle ~ meanPPSF + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,123
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001721   0.000496 -3.469201 0.025602 *  
log(MB_total_finished_area) -0.051756   0.056995 -0.908079 0.415199    
log(LANDAREA)               -0.038852   0.030290 -1.282668 0.268891    
log(effectiveAge)            0.122879   0.037713  3.258270 0.031132 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.346599     Adj. R2: 0.277775
                 Within R2: 0.239858
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 170
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001976   0.000767 -2.577795  0.06147 .  
slope                       -0.658086   1.782171 -0.369261  0.73065    
log(MB_total_finished_area) -0.065835   0.138228 -0.476276  0.65873    
log(LANDAREA)               -0.059713   0.051507 -1.159312  0.31082    
log(effectiveAge)            0.189409   0.111256  1.702458  0.16388    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.354713     Adj. R2: 0.403701
                 Within R2: 0.299239
> print(summary(feols(notSingle ~ meanPPSF+ log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 170
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.002112   0.000472 -4.471936 0.011058 *  
log(MB_total_finished_area) -0.068910   0.147366 -0.467615 0.664399    
log(LANDAREA)               -0.061471   0.054913 -1.119420 0.325638    
log(effectiveAge)            0.183206   0.122347  1.497424 0.208634    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.354848     Adj. R2: 0.40695 
                 Within R2: 0.298702
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 170
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001902   0.000626 -3.036143 0.038548 *  
elasticity                  -0.124803   0.169939 -0.734400 0.503434    
log(MB_total_finished_area) -0.063111   0.138196 -0.456676 0.671603    
log(LANDAREA)               -0.059309   0.052767 -1.123974 0.323914    
log(effectiveAge)            0.194255   0.112873  1.720998 0.160363    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.35449     Adj. R2: 0.404448
                Within R2: 0.300117
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(30,36) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 602
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001191   0.000424 -2.807875 0.048422 *  
slope                        0.175305   0.272749  0.642733 0.555387    
log(MB_total_finished_area)  0.076177   0.056586  1.346212 0.249465    
log(LANDAREA)                0.016281   0.050500  0.322402 0.763296    
log(effectiveAge)            0.151943   0.046826  3.244808 0.031530 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.303402     Adj. R2: 0.152805
                 Within R2: 0.115451
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(30,36) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 602
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001087   0.000392 -2.771189 0.050270 .  
elasticity                  -0.051246   0.056708 -0.903690 0.417263    
log(MB_total_finished_area)  0.077516   0.056186  1.379626 0.239807    
log(LANDAREA)                0.020886   0.050750  0.411549 0.701766    
log(effectiveAge)            0.153720   0.045162  3.403718 0.027184 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.30335     Adj. R2: 0.153094
                Within R2: 0.115753
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,123
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001859   0.000517 -3.597379 0.022811 *  
slope                        0.800010   0.509703  1.569561 0.191602    
log(MB_total_finished_area) -0.052221   0.056397 -0.925958 0.406876    
log(LANDAREA)               -0.043668   0.029656 -1.472458 0.214882    
log(effectiveAge)            0.116016   0.040610  2.856811 0.046078 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.346341     Adj. R2: 0.278204
                 Within R2: 0.240991
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,123
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001674   0.000515 -3.250667 0.031356 *  
elasticity                  -0.031783   0.052976 -0.599939 0.580878    
log(MB_total_finished_area) -0.050504   0.056467 -0.894408 0.421657    
log(LANDAREA)               -0.037908   0.029580 -1.281531 0.269252    
log(effectiveAge)            0.125298   0.040990  3.056765 0.037778 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.346575     Adj. R2: 0.277226
                 Within R2: 0.239963
> 
> print(cor(dtMerge[effectiveAge>2,.(MB_total_finished_area/landWidth,effectiveAge,notSingle,meanPPSF)],use="complete.obs"))
                      V1 effectiveAge   notSingle   meanPPSF
V1            1.00000000   -0.3448811 -0.07266786  0.1907650
effectiveAge -0.34488108    1.0000000  0.18367990 -0.1190667
notSingle    -0.07266786    0.1836799  1.00000000 -0.4547208
meanPPSF      0.19076499   -0.1190667 -0.45472084  1.0000000
> print(dtMerge[order(effectiveAge),.(mean(notSingle,na.rm=TRUE),mean(maxSingle,na.rm=TRUE),.N),by=effectiveAge][1:50])
    effectiveAge        V1         V2     N
           <num>     <num>      <num> <int>
 1:           26 0.5000000 0.50000000     2
 2:           27 0.0000000 1.00000000     3
 3:           28 1.0000000 0.00000000     1
 4:           29 0.5000000 0.50000000     4
 5:           30 0.0000000 1.00000000     4
 6:           31 0.5714286 0.42857143    14
 7:           32 0.2000000 0.80000000    10
 8:           33 0.3333333 0.66666667     6
 9:           34 0.7777778 0.22222222     9
10:           35 0.7500000 0.25000000     8
11:           36 0.7692308 0.23076923    13
12:           37 0.6000000 0.40000000     5
13:           38 0.6000000 0.40000000     5
14:           39 0.8000000 0.20000000     5
15:           40 0.6363636 0.36363636    11
16:           41 0.6111111 0.38888889    18
17:           42 0.6666667 0.33333333     3
18:           43 0.3750000 0.62500000     8
19:           44 0.7272727 0.27272727    22
20:           45 0.6000000 0.40000000    20
21:           46 0.7105263 0.28947368    38
22:           47 0.6315789 0.36842105    19
23:           48 0.8571429 0.14285714    14
24:           49 0.7272727 0.27272727    22
25:           50 0.7600000 0.24000000    25
26:           51 0.7500000 0.25000000    28
27:           52 0.6470588 0.35294118    17
28:           53 0.6000000 0.40000000    15
29:           54 0.6470588 0.35294118    34
30:           55 0.6764706 0.32352941    34
31:           56 0.6774194 0.32258065    62
32:           57 0.7500000 0.25000000    48
33:           58 0.7142857 0.28571429    28
34:           59 0.8490566 0.15094340    53
35:           60 0.7058824 0.29411765    51
36:           61 0.6935484 0.30645161    62
37:           62 0.9523810 0.04761905    21
38:           63 0.8918919 0.10810811    37
39:           64 0.8684211 0.13157895    38
40:           65 0.7200000 0.28000000    50
41:           66 0.8750000 0.12500000    24
42:           67 0.9047619 0.09523810    21
43:           68 0.8125000 0.18750000    16
44:           69 0.7647059 0.23529412    34
45:           70 0.8888889 0.11111111    18
46:           71 0.8260870 0.17391304    23
47:           72 0.6521739 0.34782609    23
48:           73 0.9090909 0.09090909    22
49:           74 0.8750000 0.12500000    24
50:           75 0.9130435 0.08695652    23
    effectiveAge        V1         V2     N
> 
>   ##############
> 
> # aggregate
> dtAgg <- dtMerge[,.(nPermits=.N,
+                       nNotSingle=sum(use!="single" & use!="laneway"),
+                       meanPPSF=mean(meanPPSF,na.rm=TRUE),
+                       slope=mean(slope,na.rm=TRUE),
+                       elasticity=mean(elasticity,na.rm=TRUE),
+                       meanFinishedArea=mean(MB_total_finished_area,na.rm=TRUE),
+                       meanLandArea=mean(LANDAREA,na.rm=TRUE),
+                       meanEffectiveAge=mean(effectiveAge,na.rm=TRUE)),
+                   by=.(CTUID)]
> 
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 76
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)           -0.070207   1.047938 -0.066996 9.4677e-01    
meanPPSF              -0.001777   0.000194 -9.165697 1.0275e-13 ***
log(meanLandArea)     -0.036154   0.041400 -0.873286 3.8541e-01    
log(meanEffectiveAge)  0.526399   0.248865  2.115204 3.7873e-02 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.151064   Adj. R2: 0.615006
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + slope + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 76
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)            0.127333   1.328962  0.095814 9.2394e-01    
meanPPSF              -0.001830   0.000290 -6.299486 2.1987e-08 ***
slope                  0.294597   1.205519  0.244374 8.0765e-01    
log(meanLandArea)     -0.039424   0.043769 -0.900736 3.7077e-01    
log(meanEffectiveAge)  0.498150   0.275892  1.805594 7.5221e-02 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.151   Adj. R2: 0.609912
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + elasticity + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 76
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)           -0.431584   1.155360 -0.373549 7.0985e-01    
meanPPSF              -0.001611   0.000294 -5.479117 6.1414e-07 ***
elasticity            -0.112824   0.149744 -0.753442 4.5368e-01    
log(meanLandArea)     -0.027219   0.043184 -0.630306 5.3052e-01    
log(meanEffectiveAge)  0.590237   0.263603  2.239113 2.8283e-02 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.150463   Adj. R2: 0.61268
> 
> proc.time()
   user  system elapsed 
  3.510   0.154   2.242 
