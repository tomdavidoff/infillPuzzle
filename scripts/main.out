
R version 4.4.0 (2024-04-24) -- "Puppy Cup"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # main.vancouver_permits_
> # main analysis script
> # Tom Davidoff
> # 01/16/26
> 
> library(data.table)
Warning message:
package ‘data.table’ was built under R version 4.4.1 
> library(ggplot2)
> library(fixest)
> 
> # Vancouver analysis # note neighbourhoodDescription better than tract for analysis level
> # get slopes and mean values from BCA sales analysis by census tract merge
> nameSlope <- "tables/bca19_mean_ppsf_slope_by_neighbourhood.csv"
> if (!file.exists(nameSlope)) {
+   source("scripts/bcaSales.R")
+ }
> # specify column CTUID is a number
> dtSlope <- fread(nameSlope)
> 
> # Now get projects merged with BCA and census tracts
> nameSpatial <- "~/OneDrive - UBC/dataProcessed/vancouverPermitLotsTracts.rds"
> if (!file.exists(nameSpatial)) {
+   source("scripts/mergePermitsSpatial.R")
+ }
> dtSpatial <- readRDS(nameSpatial)
> 
> print(head(dtSpatial))
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate     use
       <char>          <char>     <char>                  <IDat>  <char>
1: 9330044.00 001633021620000 A0000000CR              2024-01-17  single
2: 9330029.00 009697153290000 A00000191E              2019-02-21  single
3: 9330030.00 016185716270000 A0000025QE              2018-04-30  single
4: 9330013.01 019237750590000 A000002L99              2025-05-13 laneway
5: 9330018.02 019731227950000 A000002MUD              2022-08-29  single
6: 9330008.02 006769050140000 A000000U30              2021-07-15  single
   MB_effective_year MB_total_finished_area neighbourhoodDescription
              <char>                 <char>                   <char>
1:              1965                   4002               POINT GREY
2:                                                            CAMBIE
3:              2019                   3342              MAIN/FRASER
4:              2007                   2198                   KNIGHT
5:              1962                   2145                   KNIGHT
6:              1978                   3064               SOUTHLANDS
                                        address LANDAREA
                                         <char>    <num>
1:   4632 LANGARA AVENUE, Vancouver, BC V6R 1E1   2.8772
2:     869 W 20TH AVENUE, Vancouver, BC V5Z 1Y3   1.5016
3:     4427 JAMES STREET, Vancouver, BC V5V 3H9   1.4562
4: 5835 ARGYLE STREET #3, Vancouver, BC V6P 3J8   1.1375
5:    1395 E 34TH AVENUE, Vancouver, BC V5W 1A5   0.9880
6:    3280 W 48TH AVENUE, Vancouver, BC V6N 3P8   3.5378
> print(head(dtSlope))
    neighbourhoodDescription meanPPSF  nobs       slope
                      <char>    <num> <int>       <num>
1: ARBUTUS/MACKENZIE HEIGHTS 817.7070   128 -0.01479152
2:                    CAMBIE 786.6326   133 -0.04841163
3:             CEDAR COTTAGE 710.8595   195 -0.06015174
4:               COLLINGWOOD 625.0172   380 -0.06155029
5:                    DUNBAR 814.5198   192 -0.01093593
6:                FRASERVIEW 603.7006   361 -0.06426389
> 
> dtMerge <- merge(dtSpatial,dtSlope,by="neighbourhoodDescription")
> print(head(dtMerge))
Key: <neighbourhoodDescription>
    neighbourhoodDescription      CTUID     ROLL_NUMBER    folioID
                      <char>     <char>          <char>     <char>
1: ARBUTUS/MACKENZIE HEIGHTS 9330026.00 004698070060000 A000000MK2
2: ARBUTUS/MACKENZIE HEIGHTS 9330026.00 004701067070000 A000000MPG
3: ARBUTUS/MACKENZIE HEIGHTS 9330023.00 004726060300000 A000000P3A
4: ARBUTUS/MACKENZIE HEIGHTS 9330023.00 004726054310000 A000000P1R
5: ARBUTUS/MACKENZIE HEIGHTS 9330026.00 004698067070000 A000000MJA
6: ARBUTUS/MACKENZIE HEIGHTS 9330026.00 004710062840000 A000000N4W
   permitnumbercreateddate     use MB_effective_year MB_total_finished_area
                    <IDat>  <char>            <char>                 <char>
1:              2021-05-04  duplex              1940                   1619
2:              2023-03-06  single              1944                   1539
3:              2024-10-11 laneway              1996                   2576
4:              2025-06-06  single              2003                   4339
5:              2023-08-30  single              1970                   1829
6:              2025-10-03 laneway              1970                   3387
                                        address LANDAREA meanPPSF  nobs
                                         <char>    <num>    <num> <int>
1:    2796 W 21ST AVENUE, Vancouver, BC V6L 1K3   1.2593  817.707   128
2:    2893 W 22ND AVENUE, Vancouver, BC V6L 1M7   1.2593  817.707   128
3: 2882 W 32ND AVENUE #3, Vancouver, BC V6L 2B6   1.2002  817.707   128
4:    3131 W 32ND AVENUE, Vancouver, BC V6L 2B9   1.2002  817.707   128
5:    2895 W 21ST AVENUE, Vancouver, BC V6L 1K5   1.2593  817.707   128
6:  2806 W KING EDWARD AVENUE #3, Vancouver, BC   1.2593  817.707   128
         slope
         <num>
1: -0.01479152
2: -0.01479152
3: -0.01479152
4: -0.01479152
5: -0.01479152
6: -0.01479152
> print(summary(dtMerge))
 neighbourhoodDescription    CTUID           ROLL_NUMBER       
 Length:3776              Length:3776        Length:3776       
 Class :character         Class :character   Class :character  
 Mode  :character         Mode  :character   Mode  :character  
                                                               
                                                               
                                                               
   folioID          permitnumbercreateddate     use           
 Length:3776        Min.   :2017-01-03      Length:3776       
 Class :character   1st Qu.:2020-02-18      Class :character  
 Mode  :character   Median :2021-11-27      Mode  :character  
                    Mean   :2021-11-04                        
                    3rd Qu.:2024-02-28                        
                    Max.   :2025-12-01                        
 MB_effective_year  MB_total_finished_area   address             LANDAREA     
 Length:3776        Length:3776            Length:3776        Min.   :0.3178  
 Class :character   Class :character       Class :character   1st Qu.:0.8070  
 Mode  :character   Mode  :character       Mode  :character   Median :1.2002  
                                                              Mean   :1.3046  
                                                              3rd Qu.:1.5340  
                                                              Max.   :3.5378  
    meanPPSF          nobs           slope          
 Min.   :569.0   Min.   : 23.0   Min.   :-0.096203  
 1st Qu.:645.2   1st Qu.:133.0   1st Qu.:-0.071657  
 Median :717.0   Median :361.0   Median :-0.053805  
 Mean   :720.3   Mean   :374.9   Mean   :-0.046394  
 3rd Qu.:793.4   3rd Qu.:592.0   3rd Qu.:-0.012308  
 Max.   :835.9   Max.   :782.0   Max.   : 0.009656  
> print(table(dtMerge[,use]))

 duplex laneway   multi  single 
    770    1625     181    1200 
> # permitnumbercreateddate     use            MB_effective_year 
> # Min.   :2017-01-03      Length:3762        Length:3762       
> 
> dtMerge[,pYear:=year(permitnumbercreateddate)]
> for (y in sort(unique(dtMerge[,pYear]))) {
+   print(y)
+   print(table(dtMerge[pYear==y,use]))
+ }
[1] 2017

laneway  single 
    185     243 
[1] 2018

 duplex laneway  single 
      1      41     196 
[1] 2019

 duplex laneway   multi  single 
     14      58       1     156 
[1] 2020

 duplex laneway   multi  single 
     36     191       1      83 
[1] 2021

 duplex laneway   multi  single 
    275     368       2     161 
[1] 2022

 duplex laneway   multi  single 
    117     203       3      88 
[1] 2023

 duplex laneway   multi  single 
    102     112       4     112 
[1] 2024

 duplex laneway   multi  single 
    131     314      96      95 
[1] 2025

 duplex laneway   multi  single 
     94     153      74      66 
> 
> 
> dtMerge[,MB_total_finished_area:=as.numeric(MB_total_finished_area)]
> dtMerge[,MB_effective_year:=as.numeric(MB_effective_year)]
> dtMerge[,effectiveAge:=pYear - MB_effective_year]
> 
> print(cor(dtMerge[,meanPPSF],dtMerge[,slope],use="complete.obs"))
[1] 0.8653804
> dtMerge[,slopeMean:=mean(slope),by=neighbourhoodDescription]
> 
> # duplex era
> print(summary(feols(use=="duplex" ~ meanPPSF + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023)])))
NOTE: 108 observations removed because of NA and infinite values (RHS: 108, Fixed-effects: 16).
OLS estimation, Dep. Var.: use == "duplex"
Observations: 1,979
Fixed-effects: MB_effective_year: 98
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value   Pr(>|t|)    
meanPPSF                    -0.000830   0.000167 -4.970871 2.8711e-06 ***
log(MB_total_finished_area) -0.120791   0.032476 -3.719419 3.3450e-04 ***
log(LANDAREA)                0.007170   0.021595  0.332045 7.4057e-01    
log(effectiveAge)            0.388012   0.169056  2.295165 2.3878e-02 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.395158     Adj. R2: 0.169685
                 Within R2: 0.041284
Warning message:
In log(effectiveAge) : NaNs produced
> print(summary(feols(use=="duplex" ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023)])))
NOTE: 108 observations removed because of NA and infinite values (RHS: 108, Fixed-effects: 16).
OLS estimation, Dep. Var.: use == "duplex"
Observations: 1,979
Fixed-effects: MB_effective_year: 98
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.000504   0.000204 -2.470189 0.0152502 *  
slope                       -1.076816   0.505955 -2.128284 0.0358476 *  
log(MB_total_finished_area) -0.106898   0.034129 -3.132227 0.0022939 ** 
log(LANDAREA)                0.008239   0.021361  0.385702 0.7005622    
log(effectiveAge)            0.383588   0.166986  2.297123 0.0237616 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.394852     Adj. R2: 0.170525
                 Within R2: 0.042764
Warning message:
In log(effectiveAge) : NaNs produced
> print(summary(feols(use=="single" ~ meanPPSF+ log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023)])))
NOTE: 108 observations removed because of NA and infinite values (RHS: 108, Fixed-effects: 16).
OLS estimation, Dep. Var.: use == "single"
Observations: 1,979
Fixed-effects: MB_effective_year: 98
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error  t value  Pr(>|t|)    
meanPPSF                     0.002261   0.000121 18.71888 < 2.2e-16 ***
log(MB_total_finished_area)  0.061537   0.043328  1.42027 0.1587368    
log(LANDAREA)                0.051944   0.016191  3.20825 0.0018102 ** 
log(effectiveAge)           -0.464374   0.246548 -1.88351 0.0626273 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.371481     Adj. R2: 0.244599
                 Within R2: 0.194276
Warning message:
In log(effectiveAge) : NaNs produced
> print(summary(feols(use=="single" ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023)])))
NOTE: 108 observations removed because of NA and infinite values (RHS: 108, Fixed-effects: 16).
OLS estimation, Dep. Var.: use == "single"
Observations: 1,979
Fixed-effects: MB_effective_year: 98
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error  t value  Pr(>|t|)    
meanPPSF                     0.002624   0.000261 10.07082 < 2.2e-16 ***
slope                       -1.198311   0.696094 -1.72148 0.0883515 .  
log(MB_total_finished_area)  0.076997   0.043660  1.76357 0.0809526 .  
log(LANDAREA)                0.053133   0.016236  3.27263 0.0014769 ** 
log(effectiveAge)           -0.469298   0.248505 -1.88849 0.0619488 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.371079     Adj. R2: 0.245831
                 Within R2: 0.196018
Warning message:
In log(effectiveAge) : NaNs produced
> print(summary(feols(use=="laneway" ~ meanPPSF+ log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023)])))
NOTE: 108 observations removed because of NA and infinite values (RHS: 108, Fixed-effects: 16).
OLS estimation, Dep. Var.: use == "laneway"
Observations: 1,979
Fixed-effects: MB_effective_year: 98
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value   Pr(>|t|)    
meanPPSF                    -0.001492   0.000219 -6.813145 8.0662e-10 ***
log(MB_total_finished_area)  0.057282   0.046222  1.239264 2.1824e-01    
log(LANDAREA)               -0.057985   0.027989 -2.071738 4.0944e-02 *  
log(effectiveAge)            0.040037   0.303503  0.131918 8.9532e-01    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.456871     Adj. R2: 0.115133
                 Within R2: 0.058904
Warning message:
In log(effectiveAge) : NaNs produced
> print(summary(feols(use=="laneway" ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023)])))
NOTE: 108 observations removed because of NA and infinite values (RHS: 108, Fixed-effects: 16).
OLS estimation, Dep. Var.: use == "laneway"
Observations: 1,979
Fixed-effects: MB_effective_year: 98
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value   Pr(>|t|)    
meanPPSF                    -0.002225   0.000344 -6.460231 4.1791e-09 ***
slope                        2.422218   0.775308  3.124199 2.3514e-03 ** 
log(MB_total_finished_area)  0.026031   0.046464  0.560245 5.7660e-01    
log(LANDAREA)               -0.060389   0.027392 -2.204632 2.9844e-02 *  
log(effectiveAge)            0.049989   0.303920  0.164481 8.6969e-01    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.455535     Adj. R2: 0.119833
                 Within R2: 0.064402
Warning message:
In log(effectiveAge) : NaNs produced
> 
> # non-laneway
> print(summary(feols(use=="duplex" ~ meanPPSF + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023) & use!="laneway"])))
NOTE: 91 observations removed because of NA and infinite values (RHS: 91, Fixed-effects: 14).
OLS estimation, Dep. Var.: use == "duplex"
Observations: 1,064
Fixed-effects: MB_effective_year: 89
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error    t value  Pr(>|t|)    
meanPPSF                    -0.002794   0.000196 -14.283264 < 2.2e-16 ***
log(MB_total_finished_area) -0.062925   0.049992  -1.258701   0.21147    
log(LANDAREA)                0.000958   0.020085   0.047674   0.96208    
log(effectiveAge)            0.517275   0.256323   2.018063   0.04663 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.370085     Adj. R2: 0.400135
                 Within R2: 0.224804
Warning message:
In log(effectiveAge) : NaNs produced
> print(summary(feols(use=="duplex" ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023) & use!="laneway"])))
NOTE: 91 observations removed because of NA and infinite values (RHS: 91, Fixed-effects: 14).
OLS estimation, Dep. Var.: use == "duplex"
Observations: 1,064
Fixed-effects: MB_effective_year: 89
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value   Pr(>|t|)    
meanPPSF                    -0.003314   0.000409 -8.107436 2.7959e-12 ***
slope                        1.624374   1.021226  1.590612 1.1528e-01    
log(MB_total_finished_area) -0.081930   0.049524 -1.654358 1.0162e-01    
log(LANDAREA)               -0.002236   0.019480 -0.114773 9.0889e-01    
log(effectiveAge)            0.541898   0.264576  2.048173 4.3523e-02 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.36941     Adj. R2: 0.401708
                Within R2: 0.227633
Warning message:
In log(effectiveAge) : NaNs produced
> 
> # non-single
> print(summary(feols(use=="duplex" ~ meanPPSF + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023) & use!="single"])))
NOTE: 23 observations removed because of NA and infinite values (RHS: 23, Fixed-effects: 5).
OLS estimation, Dep. Var.: use == "duplex"
Observations: 1,464
Fixed-effects: MB_effective_year: 95
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.000173   0.000189 -0.916768 0.3616102    
log(MB_total_finished_area) -0.184215   0.056594 -3.255043 0.0015767 ** 
log(LANDAREA)                0.017658   0.032207  0.548265 0.5848096    
log(effectiveAge)            0.629812   0.274342  2.295723 0.0239146 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.425188     Adj. R2: 0.167038
                 Within R2: 0.017352
Warning message:
In log(effectiveAge) : NaNs produced
> print(summary(feols(use=="duplex" ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2019,2023) & use!="single"])))
NOTE: 23 observations removed because of NA and infinite values (RHS: 23, Fixed-effects: 5).
OLS estimation, Dep. Var.: use == "duplex"
Observations: 1,464
Fixed-effects: MB_effective_year: 95
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                     0.000439   0.000260  1.688059 0.0947152 .  
slope                       -2.106930   0.715998 -2.942649 0.0040985 ** 
log(MB_total_finished_area) -0.160081   0.055497 -2.884506 0.0048608 ** 
log(LANDAREA)                0.016344   0.031718  0.515296 0.6075560    
log(effectiveAge)            0.612874   0.272374  2.250118 0.0267738 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.424113     Adj. R2: 0.170636
                 Within R2: 0.022314
Warning message:
In log(effectiveAge) : NaNs produced
> 
> # multiplex era
> print(summary(feols(use=="multi" ~ meanPPSF + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2024,2025)])))
OLS estimation, Dep. Var.: use == "multi"
Observations: 1,023
Fixed-effects: MB_effective_year: 90
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.000286   0.000200 -1.433778 0.1551397    
log(MB_total_finished_area)  0.137291   0.045701  3.004084 0.0034591 ** 
log(LANDAREA)               -0.028051   0.024186 -1.159830 0.2492200    
log(effectiveAge)            0.361195   0.470677  0.767394 0.4448783    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.340874     Adj. R2: 0.077479
                 Within R2: 0.012244
> print(summary(feols(use=="multi" ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | + MB_effective_year,data=dtMerge[pYear %between% c(2024,2025)])))
OLS estimation, Dep. Var.: use == "multi"
Observations: 1,023
Fixed-effects: MB_effective_year: 90
Standard-errors: Clustered (MB_effective_year) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.000168   0.000281 -0.597776 0.551508    
slope                       -0.367293   0.560004 -0.655876 0.513596    
log(MB_total_finished_area)  0.142981   0.046094  3.101931 0.002576 ** 
log(LANDAREA)               -0.028905   0.024321 -1.188457 0.237815    
log(effectiveAge)            0.377970   0.461193  0.819548 0.414663    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.340838     Adj. R2: 0.07668 
                 Within R2: 0.012453
> 
> 
> 
> proc.time()
   user  system elapsed 
  1.051   0.082   0.570 
