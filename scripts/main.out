
R version 4.4.0 (2024-04-24) -- "Puppy Cup"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # main.vancouver_permits_
> # main analysis script
> # Tom Davidoff
> # 01/16/26
> 
> library(data.table)
Warning message:
package ‘data.table’ was built under R version 4.4.1 
> library(ggplot2)
> library(fixest)
> 
> # Vancouver analysis # note neighbourhoodDescription better than tract for analysis level
> # get slopes and mean values from BCA sales analysis by census tract merge
> nameSlope <- "tables/bca19_mean_ppsf_slope_by_tract.csv"
> if (!file.exists(nameSlope)) {
+   source("scripts/bcaSales.R")
+ }
> # specify column CTUID is a number
> dtSlope <- fread(nameSlope,colClasses=c(CTUID="character"))
> # giant outlier at low obs
> CUTOFFN <- .05
> dtSlope <- dtSlope[nobs>quantile(nobs,CUTOFFN)]
> 
> # Now get projects merged with BCA and census tracts
> nameSpatial <- "~/OneDrive - UBC/dataProcessed/vancouverPermitLotsTracts.rds"
> if (!file.exists(nameSpatial)) {
+   source("scripts/mergePermitsSpatial.R")
+ }
> dtSpatial <- readRDS(nameSpatial)
> 
> print(head(dtSpatial))
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate     use
       <char>          <char>     <char>                  <IDat>  <char>
1: 9330044.00 001633021620000 A0000000CR              2024-01-17  single
2: 9330029.00 009697153290000 A00000191E              2019-02-21  single
3: 9330030.00 016185716270000 A0000025QE              2018-04-30  single
4: 9330013.01 019237750590000 A000002L99              2025-05-13 laneway
5: 9330008.02 006769050140000 A000000U30              2021-07-15  single
6: 9330043.02 001650034570000 A0000001L4              2024-11-27 laneway
   MB_effective_year MB_total_finished_area neighbourhoodDescription
              <char>                 <char>                   <char>
1:              1965                   4002               POINT GREY
2:                                                            CAMBIE
3:              2019                   3342              MAIN/FRASER
4:              2007                   2198                   KNIGHT
5:              1978                   3064               SOUTHLANDS
6:              1975                   2764               POINT GREY
                                        address LANDAREA landWidth landDepth
                                         <char>    <num>    <char>    <char>
1:   4632 LANGARA AVENUE, Vancouver, BC V6R 1E1   2.8772        65       110
2:     869 W 20TH AVENUE, Vancouver, BC V5Z 1Y3   1.5016        33       122
3:     4427 JAMES STREET, Vancouver, BC V5V 3H9   1.4562      49.5       111
4: 5835 ARGYLE STREET #3, Vancouver, BC V6P 3J8   1.1375        33       122
5:    3280 W 48TH AVENUE, Vancouver, BC V6N 3P8   3.5378     65.99    164.84
6:    3863 W BROADWAY #3, Vancouver, BC V6R 2C2   0.9967     58.54    108.84
               geo_point_2d
                     <char>
1: 49.2729074, -123.2125593
2: 49.2537249, -123.1237645
3: 49.2456172, -123.1042038
4: 49.2313344, -123.0719816
5: 49.2281967, -123.1779482
6:  49.2647127, -123.189698
> print(head(dtSlope))
        CTUID meanPPSF  nobs       slope  elasticity
       <char>    <num> <int>       <num>       <num>
1:            720.9720    22          NA          NA
2: 9330001.02 566.3632     9          NA          NA
3: 9330002.01 626.5062    52  0.13265622  0.78731774
4: 9330002.03 614.8959    66  0.00637558 -0.07086556
5: 9330002.04 587.9429    38 -0.05662621 -0.68063012
6: 9330003.01 612.5530    55 -0.03944115 -0.12328405
> 
> dtMerge <- merge(dtSpatial,dtSlope,by="CTUID")
> print(head(dtMerge))
Key: <CTUID>
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate    use
       <char>          <char>     <char>                  <IDat> <char>
1: 9330001.02 025821302570000 A000003GB0              2022-06-27 duplex
2: 9330001.02 025821302870000 A000003GB3              2018-08-23 single
3: 9330001.02 025821306320000 A000003GBH              2021-08-13 duplex
4: 9330001.02 025818302040000 A000003G6M              2021-09-20 duplex
5: 9330002.01 025270817560000 A000003DPP              2021-12-01 single
6: 9330002.01 025813270050000 A000003FS4              2021-06-14 duplex
   MB_effective_year MB_total_finished_area neighbourhoodDescription
              <char>                 <char>                   <char>
1:              1973                   3846               FRASERVIEW
2:              2019                   2566               FRASERVIEW
3:              1973                   3082               FRASERVIEW
4:              1974                   3220               FRASERVIEW
5:              1963                   2008               FRASERVIEW
6:              1970                   2316               FRASERVIEW
                                       address LANDAREA landWidth landDepth
                                        <char>    <num>    <char>    <char>
1:   3141 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621        55       115
2:   3157 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621        55       115
3:   3210 E 62ND AVENUE, Vancouver, BC V5S 2G5   1.8621        50       140
4: 7726 MUNROE CRESCENT, Vancouver, BC V5S 3J9   1.8621        52       115
5:  7770 ELLIOTT STREET, Vancouver, BC V5S 2N9   1.9403                    
6:  7376 ELLIOTT STREET, Vancouver, BC V5S 2N5   1.9403                    
               geo_point_2d meanPPSF  nobs     slope elasticity
                     <char>    <num> <int>     <num>      <num>
1:   49.21401, -123.0392725 566.3632     9        NA         NA
2: 49.2140062, -123.0388062 566.3632     9        NA         NA
3: 49.2132602, -123.0365756 566.3632     9        NA         NA
4: 49.2143439, -123.0399512 566.3632     9        NA         NA
5: 49.2138533, -123.0545981 626.5062    52 0.1326562  0.7873177
6: 49.2174104, -123.0535628 626.5062    52 0.1326562  0.7873177
> print(summary(dtMerge))
    CTUID           ROLL_NUMBER          folioID         
 Length:2362        Length:2362        Length:2362       
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
                                                         
 permitnumbercreateddate     use            MB_effective_year 
 Min.   :2017-01-04      Length:2362        Length:2362       
 1st Qu.:2020-09-28      Class :character   Class :character  
 Median :2022-06-21      Mode  :character   Mode  :character  
 Mean   :2022-04-13                                           
 3rd Qu.:2024-07-30                                           
 Max.   :2025-10-17                                           
                                                              
 MB_total_finished_area neighbourhoodDescription   address         
 Length:2362            Length:2362              Length:2362       
 Class :character       Class :character         Class :character  
 Mode  :character       Mode  :character         Mode  :character  
                                                                   
                                                                   
                                                                   
                                                                   
    LANDAREA       landWidth          landDepth         geo_point_2d      
 Min.   :0.4194   Length:2362        Length:2362        Length:2362       
 1st Qu.:0.8985   Class :character   Class :character   Class :character  
 Median :1.2593   Mode  :character   Mode  :character   Mode  :character  
 Mean   :1.3036                                                           
 3rd Qu.:1.5016                                                           
 Max.   :3.5378                                                           
                                                                          
    meanPPSF          nobs           slope             elasticity      
 Min.   :566.4   Min.   :  7.0   Min.   :-0.189986   Min.   :-0.92713  
 1st Qu.:657.3   1st Qu.: 30.0   1st Qu.: 0.009014   1st Qu.: 0.05855  
 Median :745.0   Median : 49.0   Median : 0.091240   Median : 0.38630  
 Mean   :730.3   Mean   : 53.3   Mean   : 0.089099   Mean   : 0.46680  
 3rd Qu.:798.6   3rd Qu.: 69.0   3rd Qu.: 0.135894   3rd Qu.: 0.89193  
 Max.   :867.2   Max.   :155.0   Max.   : 0.502588   Max.   : 2.40873  
                                 NA's   :9           NA's   :9         
> print(table(dtMerge[,use]))

 duplex laneway   multi  single 
    760     510     173     919 
> # permitnumbercreateddate     use            MB_effective_year 
> # Min.   :2017-01-03      Length:3762        Length:3762       
> 
> dtMerge[,pYear:=year(permitnumbercreateddate)]
> for (y in sort(unique(dtMerge[,pYear]))) {
+   print(y)
+   print(table(dtMerge[pYear==y,use]))
+ }
[1] 2017

laneway  single 
      8     209 
[1] 2018

 duplex laneway  single 
      1       2     153 
[1] 2019

 duplex laneway   multi  single 
     14       2       1     127 
[1] 2020

 duplex laneway   multi  single 
     34       8       1      65 
[1] 2021

 duplex laneway   multi  single 
    272      14       2     152 
[1] 2022

 duplex laneway   multi  single 
    116       7       3      77 
[1] 2023

 duplex laneway   multi  single 
    101      41       3      66 
[1] 2024

 duplex laneway   multi  single 
    129     290      95      48 
[1] 2025

 duplex laneway   multi  single 
     93     138      68      22 
> 
> 
> dtMerge[,MB_total_finished_area:=as.numeric(MB_total_finished_area)]
> dtMerge[,MB_effective_year:=as.numeric(MB_effective_year)]
> dtMerge[,landWidth:=as.numeric(landWidth)]
> dtMerge[,landDepth:=as.numeric(landDepth)]
> dtMerge[,effectiveAge:=pYear - MB_effective_year]
> # No duplexes under 25 years old (?)
> dtMerge <- dtMerge[effectiveAge>25]
> print(summary(dtMerge[,.(MB_total_finished_area,landWidth,landDepth,effectiveAge)]))
 MB_total_finished_area   landWidth        landDepth      effectiveAge   
 Min.   : 466           Min.   : 16.50   Min.   : 50.0   Min.   : 26.00  
 1st Qu.:1733           1st Qu.: 33.00   1st Qu.:115.3   1st Qu.: 47.00  
 Median :2097           Median : 33.04   Median :122.0   Median : 58.00  
 Mean   :2242           Mean   : 40.98   Mean   :122.4   Mean   : 56.68  
 3rd Qu.:2541           3rd Qu.: 49.49   3rd Qu.:125.2   3rd Qu.: 66.00  
 Max.   :7768           Max.   :126.50   Max.   :331.0   Max.   :114.00  
                        NA's   :112      NA's   :112                     
> 
> dtMerge[,notSingle:=use!="single" & use!="laneway"]
> # use geo_point_2d to plot variable notSingle by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=notSingle)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Not Single Family (including laneway) Permits")
>   ggsave("text/notSingleLocation.png",width=8,height=6)
> 
>   # now plot meanPPSF by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=meanPPSF)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Mean PPSF from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/meanPPSFLocation.png",width=8,height=6)
> 
>   # now plot elasticity by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=elasticity)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Elasticity from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/elasticityLocation.png",width=8,height=6)
> 
>   # and slope
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=slope)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Slope from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/slopeLocation.png",width=8,height=6)
> 
>   # mean notSingle by meanPPSF x-y plot
>   dtTract <- dtMerge[pYear>2020,.(notSingle=mean(notSingle,na.rm=TRUE), nobs=mean(nobs),
+                           meanPPSF=mean(meanPPSF,na.rm=TRUE), slope=mean(slope,na.rm=TRUE), elasticity=mean(elasticity,na.rm=TRUE)),
+                       by=.(neighbourhoodDescription)]
>   ggplot(dtTract,aes(x=meanPPSF,y=notSingle)) + geom_point() 
>   ggsave("text/notSingle_vs_meanPPSF.png",width=8,height=6)
> 
>   # ppsf and slope -- make points proportional to nobs
>   ggplot(dtTract,aes(x=meanPPSF,y=slope)) + geom_point(aes(size=nobs)) +
+     theme_minimal() 
>   ggsave("text/ppsfSlopeTract.png",width=8,height=6)
> 
> print(cor(dtTract[,.(notSingle,meanPPSF,slope,elasticity)],use="complete.obs"))
            notSingle   meanPPSF      slope elasticity
notSingle   1.0000000 -0.6688788 -0.2413112 -0.5142478
meanPPSF   -0.6688788  1.0000000  0.3384680  0.6640194
slope      -0.2413112  0.3384680  1.0000000  0.8885614
elasticity -0.5142478  0.6640194  0.8885614  1.0000000
> print(summary(lm(notSingle ~ meanPPSF,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.30649 -0.08178 -0.01937  0.07956  0.30485 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.7723896  0.3106326   5.706 1.39e-05 ***
meanPPSF    -0.0016993  0.0004223  -4.024 0.000665 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1483 on 20 degrees of freedom
Multiple R-squared:  0.4474,	Adjusted R-squared:  0.4198 
F-statistic: 16.19 on 1 and 20 DF,  p-value: 0.0006651

> print(summary(lm(notSingle ~ meanPPSF + slope ,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + slope, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.30851 -0.08349 -0.01543  0.08038  0.30002 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.7691874  0.3204858   5.520 2.52e-05 ***
meanPPSF    -0.0016848  0.0004603  -3.660  0.00166 ** 
slope       -0.0861221  0.9262751  -0.093  0.92690    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1521 on 19 degrees of freedom
Multiple R-squared:  0.4477,	Adjusted R-squared:  0.3895 
F-statistic: 7.699 on 2 and 19 DF,  p-value: 0.003557

> print(summary(lm(notSingle ~ meanPPSF + elasticity ,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + elasticity, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.30923 -0.08628  0.01198  0.08475  0.27850 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  1.6578427  0.3777341   4.389 0.000316 ***
meanPPSF    -0.0014878  0.0005748  -2.588 0.018031 *  
elasticity  -0.0882473  0.1592471  -0.554 0.585938    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1509 on 19 degrees of freedom
Multiple R-squared:  0.4562,	Adjusted R-squared:  0.3989 
F-statistic: 7.969 on 2 and 19 DF,  p-value: 0.003067

> # combinedera
> print(summary(feols(notSingle ~ meanPPSF  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,547
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
          Estimate Std. Error  t value Pr(>|t|) 
meanPPSF -0.001503   0.000805 -1.86724  0.13526 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.477089     Adj. R2: 0.068599
                 Within R2: 0.055629
> print(summary(feols(notSingle ~ slope  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
NOTE: 7 observations removed because of NA values (RHS: 7).
OLS estimation, Dep. Var.: notSingle
Observations: 1,540
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
       Estimate Std. Error   t value Pr(>|t|) 
slope -0.060357   0.079484 -0.759358  0.48993 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.4909     Adj. R2: 0.013883
               Within R2: 1.825e-4
> print(summary(feols(notSingle ~ elasticity  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
NOTE: 7 observations removed because of NA values (RHS: 7).
OLS estimation, Dep. Var.: notSingle
Observations: 1,540
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
            Estimate Std. Error  t value Pr(>|t|) 
elasticity -0.054616   0.034985 -1.56114  0.19352 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.489926     Adj. R2: 0.017794
                 Within R2: 0.004147
> print(summary(feols(notSingle ~ meanPPSF + elasticity  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
NOTE: 7 observations removed because of NA values (RHS: 7).
OLS estimation, Dep. Var.: notSingle
Observations: 1,540
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
            Estimate Std. Error  t value Pr(>|t|) 
meanPPSF   -0.001575   0.000816 -1.93005  0.12581 
elasticity  0.022007   0.014650  1.50217  0.20747 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.476828     Adj. R2: 0.069003
                 Within R2: 0.056683
> print(summary(feols(notSingle ~ meanPPSF + slope  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
NOTE: 7 observations removed because of NA values (RHS: 7).
OLS estimation, Dep. Var.: notSingle
Observations: 1,540
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
          Estimate Std. Error  t value Pr(>|t|)    
meanPPSF -0.001560   0.000823 -1.89649 0.130767    
slope     0.159246   0.074303  2.14321 0.098732 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.476667     Adj. R2: 0.069631
                 Within R2: 0.057319
> print(summary(feols(notSingle ~ meanPPSF + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,547
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error  t value Pr(>|t|)    
meanPPSF                    -0.001011   0.000689 -1.46843 0.215907    
log(MB_total_finished_area) -0.222556   0.048472 -4.59146 0.010096 *  
log(LANDAREA)               -0.038627   0.021132 -1.82792 0.141569    
log(effectiveAge)            0.459820   0.062103  7.40411 0.001775 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.443856     Adj. R2: 0.192269
                 Within R2: 0.182615
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
NOTE: 3 observations removed because of NA values (RHS: 3).
OLS estimation, Dep. Var.: notSingle
Observations: 222
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001373   0.000635 -2.162158 0.096655 .  
slope                       -0.337501   0.366453 -0.920994 0.409173    
log(MB_total_finished_area) -0.404102   0.155662 -2.596024 0.060300 .  
log(LANDAREA)               -0.096564   0.071390 -1.352615 0.247585    
log(effectiveAge)            0.154736   0.061759  2.505501 0.066375 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.42989     Adj. R2: 0.228831
                Within R2: 0.175484
> print(summary(feols(notSingle ~ meanPPSF+ log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 225
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001731   0.000686 -2.524257 0.065061 .  
log(MB_total_finished_area) -0.360843   0.124617 -2.895618 0.044312 *  
log(LANDAREA)               -0.070377   0.074812 -0.940722 0.400110    
log(effectiveAge)            0.172101   0.071254  2.415324 0.073132 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.430367     Adj. R2: 0.231562
                 Within R2: 0.176213
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
NOTE: 3 observations removed because of NA values (RHS: 3).
OLS estimation, Dep. Var.: notSingle
Observations: 222
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001260   0.000483 -2.609499 0.059451 .  
elasticity                  -0.073259   0.081287 -0.901235 0.418422    
log(MB_total_finished_area) -0.399216   0.162776 -2.452549 0.070252 .  
log(LANDAREA)               -0.092795   0.069947 -1.326661 0.255292    
log(effectiveAge)            0.160306   0.057396  2.792960 0.049163 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.42956     Adj. R2: 0.230017
                Within R2: 0.176751
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(30,36) & pYear %between% c(2021,2025)])))
NOTE: 3 observations removed because of NA values (RHS: 3).
OLS estimation, Dep. Var.: notSingle
Observations: 820
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.000601   0.000600 -1.001666 0.3731863    
slope                        0.307328   0.102573  2.996190 0.0400924 *  
log(MB_total_finished_area) -0.125654   0.061758 -2.034625 0.1116238    
log(LANDAREA)                0.016573   0.048230  0.343629 0.7484275    
log(effectiveAge)            0.604248   0.091372  6.613049 0.0027107 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.434392     Adj. R2: 0.171661
                 Within R2: 0.160359
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(30,36) & pYear %between% c(2021,2025)])))
NOTE: 3 observations removed because of NA values (RHS: 3).
OLS estimation, Dep. Var.: notSingle
Observations: 820
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.000693   0.000590 -1.174660 0.3052861    
elasticity                   0.075109   0.021910  3.428073 0.0265825 *  
log(MB_total_finished_area) -0.127299   0.061000 -2.086886 0.1052004    
log(LANDAREA)                0.018263   0.047370  0.385551 0.7194559    
log(effectiveAge)            0.603760   0.091474  6.600342 0.0027301 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.43405     Adj. R2: 0.172962
                Within R2: 0.161679
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
NOTE: 7 observations removed because of NA values (RHS: 7).
OLS estimation, Dep. Var.: notSingle
Observations: 1,540
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error  t value  Pr(>|t|)    
meanPPSF                    -0.001038   0.000688 -1.50729 0.2062165    
slope                        0.141105   0.039706  3.55377 0.0237182 *  
log(MB_total_finished_area) -0.230764   0.047911 -4.81649 0.0085448 ** 
log(LANDAREA)               -0.037851   0.022192 -1.70560 0.1632793    
log(effectiveAge)            0.456106   0.065546  6.95860 0.0022414 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.44312     Adj. R2: 0.194401
                Within R2: 0.185338
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
NOTE: 7 observations removed because of NA values (RHS: 7).
OLS estimation, Dep. Var.: notSingle
Observations: 1,540
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error  t value  Pr(>|t|)    
meanPPSF                    -0.001056   0.000667 -1.58322 0.1885410    
elasticity                   0.022677   0.009492  2.38911 0.0752408 .  
log(MB_total_finished_area) -0.232316   0.048440 -4.79592 0.0086739 ** 
log(LANDAREA)               -0.038939   0.021497 -1.81137 0.1443165    
log(effectiveAge)            0.455245   0.065257  6.97622 0.0022203 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.443211     Adj. R2: 0.194071
                 Within R2: 0.185004
> 
> print(cor(dtMerge[effectiveAge>2,.(MB_total_finished_area/landWidth,effectiveAge,notSingle,meanPPSF)],use="complete.obs"))
                     V1 effectiveAge  notSingle    meanPPSF
V1            1.0000000  -0.45195854 -0.2343067  0.11713177
effectiveAge -0.4519585   1.00000000  0.3210569 -0.06826684
notSingle    -0.2343067   0.32105694  1.0000000 -0.25832644
meanPPSF      0.1171318  -0.06826684 -0.2583264  1.00000000
> print(dtMerge[order(effectiveAge),.(mean(notSingle,na.rm=TRUE),.N),by=effectiveAge][1:50])
    effectiveAge         V1     N
           <num>      <num> <int>
 1:           26 0.08333333    12
 2:           27 0.00000000    15
 3:           28 0.06250000    16
 4:           29 0.07407407    27
 5:           30 0.00000000    18
 6:           31 0.34615385    26
 7:           32 0.09090909    22
 8:           33 0.10000000    20
 9:           34 0.25000000    28
10:           35 0.35294118    17
11:           36 0.38461538    26
12:           37 0.30000000    10
13:           38 0.37500000     8
14:           39 0.19047619    21
15:           40 0.42105263    19
16:           41 0.44000000    25
17:           42 0.22222222     9
18:           43 0.17647059    17
19:           44 0.64000000    25
20:           45 0.50000000    24
21:           46 0.67567568    37
22:           47 0.50000000    22
23:           48 0.52173913    23
24:           49 0.39024390    41
25:           50 0.53333333    30
26:           51 0.65625000    32
27:           52 0.60000000    20
28:           53 0.40909091    22
29:           54 0.48979592    49
30:           55 0.48936170    47
31:           56 0.63235294    68
32:           57 0.67924528    53
33:           58 0.50000000    40
34:           59 0.64285714    70
35:           60 0.56451613    62
36:           61 0.58333333    72
37:           62 0.76000000    25
38:           63 0.80952381    42
39:           64 0.68000000    50
40:           65 0.56451613    62
41:           66 0.84000000    25
42:           67 0.61290323    31
43:           68 0.68421053    19
44:           69 0.70588235    34
45:           70 0.71428571    21
46:           71 0.76923077    26
47:           72 0.53571429    28
48:           73 0.74074074    27
49:           74 0.68965517    29
50:           75 0.78571429    28
    effectiveAge         V1     N
> 
>   ##############
> 
> # aggregate
> dtAgg <- dtMerge[,.(nPermits=.N,
+                       nNotSingle=sum(use!="single" & use!="laneway"),
+                       meanPPSF=mean(meanPPSF,na.rm=TRUE),
+                       slope=mean(slope,na.rm=TRUE),
+                       elasticity=mean(elasticity,na.rm=TRUE),
+                       meanFinishedArea=mean(MB_total_finished_area,na.rm=TRUE),
+                       meanLandArea=mean(LANDAREA,na.rm=TRUE),
+                       meanEffectiveAge=mean(effectiveAge,na.rm=TRUE)),
+                   by=.(CTUID)]
> 
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 69
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)           -2.643437   1.079350 -2.449101 1.7027e-02 *  
meanPPSF              -0.001326   0.000258 -5.136890 2.7520e-06 ***
log(meanLandArea)     -0.028517   0.044664 -0.638465 5.2541e-01    
log(meanEffectiveAge)  1.026192   0.260996  3.931830 2.0724e-04 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.150086   Adj. R2: 0.438099
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + slope + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
NOTE: 2 observations removed because of NA values (RHS: 2).
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 67
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)           -3.226045   1.061747 -3.038431 3.4784e-03 ** 
meanPPSF              -0.001163   0.000256 -4.552046 2.5365e-05 ***
slope                  0.077596   0.142982  0.542702 5.8928e-01    
log(meanLandArea)     -0.055738   0.041888 -1.330646 1.8818e-01    
log(meanEffectiveAge)  1.139998   0.251937  4.524935 2.7931e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.135659   Adj. R2: 0.495515
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + elasticity + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
NOTE: 2 observations removed because of NA values (RHS: 2).
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 67
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)           -3.221338   1.066010 -3.021864 3.6483e-03 ** 
meanPPSF              -0.001163   0.000266 -4.375728 4.7261e-05 ***
elasticity             0.008158   0.028551  0.285754 7.7602e-01    
log(meanLandArea)     -0.057377   0.041862 -1.370616 1.7544e-01    
log(meanEffectiveAge)  1.139476   0.252467  4.513364 2.9102e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.135891   Adj. R2: 0.493785
> 
> proc.time()
   user  system elapsed 
  3.617   0.150   2.343 
