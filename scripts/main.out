
R version 4.5.0 (2025-04-11) -- "How About a Twenty-Six"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # main.R
> # main analysis script
> # Tom Davidoff
> # 01/16/26
> 
> library(data.table)
> library(ggplot2)
> library(fixest)
> 
> # Vancouver analysis # note neighbourhoodDescription better than tract for analysis level
> # get slopes and mean values from BCA sales analysis by census tract merge
> nameSlope <- "tables/bca19_mean_ppsf_slope_by_tract.csv"
> if (!file.exists(nameSlope)) {
+   source("scripts/bcaSales.R")
+ }
> # specify column CTUID is a number
> dtSlope <- fread(nameSlope,colClasses=c(CTUID="character"))
> # giant outlier at low obs
> CUTOFFN <- .05
> dtSlope <- dtSlope[nobs>quantile(nobs,CUTOFFN)]
> 
> # Now get projects merged with BCA and census tracts
> nameSpatial <- "~/OneDrive - UBC/dataProcessed/vancouverPermitLotsTracts.rds"
> if (!file.exists(nameSpatial)) {
+   source("scripts/mergePermitsSpatial.R")
+ }
> dtSpatial <- readRDS(nameSpatial)
> 
> print(head(dtSpatial))
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate     use
       <char>          <char>     <char>                  <IDat>  <char>
1: 9330044.00 001633021620000 A0000000CR              2024-01-17  single
2: 9330029.00 009697153290000 A00000191E              2019-02-21  single
3: 9330030.00 016185716270000 A0000025QE              2018-04-30  single
4: 9330013.01 019237750590000 A000002L99              2025-05-13 laneway
5: 9330008.02 006769050140000 A000000U30              2021-07-15  single
6: 9330043.02 001650034570000 A0000001L4              2024-11-27 laneway
   maxSingle MB_effective_year MB_total_finished_area neighbourhoodDescription
       <int>            <char>                 <char>                   <char>
1:         1              1965                   4002               POINT GREY
2:         1                                                            CAMBIE
3:         1              2019                   3342              MAIN/FRASER
4:         0              2007                   2198                   KNIGHT
5:         1              1978                   3064               SOUTHLANDS
6:         0              1975                   2764               POINT GREY
                                        address LANDAREA landWidth landDepth
                                         <char>    <num>    <char>    <char>
1:   4632 LANGARA AVENUE, Vancouver, BC V6R 1E1   2.8772        65       110
2:     869 W 20TH AVENUE, Vancouver, BC V5Z 1Y3   1.5016        33       122
3:     4427 JAMES STREET, Vancouver, BC V5V 3H9   1.4562      49.5       111
4: 5835 ARGYLE STREET #3, Vancouver, BC V6P 3J8   1.1375        33       122
5:    3280 W 48TH AVENUE, Vancouver, BC V6N 3P8   3.5378     65.99    164.84
6:    3863 W BROADWAY #3, Vancouver, BC V6R 2C2   0.9967     58.54    108.84
               geo_point_2d            typeofwork
                     <char>                <char>
1: 49.2729074, -123.2125593 Addition / Alteration
2: 49.2537249, -123.1237645          New Building
3: 49.2456172, -123.1042038          New Building
4: 49.2313344, -123.0719816          New Building
5: 49.2281967, -123.1779482          New Building
6:  49.2647127, -123.189698          New Building
> print(head(dtSlope))
        CTUID meanPPSF  nobs      slope elasticity
       <char>    <num> <int>      <num>      <num>
1:            732.2076     7         NA         NA
2: 9330001.02 603.2265    10 -0.3711131 -0.8065417
3: 9330002.01 631.6724    54 -0.3260755 -0.5973253
4: 9330002.03 614.8959    66 -0.3021881 -0.6117229
5: 9330002.04 586.0877    37 -0.3341864 -0.7916304
6: 9330003.01 612.5530    55 -0.3039813 -0.3420110
> 
> dtMerge <- merge(dtSpatial,dtSlope,by="CTUID")
> print(head(dtMerge))
Key: <CTUID>
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate    use
       <char>          <char>     <char>                  <IDat> <char>
1: 9330001.02 025821302570000 A000003GB0              2022-06-27 duplex
2: 9330001.02 025821302870000 A000003GB3              2018-08-23 single
3: 9330001.02 025821306320000 A000003GBH              2021-08-13 duplex
4: 9330001.02 025818302040000 A000003G6M              2021-09-20 duplex
5: 9330002.01 025270817560000 A000003DPP              2021-12-01 single
6: 9330002.01 025813270050000 A000003FS4              2021-06-14 duplex
   maxSingle MB_effective_year MB_total_finished_area neighbourhoodDescription
       <int>            <char>                 <char>                   <char>
1:         0              1973                   3846               FRASERVIEW
2:         1              2019                   2566               FRASERVIEW
3:         0              1973                   3082               FRASERVIEW
4:         0              1974                   3220               FRASERVIEW
5:         1              1963                   2008               FRASERVIEW
6:         0              1970                   2316               FRASERVIEW
                                       address LANDAREA landWidth landDepth
                                        <char>    <num>    <char>    <char>
1:   3141 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621        55       115
2:   3157 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621        55       115
3:   3210 E 62ND AVENUE, Vancouver, BC V5S 2G5   1.8621        50       140
4: 7726 MUNROE CRESCENT, Vancouver, BC V5S 3J9   1.8621        52       115
5:  7770 ELLIOTT STREET, Vancouver, BC V5S 2N9   1.9403                    
6:  7376 ELLIOTT STREET, Vancouver, BC V5S 2N5   1.9403                    
               geo_point_2d   typeofwork meanPPSF  nobs      slope elasticity
                     <char>       <char>    <num> <int>      <num>      <num>
1:   49.21401, -123.0392725 New Building 603.2265    10 -0.3711131 -0.8065417
2: 49.2140062, -123.0388062 New Building 603.2265    10 -0.3711131 -0.8065417
3: 49.2132602, -123.0365756 New Building 603.2265    10 -0.3711131 -0.8065417
4: 49.2143439, -123.0399512 New Building 603.2265    10 -0.3711131 -0.8065417
5: 49.2138533, -123.0545981 New Building 631.6724    54 -0.3260755 -0.5973253
6: 49.2174104, -123.0535628 New Building 631.6724    54 -0.3260755 -0.5973253
> print(summary(dtMerge))
    CTUID           ROLL_NUMBER          folioID         
 Length:2362        Length:2362        Length:2362       
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
 permitnumbercreateddate     use              maxSingle      MB_effective_year 
 Min.   :2017-01-04      Length:2362        Min.   :0.0000   Length:2362       
 1st Qu.:2020-09-28      Class :character   1st Qu.:0.0000   Class :character  
 Median :2022-06-21      Mode  :character   Median :0.0000   Mode  :character  
 Mean   :2022-04-13                         Mean   :0.3891                     
 3rd Qu.:2024-07-30                         3rd Qu.:1.0000                     
 Max.   :2025-10-17                         Max.   :1.0000                     
 MB_total_finished_area neighbourhoodDescription   address         
 Length:2362            Length:2362              Length:2362       
 Class :character       Class :character         Class :character  
 Mode  :character       Mode  :character         Mode  :character  
                                                                   
                                                                   
                                                                   
    LANDAREA       landWidth          landDepth         geo_point_2d      
 Min.   :0.4194   Length:2362        Length:2362        Length:2362       
 1st Qu.:0.8985   Class :character   Class :character   Class :character  
 Median :1.2593   Mode  :character   Mode  :character   Mode  :character  
 Mean   :1.3036                                                           
 3rd Qu.:1.5016                                                           
 Max.   :3.5378                                                           
  typeofwork           meanPPSF          nobs            slope        
 Length:2362        Min.   :586.1   Min.   :  7.00   Min.   :-0.3814  
 Class :character   1st Qu.:659.3   1st Qu.: 32.00   1st Qu.:-0.3131  
 Mode  :character   Median :746.7   Median : 50.00   Median :-0.2671  
                    Mean   :736.8   Mean   : 55.49   Mean   :-0.2722  
                    3rd Qu.:814.9   3rd Qu.: 70.00   3rd Qu.:-0.2319  
                    Max.   :870.8   Max.   :161.00   Max.   :-0.1391  
   elasticity      
 Min.   :-0.80654  
 1st Qu.:-0.42390  
 Median :-0.25240  
 Mean   :-0.26410  
 3rd Qu.:-0.05431  
 Max.   : 0.32787  
> print(table(dtMerge[,use]))

 duplex laneway   multi  single 
    760     510     173     919 
> # permitnumbercreateddate     use            MB_effective_year 
> # Min.   :2017-01-03      Length:3762        Length:3762       
> 
> dtMerge[,pYear:=year(permitnumbercreateddate)]
> for (y in sort(unique(dtMerge[,pYear]))) {
+   print(y)
+   print(table(dtMerge[pYear==y,use]))
+ }
[1] 2017

laneway  single 
      8     209 
[1] 2018

 duplex laneway  single 
      1       2     153 
[1] 2019

 duplex laneway   multi  single 
     14       2       1     127 
[1] 2020

 duplex laneway   multi  single 
     34       8       1      65 
[1] 2021

 duplex laneway   multi  single 
    272      14       2     152 
[1] 2022

 duplex laneway   multi  single 
    116       7       3      77 
[1] 2023

 duplex laneway   multi  single 
    101      41       3      66 
[1] 2024

 duplex laneway   multi  single 
    129     290      95      48 
[1] 2025

 duplex laneway   multi  single 
     93     138      68      22 
> 
> 
> dtMerge[,MB_total_finished_area:=as.numeric(MB_total_finished_area)]
> dtMerge[,MB_effective_year:=as.numeric(MB_effective_year)]
> dtMerge[,landWidth:=as.numeric(landWidth)]
> dtMerge[,landDepth:=as.numeric(landDepth)]
> dtMerge[,effectiveAge:=pYear - MB_effective_year]
> dtMerge[maxSingle==0 & use=="laneway",use:="lanewayOnly"]
> # No duplexes under 25 years old (?)
> print(summary(dtMerge[,.(MB_total_finished_area,landWidth,landDepth,effectiveAge)]))
 MB_total_finished_area   landWidth        landDepth      effectiveAge   
 Min.   :  421          Min.   : 16.50   Min.   : 50.0   Min.   : -3.00  
 1st Qu.: 1853          1st Qu.: 33.00   1st Qu.:117.0   1st Qu.: 21.00  
 Median : 2330          Median : 35.28   Median :122.0   Median : 50.00  
 Mean   : 2628          Mean   : 42.39   Mean   :123.7   Mean   : 42.48  
 3rd Qu.: 3035          3rd Qu.: 50.00   3rd Qu.:129.0   3rd Qu.: 63.00  
 Max.   :15128          Max.   :132.00   Max.   :331.0   Max.   :114.00  
 NA's   :17             NA's   :161      NA's   :161     NA's   :17      
> 
> dtMerge[,notSingle:=use!="single" & use!="laneway"]
> ## KEY: Drop Laneway only
> print(dtMerge[effectiveAge>0,summary(effectiveAge),by="use"])
            use               V1
         <char> <summaryDefault>
 1:      duplex            26.00
 2:      duplex            54.00
 3:      duplex            61.00
 4:      duplex            61.17
 5:      duplex            69.00
 6:      duplex           114.00
 7:      single             1.00
 8:      single            30.00
 9:      single            48.00
10:      single            44.64
11:      single            60.00
12:      single           110.00
13: lanewayOnly             1.00
14: lanewayOnly            22.00
15: lanewayOnly            34.00
16: lanewayOnly            38.62
17: lanewayOnly            56.00
18: lanewayOnly           102.00
19:       multi            22.00
20:       multi            54.00
21:       multi            61.00
22:       multi            60.78
23:       multi            70.25
24:       multi           100.00
            use               V1
> print(dtMerge[effectiveAge>0,table(typeofwork),by="use"])
           use      V1
        <char> <table>
1:      duplex       4
2:      duplex     750
3:      single     233
4:      single     306
5: lanewayOnly       2
6: lanewayOnly     500
7:       multi       2
8:       multi     170
> dtMerge <- dtMerge[effectiveAge>25]
> dtMerge <- dtMerge[use!="lanewayOnly" & typeofwork=="New Building"]
> # use geo_point_2d to plot variable notSingle by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=notSingle)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Not Single Family (including laneway) Permits")
>   ggsave("text/notSingleLocation.png",width=8,height=6)
> 
>   # now plot meanPPSF by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=meanPPSF)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Mean PPSF from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/meanPPSFLocation.png",width=8,height=6)
> 
>   # now plot elasticity by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=elasticity)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Elasticity from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/elasticityLocation.png",width=8,height=6)
> 
>   # and slope
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=slope)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Slope from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/slopeLocation.png",width=8,height=6)
> 
>   # mean notSingle by meanPPSF x-y plot
>   dtTract <- dtMerge[pYear>2020,.(notSingle=mean(notSingle,na.rm=TRUE), nobs=mean(nobs),
+                           meanPPSF=mean(meanPPSF,na.rm=TRUE), slope=mean(slope,na.rm=TRUE), elasticity=mean(elasticity,na.rm=TRUE)),
+                       by=.(neighbourhoodDescription)]
>   ggplot(dtTract,aes(x=meanPPSF,y=notSingle)) + geom_point() 
>   ggsave("text/notSingle_vs_meanPPSF.png",width=8,height=6)
> 
>   # ppsf and slope -- make points proportional to nobs
>   ggplot(dtTract,aes(x=meanPPSF,y=slope)) + geom_point(aes(size=nobs)) +
+     theme_minimal() 
>   ggsave("text/ppsfSlopeTract.png",width=8,height=6)
> 
> print(cor(dtTract[,.(notSingle,meanPPSF,slope,elasticity)],use="complete.obs"))
            notSingle   meanPPSF      slope elasticity
notSingle   1.0000000 -0.8176265 -0.6066645 -0.6044706
meanPPSF   -0.8176265  1.0000000  0.7492147  0.7991405
slope      -0.6066645  0.7492147  1.0000000  0.9683900
elasticity -0.6044706  0.7991405  0.9683900  1.0000000
> print(summary(lm(notSingle ~ meanPPSF,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.29614 -0.03664  0.02264  0.06220  0.23908 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.5331166  0.2839731   8.920 2.08e-08 ***
meanPPSF    -0.0024245  0.0003818  -6.351 3.38e-06 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.139 on 20 degrees of freedom
Multiple R-squared:  0.6685,	Adjusted R-squared:  0.6519 
F-statistic: 40.33 on 1 and 20 DF,  p-value: 3.379e-06

> print(summary(lm(notSingle ~ meanPPSF + slope ,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + slope, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.29482 -0.03805  0.02408  0.05953  0.23839 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.5804431  0.7582799   3.403 0.002984 ** 
meanPPSF    -0.0024545  0.0005913  -4.151 0.000543 ***
slope        0.0927134  1.3714847   0.068 0.946810    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1426 on 19 degrees of freedom
Multiple R-squared:  0.6686,	Adjusted R-squared:  0.6337 
F-statistic: 19.17 on 2 and 19 DF,  p-value: 2.776e-05

> print(summary(lm(notSingle ~ meanPPSF + elasticity ,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + elasticity, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.28199 -0.05146  0.02284  0.06760  0.24032 

Coefficients:
             Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.819252   0.542683   5.195 5.15e-05 ***
meanPPSF    -0.002745   0.000645  -4.256 0.000427 ***
elasticity   0.188915   0.303503   0.622 0.541045    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1411 on 19 degrees of freedom
Multiple R-squared:  0.6751,	Adjusted R-squared:  0.6409 
F-statistic: 19.74 on 2 and 19 DF,  p-value: 2.297e-05

> # combinedera
> print(summary(feols(notSingle ~ meanPPSF  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,109
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
          Estimate Std. Error  t value Pr(>|t|)    
meanPPSF -0.002306   0.000536 -4.30419 0.012604 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.351769     Adj. R2: 0.251   
                 Within R2: 0.212848
> print(summary(feols(notSingle ~ slope  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,109
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
      Estimate Std. Error  t value  Pr(>|t|)    
slope -1.54938   0.296982 -5.21711 0.0064402 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.388365     Adj. R2: 0.08705 
                 Within R2: 0.040546
> print(summary(feols(notSingle ~ elasticity  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,109
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
            Estimate Std. Error  t value Pr(>|t|)    
elasticity -0.376238   0.082063 -4.58472 0.010147 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.387241     Adj. R2: 0.092328
                 Within R2: 0.046093
> print(summary(feols(notSingle ~ meanPPSF + elasticity  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,109
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
            Estimate Std. Error  t value  Pr(>|t|)    
meanPPSF   -0.002395   0.000514 -4.65688 0.0096119 ** 
elasticity  0.060500   0.021777  2.77817 0.0499120 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.351574     Adj. R2: 0.251149
                 Within R2: 0.213717
> print(summary(feols(notSingle ~ meanPPSF + slope  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,109
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
          Estimate Std. Error  t value Pr(>|t|)    
meanPPSF -0.002334   0.000532 -4.38555 0.011824 *  
slope     0.093660   0.062174  1.50642 0.206428    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.351742     Adj. R2: 0.250432
                 Within R2: 0.212965
> print(summary(feols(notSingle ~ meanPPSF + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,109
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error  t value Pr(>|t|)    
meanPPSF                    -0.002018   0.000527 -3.83138 0.018596 *  
log(MB_total_finished_area) -0.095881   0.055468 -1.72856 0.158950    
log(LANDAREA)               -0.065979   0.025514 -2.58596 0.060943 .  
log(effectiveAge)            0.092417   0.020891  4.42374 0.011478 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.347896     Adj. R2: 0.265404
                 Within R2: 0.230085
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 165
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.002630   0.000411 -6.399655 0.0030616 ** 
slope                        0.082367   0.339666  0.242495 0.8203230    
log(MB_total_finished_area) -0.086206   0.105077 -0.820410 0.4580577    
log(LANDAREA)               -0.119247   0.080578 -1.479895 0.2130009    
log(effectiveAge)            0.045146   0.081165  0.556226 0.6077026    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.360251     Adj. R2: 0.387542
                 Within R2: 0.295178
> print(summary(feols(notSingle ~ meanPPSF+ log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 165
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.002593   0.000422 -6.144622 0.0035574 ** 
log(MB_total_finished_area) -0.085955   0.104563 -0.822041 0.4572289    
log(LANDAREA)               -0.120556   0.076130 -1.583548 0.1884676    
log(effectiveAge)            0.047121   0.077691  0.606522 0.5769066    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.360263     Adj. R2: 0.391427
                 Within R2: 0.29513 
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 165
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.002615   0.000442 -5.909310 0.0041051 ** 
elasticity                   0.009296   0.106629  0.087185 0.9347147    
log(MB_total_finished_area) -0.085899   0.104511 -0.821914 0.4572939    
log(LANDAREA)               -0.119687   0.083640 -1.430973 0.2256832    
log(effectiveAge)            0.046494   0.079495  0.584869 0.5900375    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.360261     Adj. R2: 0.38751 
                 Within R2: 0.295142
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(30,36) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 600
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001475   0.000468 -3.152572 0.034429 *  
slope                        0.429241   0.310840  1.380906 0.239445    
log(MB_total_finished_area)  0.034090   0.043838  0.777640 0.480210    
log(LANDAREA)               -0.001317   0.052256 -0.025206 0.981098    
log(effectiveAge)            0.140769   0.049525  2.842393 0.046754 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.303809     Adj. R2: 0.1529  
                 Within R2: 0.115542
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(30,36) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 600
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001515   0.000462 -3.282444 0.030431 *  
elasticity                   0.123176   0.075671  1.627769 0.178904    
log(MB_total_finished_area)  0.031066   0.042900  0.724157 0.509056    
log(LANDAREA)                0.000268   0.051782  0.005170 0.996123    
log(effectiveAge)            0.139635   0.049324  2.830955 0.047299 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.303601     Adj. R2: 0.154061
                 Within R2: 0.116754
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,109
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error  t value Pr(>|t|)    
meanPPSF                    -0.002052   0.000523 -3.92303 0.017204 *  
slope                        0.118956   0.105085  1.13200 0.320896    
log(MB_total_finished_area) -0.098902   0.057526 -1.71924 0.160693    
log(LANDAREA)               -0.064432   0.026588 -2.42332 0.072502 .  
log(effectiveAge)            0.091165   0.021090  4.32268 0.012421 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.347855     Adj. R2: 0.26491 
                 Within R2: 0.230267
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,109
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error  t value Pr(>|t|)    
meanPPSF                    -0.002106   0.000507 -4.15449 0.014208 *  
elasticity                   0.060286   0.031609  1.90724 0.129156    
log(MB_total_finished_area) -0.102101   0.057886 -1.76384 0.152531    
log(LANDAREA)               -0.061658   0.026470 -2.32937 0.080307 .  
log(effectiveAge)            0.089573   0.021490  4.16820 0.014052 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.347709     Adj. R2: 0.265524
                 Within R2: 0.23091 
> 
> print(cor(dtMerge[effectiveAge>2,.(MB_total_finished_area/landWidth,effectiveAge,notSingle,meanPPSF)],use="complete.obs"))
                     V1 effectiveAge  notSingle   meanPPSF
V1            1.0000000   -0.3311897 -0.0594303  0.1642629
effectiveAge -0.3311897    1.0000000  0.1655739 -0.1085974
notSingle    -0.0594303    0.1655739  1.0000000 -0.4496549
meanPPSF      0.1642629   -0.1085974 -0.4496549  1.0000000
> print(dtMerge[order(effectiveAge),.(mean(notSingle,na.rm=TRUE),mean(maxSingle,na.rm=TRUE),.N),by=effectiveAge][1:50])
    effectiveAge        V1         V2     N
           <num>     <num>      <num> <int>
 1:           26 0.5000000 0.50000000     2
 2:           27 0.0000000 1.00000000     2
 3:           28 1.0000000 0.00000000     1
 4:           29 0.6666667 0.33333333     3
 5:           30 0.0000000 1.00000000     4
 6:           31 0.6000000 0.40000000    15
 7:           32 0.2222222 0.77777778     9
 8:           33 0.4000000 0.60000000     5
 9:           34 0.7000000 0.30000000    10
10:           35 0.7500000 0.25000000     8
11:           36 0.8333333 0.16666667    12
12:           37 0.6000000 0.40000000     5
13:           38 0.6000000 0.40000000     5
14:           39 0.6666667 0.33333333     6
15:           40 0.6153846 0.38461538    13
16:           41 0.6470588 0.35294118    17
17:           42 0.5000000 0.50000000     4
18:           43 0.2727273 0.72727273    11
19:           44 0.8000000 0.20000000    20
20:           45 0.6666667 0.33333333    18
21:           46 0.7142857 0.28571429    35
22:           47 0.6470588 0.35294118    17
23:           48 0.8000000 0.20000000    15
24:           49 0.7272727 0.27272727    22
25:           50 0.7272727 0.27272727    22
26:           51 0.7777778 0.22222222    27
27:           52 0.6470588 0.35294118    17
28:           53 0.6428571 0.35714286    14
29:           54 0.6969697 0.30303030    33
30:           55 0.7096774 0.29032258    31
31:           56 0.7166667 0.28333333    60
32:           57 0.7500000 0.25000000    48
33:           58 0.7142857 0.28571429    28
34:           59 0.8823529 0.11764706    51
35:           60 0.7142857 0.28571429    49
36:           61 0.6562500 0.34375000    64
37:           62 0.9500000 0.05000000    20
38:           63 0.8888889 0.11111111    36
39:           64 0.8918919 0.10810811    37
40:           65 0.7142857 0.28571429    49
41:           66 0.8750000 0.12500000    24
42:           67 0.9047619 0.09523810    21
43:           68 0.8125000 0.18750000    16
44:           69 0.7741935 0.22580645    31
45:           70 0.8823529 0.11764706    17
46:           71 0.8333333 0.16666667    24
47:           72 0.6521739 0.34782609    23
48:           73 0.8333333 0.16666667    24
49:           74 0.8000000 0.20000000    25
50:           75 0.9166667 0.08333333    24
    effectiveAge        V1         V2     N
> 
>   ##############
> 
> # aggregate
> dtAgg <- dtMerge[,.(nPermits=.N,
+                       nNotSingle=sum(use!="single" & use!="laneway"),
+                       meanPPSF=mean(meanPPSF,na.rm=TRUE),
+                       slope=mean(slope,na.rm=TRUE),
+                       elasticity=mean(elasticity,na.rm=TRUE),
+                       meanFinishedArea=mean(MB_total_finished_area,na.rm=TRUE),
+                       meanLandArea=mean(LANDAREA,na.rm=TRUE),
+                       meanEffectiveAge=mean(effectiveAge,na.rm=TRUE)),
+                   by=.(CTUID)]
> 
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 69
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)           -0.586264   0.991304 -0.591407 5.5630e-01    
meanPPSF              -0.001942   0.000222 -8.730412 1.4805e-12 ***
log(meanLandArea)     -0.079730   0.039317 -2.027883 4.6675e-02 *  
log(meanEffectiveAge)  0.673985   0.232362  2.900587 5.0772e-03 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.130375   Adj. R2: 0.66003
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + slope + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 69
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)           -0.524679   1.023175 -0.512795 6.0986e-01    
meanPPSF              -0.001977   0.000256 -7.717817 1.0138e-10 ***
slope                  0.091283   0.331536  0.275333 7.8395e-01    
log(meanLandArea)     -0.078485   0.039857 -1.969173 5.3266e-02 .  
log(meanEffectiveAge)  0.671121   0.234263  2.864826 5.6378e-03 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.130298   Adj. R2: 0.655126
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + elasticity + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 69
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)           -0.534325   1.014154 -0.526867 6.0011e-01    
meanPPSF              -0.001987   0.000272 -7.307247 5.3645e-10 ***
elasticity             0.022779   0.078199  0.291296 7.7177e-01    
log(meanLandArea)     -0.077584   0.040276 -1.926332 5.8506e-02 .  
log(meanEffectiveAge)  0.670762   0.234276  2.863122 5.6647e-03 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.130289   Adj. R2: 0.655175
> 
> proc.time()
   user  system elapsed 
  2.655   0.371   1.701 
