
R version 4.5.0 (2025-04-11) -- "How About a Twenty-Six"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # main.R
> # main analysis script
> # Tom Davidoff
> # 01/16/26
> 
> library(data.table)
> library(ggplot2)
> library(fixest)
> 
> # Vancouver analysis # note neighbourhoodDescription better than tract for analysis level
> # get slopes and mean values from BCA sales analysis by census tract merge
> nameSlope <- "tables/bca19_mean_ppsf_slope_by_tract.csv"
> if (!file.exists(nameSlope)) {
+   source("scripts/bcaSales.R")
+ }
> # specify column CTUID is a number
> dtSlope <- fread(nameSlope, colClasses = list(character = "CTUID"))
> 
> # Now get projects merged with BCA and census tracts
> nameSpatial <- "~/OneDrive - UBC/dataProcessed/vancouverPermitLotsTracts.rds"
> if (!file.exists(nameSpatial)) {
+   source("scripts/mergePermitsSpatial.R")
+ }
> dtSpatial <- readRDS(nameSpatial)
> 
> print(head(dtSpatial))
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate     use
       <char>          <char>     <char>                  <IDat>  <char>
1: 9330044.00 001633021620000 A0000000CR              2024-01-17  single
2: 9330029.00 009697153290000 A00000191E              2019-02-21  single
3: 9330030.00 016185716270000 A0000025QE              2018-04-30  single
4: 9330013.01 019237750590000 A000002L99              2025-05-13 laneway
5: 9330008.02 006769050140000 A000000U30              2021-07-15  single
6: 9330043.02 001650034570000 A0000001L4              2024-11-27 laneway
   maxSingle MB_effective_year MB_total_finished_area neighbourhoodDescription
       <int>            <char>                 <char>                   <char>
1:         1              1965                   4002               POINT GREY
2:         1                                                            CAMBIE
3:         1              2019                   3342              MAIN/FRASER
4:         0              2007                   2198                   KNIGHT
5:         1              1978                   3064               SOUTHLANDS
6:         0              1975                   2764               POINT GREY
                                        address LANDAREA landWidth landDepth
                                         <char>    <num>    <char>    <char>
1:   4632 LANGARA AVENUE, Vancouver, BC V6R 1E1   2.8772        65       110
2:     869 W 20TH AVENUE, Vancouver, BC V5Z 1Y3   1.5016        33       122
3:     4427 JAMES STREET, Vancouver, BC V5V 3H9   1.4562      49.5       111
4: 5835 ARGYLE STREET #3, Vancouver, BC V6P 3J8   1.1375        33       122
5:    3280 W 48TH AVENUE, Vancouver, BC V6N 3P8   3.5378     65.99    164.84
6:    3863 W BROADWAY #3, Vancouver, BC V6R 2C2   0.9967     58.54    108.84
               geo_point_2d            typeofwork
                     <char>                <char>
1: 49.2729074, -123.2125593 Addition / Alteration
2: 49.2537249, -123.1237645          New Building
3: 49.2456172, -123.1042038          New Building
4: 49.2313344, -123.0719816          New Building
5: 49.2281967, -123.1779482          New Building
6:  49.2647127, -123.189698          New Building
> print(head(dtSlope))
        CTUID meanPPSF  nobs      slope elasticity
       <char>    <num> <int>      <num>      <num>
1:            732.2076     7         NA         NA
2: 9330001.01 698.6384     5 -0.5335157 -1.2783735
3: 9330001.02 603.2265    10 -0.3711131 -0.8065417
4: 9330002.01 631.6724    54 -0.3260755 -0.5973253
5: 9330002.03 614.8959    66 -0.3021881 -0.6117229
6: 9330002.04 586.0877    37 -0.3341864 -0.7916304
> dtMerge <- merge(dtSpatial,dtSlope,by="CTUID")
> print(head(dtMerge))
Key: <CTUID>
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate     use
       <char>          <char>     <char>                  <IDat>  <char>
1: 9330001.01 025790312140000 A000003EVP              2021-09-20  duplex
2: 9330001.01 025772318600000 A000003EVF              2024-12-21 laneway
3: 9330001.01 025772312520000 A000003EUQ              2021-01-27  duplex
4: 9330001.02 025821302570000 A000003GB0              2022-06-27  duplex
5: 9330001.02 025821302870000 A000003GB3              2018-08-23  single
6: 9330001.02 025821306320000 A000003GBH              2021-08-13  duplex
   maxSingle MB_effective_year MB_total_finished_area neighbourhoodDescription
       <int>            <char>                 <char>                   <char>
1:         0              1975                   2595               FRASERVIEW
2:         0              1971                   2787               FRASERVIEW
3:         0              1971                   2786               FRASERVIEW
4:         0              1973                   3846               FRASERVIEW
5:         1              2019                   2566               FRASERVIEW
6:         0              1973                   3082               FRASERVIEW
                                     address LANDAREA landWidth landDepth
                                      <char>    <num>    <char>    <char>
1: 3412 E 49TH AVENUE, Vancouver, BC V5S 1M2   1.0195                    
2:      3658 E 48TH AVENUE #3, Vancouver, BC   1.0195        40    157.83
3: 3498 E 48TH AVENUE, Vancouver, BC V5S 1H7   1.0195        45    158.17
4: 3141 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621        55       115
5: 3157 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621        55       115
6: 3210 E 62ND AVENUE, Vancouver, BC V5S 2G5   1.8621        50       140
               geo_point_2d   typeofwork meanPPSF  nobs      slope elasticity
                     <char>       <char>    <num> <int>      <num>      <num>
1:  49.2243407, -123.031668 New Building 698.6384     5 -0.5335157 -1.2783735
2: 49.2249031, -123.0246175 New Building 698.6384     5 -0.5335157 -1.2783735
3: 49.2249233, -123.0292697 New Building 698.6384     5 -0.5335157 -1.2783735
4:   49.21401, -123.0392725 New Building 603.2265    10 -0.3711131 -0.8065417
5: 49.2140062, -123.0388062 New Building 603.2265    10 -0.3711131 -0.8065417
6: 49.2132602, -123.0365756 New Building 603.2265    10 -0.3711131 -0.8065417
> print(summary(dtMerge))
    CTUID           ROLL_NUMBER          folioID         
 Length:2431        Length:2431        Length:2431       
 Class :character   Class :character   Class :character  
 Mode  :character   Mode  :character   Mode  :character  
                                                         
                                                         
                                                         
 permitnumbercreateddate     use              maxSingle      MB_effective_year 
 Min.   :2017-01-04      Length:2431        Min.   :0.0000   Length:2431       
 1st Qu.:2020-07-24      Class :character   1st Qu.:0.0000   Class :character  
 Median :2022-05-27      Mode  :character   Median :0.0000   Mode  :character  
 Mean   :2022-03-29                         Mean   :0.3998                     
 3rd Qu.:2024-07-29                         3rd Qu.:1.0000                     
 Max.   :2025-10-17                         Max.   :1.0000                     
 MB_total_finished_area neighbourhoodDescription   address         
 Length:2431            Length:2431              Length:2431       
 Class :character       Class :character         Class :character  
 Mode  :character       Mode  :character         Mode  :character  
                                                                   
                                                                   
                                                                   
    LANDAREA       landWidth          landDepth         geo_point_2d      
 Min.   :0.4194   Length:2431        Length:2431        Length:2431       
 1st Qu.:0.8985   Class :character   Class :character   Class :character  
 Median :1.2593   Mode  :character   Mode  :character   Mode  :character  
 Mean   :1.3235                                                           
 3rd Qu.:1.5554                                                           
 Max.   :3.5378                                                           
  typeofwork           meanPPSF          nobs            slope        
 Length:2431        Min.   :586.1   Min.   :  4.00   Min.   :-0.5335  
 Class :character   1st Qu.:660.8   1st Qu.: 32.00   1st Qu.:-0.3081  
 Mode  :character   Median :746.7   Median : 49.00   Median :-0.2671  
                    Mean   :739.0   Mean   : 54.05   Mean   :-0.2685  
                    3rd Qu.:818.0   3rd Qu.: 70.00   3rd Qu.:-0.2277  
                    Max.   :870.8   Max.   :161.00   Max.   : 0.4025  
   elasticity      
 Min.   :-1.27837  
 1st Qu.:-0.42390  
 Median :-0.23846  
 Mean   :-0.24673  
 3rd Qu.:-0.05431  
 Max.   : 2.68044  
> print(table(dtMerge[,use]))

 duplex laneway   multi  single 
    766     517     176     972 
> # permitnumbercreateddate     use            MB_effective_year 
> # Min.   :2017-01-03      Length:3762        Length:3762       
> 
> dtMerge[,pYear:=year(permitnumbercreateddate)]
> for (y in sort(unique(dtMerge[,pYear]))) {
+   print(y)
+   print(table(dtMerge[pYear==y,use]))
+ }
[1] 2017

laneway  single 
      8     223 
[1] 2018

 duplex laneway  single 
      1       3     160 
[1] 2019

 duplex laneway   multi  single 
     14       2       1     135 
[1] 2020

 duplex laneway   multi  single 
     35       8       1      70 
[1] 2021

 duplex laneway   multi  single 
    275      14       2     160 
[1] 2022

 duplex laneway   multi  single 
    117       7       3      80 
[1] 2023

 duplex laneway   multi  single 
    102      41       4      69 
[1] 2024

 duplex laneway   multi  single 
    129     293      96      52 
[1] 2025

 duplex laneway   multi  single 
     93     141      69      23 
> 
> 
> dtMerge[,MB_total_finished_area:=as.numeric(MB_total_finished_area)]
> dtMerge[,MB_effective_year:=as.numeric(MB_effective_year)]
> dtMerge[,landWidth:=as.numeric(landWidth)]
> dtMerge[,landDepth:=as.numeric(landDepth)]
> dtMerge[,effectiveAge:=pYear - MB_effective_year]
> dtMerge[maxSingle==0 & use=="laneway",use:="lanewayOnly"]
> # No duplexes under 25 years old (?)
> print(summary(dtMerge[,.(MB_total_finished_area,landWidth,landDepth,effectiveAge)]))
 MB_total_finished_area   landWidth        landDepth      effectiveAge   
 Min.   :  421          Min.   : 16.50   Min.   : 50.0   Min.   : -3.00  
 1st Qu.: 1866          1st Qu.: 33.00   1st Qu.:117.2   1st Qu.: 20.00  
 Median : 2362          Median : 36.30   Median :122.0   Median : 49.00  
 Mean   : 2682          Mean   : 43.02   Mean   :124.1   Mean   : 42.07  
 3rd Qu.: 3092          3rd Qu.: 50.00   3rd Qu.:129.7   3rd Qu.: 62.00  
 Max.   :15128          Max.   :132.00   Max.   :331.0   Max.   :114.00  
 NA's   :17             NA's   :175      NA's   :175     NA's   :17      
> 
> dtMerge[,notSingle:=use!="single" & use!="laneway"]
> #dtMerge[,notSingle:=use!="single" ]
> 
> print(names(dtMerge))
 [1] "CTUID"                    "ROLL_NUMBER"             
 [3] "folioID"                  "permitnumbercreateddate" 
 [5] "use"                      "maxSingle"               
 [7] "MB_effective_year"        "MB_total_finished_area"  
 [9] "neighbourhoodDescription" "address"                 
[11] "LANDAREA"                 "landWidth"               
[13] "landDepth"                "geo_point_2d"            
[15] "typeofwork"               "meanPPSF"                
[17] "nobs"                     "slope"                   
[19] "elasticity"               "pYear"                   
[21] "effectiveAge"             "notSingle"               
> print(feols(notSingle ~ meanPPSF| pYear, data=dtMerge[pYear>2020],cluster="CTUID"))
OLS estimation, Dep. Var.: notSingle
Observations: 1,770
Fixed-effects: pYear: 5
Standard-errors: Clustered (CTUID) 
          Estimate Std. Error  t value   Pr(>|t|)    
meanPPSF -0.001918   0.000194 -9.86309 5.2713e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.357157     Adj. R2: 0.246994
                 Within R2: 0.157248
> print(cor(dtMerge[,.(meanPPSF,elasticity)],use="complete.obs"))
            meanPPSF elasticity
meanPPSF   1.0000000  0.5187543
elasticity 0.5187543  1.0000000
> 
> dtIncome <- fread("~/OneDrive - UBC/dataRaw/9810005801_databaseLoadingData.csv",select=c("GEO","DGUID","Household income statistics (6)","VALUE"))
> print(head(dtIncome))
                              GEO               DGUID
                           <char>              <char>
1: 0001.00 - Abbotsford - Mission 2021S05079320001.00
2: 0001.00 - Abbotsford - Mission 2021S05079320001.00
3: 0001.00 - Abbotsford - Mission 2021S05079320001.00
4: 0002.00 - Abbotsford - Mission 2021S05079320002.00
5: 0002.00 - Abbotsford - Mission 2021S05079320002.00
6: 0002.00 - Abbotsford - Mission 2021S05079320002.00
                                Household income statistics (6)  VALUE
                                                         <char>  <int>
1:                                  Number of households (2021)    660
2:                                  Number of households (2016)    650
3: Median household total income (2020) (2020 constant dollars) 121000
4:                                  Number of households (2021)    425
5:                                  Number of households (2016)    420
6: Median household total income (2020) (2020 constant dollars)  85000
> setnames(dtIncome,c("DGUID","Household income statistics (6)","VALUE"),c("DGUID","incomeStat","medianIncome"))
> print(head(dtIncome))
                              GEO               DGUID
                           <char>              <char>
1: 0001.00 - Abbotsford - Mission 2021S05079320001.00
2: 0001.00 - Abbotsford - Mission 2021S05079320001.00
3: 0001.00 - Abbotsford - Mission 2021S05079320001.00
4: 0002.00 - Abbotsford - Mission 2021S05079320002.00
5: 0002.00 - Abbotsford - Mission 2021S05079320002.00
6: 0002.00 - Abbotsford - Mission 2021S05079320002.00
                                                     incomeStat medianIncome
                                                         <char>        <int>
1:                                  Number of households (2021)          660
2:                                  Number of households (2016)          650
3: Median household total income (2020) (2020 constant dollars)       121000
4:                                  Number of households (2021)          425
5:                                  Number of households (2016)          420
6: Median household total income (2020) (2020 constant dollars)        85000
> dtIncome <- dtIncome[incomeStat=="Median household total income (2020) (2020 constant dollars)"]
> print(head(dtIncome))
                              GEO               DGUID
                           <char>              <char>
1: 0001.00 - Abbotsford - Mission 2021S05079320001.00
2: 0002.00 - Abbotsford - Mission 2021S05079320002.00
3: 0003.00 - Abbotsford - Mission 2021S05079320003.00
4: 0004.00 - Abbotsford - Mission 2021S05079320004.00
5: 0005.01 - Abbotsford - Mission 2021S05079320005.01
6: 0005.02 - Abbotsford - Mission 2021S05079320005.02
                                                     incomeStat medianIncome
                                                         <char>        <int>
1: Median household total income (2020) (2020 constant dollars)       121000
2: Median household total income (2020) (2020 constant dollars)        85000
3: Median household total income (2020) (2020 constant dollars)        77000
4: Median household total income (2020) (2020 constant dollars)        93000
5: Median household total income (2020) (2020 constant dollars)        83000
6: Median household total income (2020) (2020 constant dollars)        54000
> dtIncome <- dtIncome[grepl("Vancouver",GEO)==TRUE]
> print(head(dtIncome))
                         GEO               DGUID
                      <char>              <char>
1: Vancouver (CMA) 933, B.C.        2021S0503933
2:       0001.01 - Vancouver 2021S05079330001.01
3:       0001.02 - Vancouver 2021S05079330001.02
4:       0002.01 - Vancouver 2021S05079330002.01
5:       0002.03 - Vancouver 2021S05079330002.03
6:       0002.04 - Vancouver 2021S05079330002.04
                                                     incomeStat medianIncome
                                                         <char>        <int>
1: Median household total income (2020) (2020 constant dollars)        90000
2: Median household total income (2020) (2020 constant dollars)        89000
3: Median household total income (2020) (2020 constant dollars)        95000
4: Median household total income (2020) (2020 constant dollars)        88000
5: Median household total income (2020) (2020 constant dollars)        91000
6: Median household total income (2020) (2020 constant dollars)        95000
> dtIncome[,tract:=substr(DGUID,13,19)]
> dtMerge[,tract:=substr(CTUID,4,10)]
> print(head(dtIncome))
                         GEO               DGUID
                      <char>              <char>
1: Vancouver (CMA) 933, B.C.        2021S0503933
2:       0001.01 - Vancouver 2021S05079330001.01
3:       0001.02 - Vancouver 2021S05079330001.02
4:       0002.01 - Vancouver 2021S05079330002.01
5:       0002.03 - Vancouver 2021S05079330002.03
6:       0002.04 - Vancouver 2021S05079330002.04
                                                     incomeStat medianIncome
                                                         <char>        <int>
1: Median household total income (2020) (2020 constant dollars)        90000
2: Median household total income (2020) (2020 constant dollars)        89000
3: Median household total income (2020) (2020 constant dollars)        95000
4: Median household total income (2020) (2020 constant dollars)        88000
5: Median household total income (2020) (2020 constant dollars)        91000
6: Median household total income (2020) (2020 constant dollars)        95000
     tract
    <char>
1:        
2: 0001.01
3: 0001.02
4: 0002.01
5: 0002.03
6: 0002.04
> print(head(dtMerge))
Key: <CTUID>
        CTUID     ROLL_NUMBER    folioID permitnumbercreateddate         use
       <char>          <char>     <char>                  <IDat>      <char>
1: 9330001.01 025790312140000 A000003EVP              2021-09-20      duplex
2: 9330001.01 025772318600000 A000003EVF              2024-12-21 lanewayOnly
3: 9330001.01 025772312520000 A000003EUQ              2021-01-27      duplex
4: 9330001.02 025821302570000 A000003GB0              2022-06-27      duplex
5: 9330001.02 025821302870000 A000003GB3              2018-08-23      single
6: 9330001.02 025821306320000 A000003GBH              2021-08-13      duplex
   maxSingle MB_effective_year MB_total_finished_area neighbourhoodDescription
       <int>             <num>                  <num>                   <char>
1:         0              1975                   2595               FRASERVIEW
2:         0              1971                   2787               FRASERVIEW
3:         0              1971                   2786               FRASERVIEW
4:         0              1973                   3846               FRASERVIEW
5:         1              2019                   2566               FRASERVIEW
6:         0              1973                   3082               FRASERVIEW
                                     address LANDAREA landWidth landDepth
                                      <char>    <num>     <num>     <num>
1: 3412 E 49TH AVENUE, Vancouver, BC V5S 1M2   1.0195        NA        NA
2:      3658 E 48TH AVENUE #3, Vancouver, BC   1.0195        40    157.83
3: 3498 E 48TH AVENUE, Vancouver, BC V5S 1H7   1.0195        45    158.17
4: 3141 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621        55    115.00
5: 3157 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621        55    115.00
6: 3210 E 62ND AVENUE, Vancouver, BC V5S 2G5   1.8621        50    140.00
               geo_point_2d   typeofwork meanPPSF  nobs      slope elasticity
                     <char>       <char>    <num> <int>      <num>      <num>
1:  49.2243407, -123.031668 New Building 698.6384     5 -0.5335157 -1.2783735
2: 49.2249031, -123.0246175 New Building 698.6384     5 -0.5335157 -1.2783735
3: 49.2249233, -123.0292697 New Building 698.6384     5 -0.5335157 -1.2783735
4:   49.21401, -123.0392725 New Building 603.2265    10 -0.3711131 -0.8065417
5: 49.2140062, -123.0388062 New Building 603.2265    10 -0.3711131 -0.8065417
6: 49.2132602, -123.0365756 New Building 603.2265    10 -0.3711131 -0.8065417
   pYear effectiveAge notSingle   tract
   <int>        <num>    <lgcl>  <char>
1:  2021           46      TRUE 0001.01
2:  2024           53      TRUE 0001.01
3:  2021           50      TRUE 0001.01
4:  2022           49      TRUE 0001.02
5:  2018           -1     FALSE 0001.02
6:  2021           48      TRUE 0001.02
> print(nrow(dtMerge))
[1] 2431
> dtMerge <- merge(dtMerge,dtIncome[,.(tract,medianIncome)],by="tract",all.x=TRUE)
> print(nrow(dtMerge))
[1] 2431
> print(head(dtMerge))
Key: <tract>
     tract      CTUID     ROLL_NUMBER    folioID permitnumbercreateddate
    <char>     <char>          <char>     <char>                  <IDat>
1: 0001.01 9330001.01 025790312140000 A000003EVP              2021-09-20
2: 0001.01 9330001.01 025772318600000 A000003EVF              2024-12-21
3: 0001.01 9330001.01 025772312520000 A000003EUQ              2021-01-27
4: 0001.02 9330001.02 025821302570000 A000003GB0              2022-06-27
5: 0001.02 9330001.02 025821302870000 A000003GB3              2018-08-23
6: 0001.02 9330001.02 025821306320000 A000003GBH              2021-08-13
           use maxSingle MB_effective_year MB_total_finished_area
        <char>     <int>             <num>                  <num>
1:      duplex         0              1975                   2595
2: lanewayOnly         0              1971                   2787
3:      duplex         0              1971                   2786
4:      duplex         0              1973                   3846
5:      single         1              2019                   2566
6:      duplex         0              1973                   3082
   neighbourhoodDescription                                   address LANDAREA
                     <char>                                    <char>    <num>
1:               FRASERVIEW 3412 E 49TH AVENUE, Vancouver, BC V5S 1M2   1.0195
2:               FRASERVIEW      3658 E 48TH AVENUE #3, Vancouver, BC   1.0195
3:               FRASERVIEW 3498 E 48TH AVENUE, Vancouver, BC V5S 1H7   1.0195
4:               FRASERVIEW 3141 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621
5:               FRASERVIEW 3157 E 62ND AVENUE, Vancouver, BC V5S 2G6   1.8621
6:               FRASERVIEW 3210 E 62ND AVENUE, Vancouver, BC V5S 2G5   1.8621
   landWidth landDepth             geo_point_2d   typeofwork meanPPSF  nobs
       <num>     <num>                   <char>       <char>    <num> <int>
1:        NA        NA  49.2243407, -123.031668 New Building 698.6384     5
2:        40    157.83 49.2249031, -123.0246175 New Building 698.6384     5
3:        45    158.17 49.2249233, -123.0292697 New Building 698.6384     5
4:        55    115.00   49.21401, -123.0392725 New Building 603.2265    10
5:        55    115.00 49.2140062, -123.0388062 New Building 603.2265    10
6:        50    140.00 49.2132602, -123.0365756 New Building 603.2265    10
        slope elasticity pYear effectiveAge notSingle medianIncome
        <num>      <num> <int>        <num>    <lgcl>        <int>
1: -0.5335157 -1.2783735  2021           46      TRUE        89000
2: -0.5335157 -1.2783735  2024           53      TRUE        89000
3: -0.5335157 -1.2783735  2021           50      TRUE        89000
4: -0.3711131 -0.8065417  2022           49      TRUE        95000
5: -0.3711131 -0.8065417  2018           -1     FALSE        95000
6: -0.3711131 -0.8065417  2021           48      TRUE        95000
> print(cor(dtMerge[,.(meanPPSF,elasticity,medianIncome)],use="complete.obs"))
              meanPPSF elasticity medianIncome
meanPPSF     1.0000000  0.5187543    0.5177508
elasticity   0.5187543  1.0000000    0.3346755
medianIncome 0.5177508  0.3346755    1.0000000
> 
> ## KEY: Drop Laneway only
> print(dtMerge[effectiveAge>0,summary(effectiveAge),by="use"])
            use               V1
         <char> <summaryDefault>
 1:      duplex            26.00
 2:      duplex            53.00
 3:      duplex            61.00
 4:      duplex            61.11
 5:      duplex            69.00
 6:      duplex           114.00
 7: lanewayOnly             1.00
 8: lanewayOnly            22.00
 9: lanewayOnly            34.00
10: lanewayOnly            38.61
11: lanewayOnly            56.00
12: lanewayOnly           102.00
13:      single             1.00
14:      single            30.00
15:      single            47.50
16:      single            44.39
17:      single            60.00
18:      single           110.00
19:       multi            19.00
20:       multi            54.00
21:       multi            61.00
22:       multi            60.50
23:       multi            70.00
24:       multi           100.00
            use               V1
> print(dtMerge[effectiveAge>0,table(typeofwork),by="use"])
           use      V1
        <char> <table>
1:      duplex       4
2:      duplex     756
3: lanewayOnly       2
4: lanewayOnly     507
5:      single     253
6:      single     317
7:       multi       2
8:       multi     173
> dtMerge <- dtMerge[effectiveAge>25]
> dtMerge <- dtMerge[use!="lanewayOnly" & typeofwork=="New Building"]
> # use geo_point_2d to plot variable notSingle by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=notSingle)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Not Single Family (including laneway) Permits")
>   ggsave("text/notSingleLocation.png",width=8,height=6)
> 
>   # now plot meanPPSF by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=meanPPSF)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Mean PPSF from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/meanPPSFLocation.png",width=8,height=6)
> 
>   # now plot elasticity by lon,lat
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=elasticity)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Elasticity from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/elasticityLocation.png",width=8,height=6)
> 
>   # and slope
> ggplot(dtMerge,aes(x=as.numeric(tstrsplit(geo_point_2d,", ")[[2]]),
+                     y=as.numeric(tstrsplit(geo_point_2d,", ")[[1]]),
+                     color=slope)) +
+   geom_point() +
+   theme_minimal() +
+   labs(title="Vancouver Permits 2017-2025",
+        subtitle="Slope from BCA Sales 2019-2021 by Census Tract")
>   ggsave("text/slopeLocation.png",width=8,height=6)
> 
>   # mean notSingle by meanPPSF x-y plot
>   dtTract <- dtMerge[pYear>2020,.(notSingle=mean(notSingle,na.rm=TRUE), nobs=mean(nobs),
+                           meanPPSF=mean(meanPPSF,na.rm=TRUE), slope=mean(slope,na.rm=TRUE), elasticity=mean(elasticity,na.rm=TRUE),medianIncome=mean(medianIncome,na.rm=TRUE)),
+                       by=.(CTUID)]
>   ggplot(dtTract,aes(x=meanPPSF,y=notSingle)) + geom_point() 
>   ggsave("text/notSingle_vs_meanPPSF.png",width=8,height=6)
> 
>   # ppsf and slope -- make points proportional to nobs
>   ggplot(dtTract,aes(x=meanPPSF,y=slope)) + geom_point(aes(size=nobs)) +
+     theme_minimal() 
>   ggsave("text/ppsfSlopeTract.png",width=8,height=6)
> 
>   # ppsf and income
>   ggplot(dtTract,aes(x=meanPPSF,y=medianIncome)) + geom_point(aes(size=nobs)) +
+     theme_minimal() 
>   ggsave("text/ppsfIncomeTract.png",width=8,height=6)
> 
> 
> print(cor(dtTract[,.(notSingle,meanPPSF,slope,elasticity)],use="complete.obs"))
            notSingle   meanPPSF      slope elasticity
notSingle   1.0000000 -0.7488969 -0.2593811 -0.2883360
meanPPSF   -0.7488969  1.0000000  0.3230432  0.3701752
slope      -0.2593811  0.3230432  1.0000000  0.9836928
elasticity -0.2883360  0.3701752  0.9836928  1.0000000
> print(cor(dtTract[,.(notSingle,meanPPSF,slope,elasticity,medianIncome)],use="complete.obs"))
              notSingle   meanPPSF      slope elasticity medianIncome
notSingle     1.0000000 -0.7488969 -0.2593811 -0.2883360   -0.5315739
meanPPSF     -0.7488969  1.0000000  0.3230432  0.3701752    0.4735479
slope        -0.2593811  0.3230432  1.0000000  0.9836928    0.1357464
elasticity   -0.2883360  0.3701752  0.9836928  1.0000000    0.1551298
medianIncome -0.5315739  0.4735479  0.1357464  0.1551298    1.0000000
> print(summary(lm(notSingle ~ meanPPSF,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.48828 -0.07315  0.02930  0.09635  0.30148 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.3385314  0.1643679  14.227  < 2e-16 ***
meanPPSF    -0.0021620  0.0002287  -9.455 3.89e-14 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1504 on 70 degrees of freedom
Multiple R-squared:  0.5608,	Adjusted R-squared:  0.5546 
F-statistic:  89.4 on 1 and 70 DF,  p-value: 3.894e-14

> print(summary(lm(notSingle ~ meanPPSF + slope ,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + slope, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.48974 -0.07262  0.03097  0.09466  0.30273 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.3139873  0.1965941  11.770  < 2e-16 ***
meanPPSF    -0.0021438  0.0002433  -8.813 6.55e-13 ***
slope       -0.0423919  0.1832931  -0.231    0.818    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1514 on 69 degrees of freedom
Multiple R-squared:  0.5612,	Adjusted R-squared:  0.5485 
F-statistic: 44.12 on 2 and 69 DF,  p-value: 4.557e-13

> print(summary(lm(notSingle ~ meanPPSF + elasticity ,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + elasticity, data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.48733 -0.07383  0.03104  0.09519  0.30253 

Coefficients:
              Estimate Std. Error t value Pr(>|t|)    
(Intercept)  2.3270092  0.1824882  12.752  < 2e-16 ***
meanPPSF    -0.0021482  0.0002479  -8.666 1.21e-12 ***
elasticity  -0.0064035  0.0426972  -0.150    0.881    
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1515 on 69 degrees of freedom
Multiple R-squared:  0.561,	Adjusted R-squared:  0.5483 
F-statistic: 44.09 on 2 and 69 DF,  p-value: 4.628e-13

> print(summary(lm(notSingle ~ meanPPSF + elasticity + medianIncome,data=dtTract)))

Call:
lm(formula = notSingle ~ meanPPSF + elasticity + medianIncome, 
    data = dtTract)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.48035 -0.07224  0.01834  0.07682  0.26814 

Coefficients:
               Estimate Std. Error t value Pr(>|t|)    
(Intercept)   2.402e+00  1.775e-01  13.537  < 2e-16 ***
meanPPSF     -1.830e-03  2.669e-04  -6.856 2.57e-09 ***
elasticity   -9.059e-03  4.099e-02  -0.221   0.8257    
medianIncome -3.278e-06  1.247e-06  -2.629   0.0106 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 0.1454 on 68 degrees of freedom
Multiple R-squared:  0.6015,	Adjusted R-squared:  0.5839 
F-statistic: 34.21 on 3 and 68 DF,  p-value: 1.354e-13

> # combinedera
> print(summary(feols(notSingle ~ meanPPSF  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,124
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
         Estimate Std. Error  t value Pr(>|t|)    
meanPPSF -0.00235   0.000535 -4.38986 0.011784 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.35334     Adj. R2: 0.255475
                Within R2: 0.218017
> print(summary(feols(notSingle ~ slope  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,124
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
      Estimate Std. Error  t value  Pr(>|t|)    
slope -1.04098   0.154779 -6.72559 0.0025456 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.393446     Adj. R2: 0.076871
                 Within R2: 0.030428
> print(summary(feols(notSingle ~ elasticity  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,124
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
            Estimate Std. Error  t value  Pr(>|t|)    
elasticity -0.254307   0.046329 -5.48915 0.0053662 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.392558     Adj. R2: 0.081031
                 Within R2: 0.034797
> print(summary(feols(notSingle ~ meanPPSF + elasticity  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,124
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
            Estimate Std. Error   t value Pr(>|t|)    
meanPPSF   -0.002388   0.000538 -4.438155  0.01135 *  
elasticity  0.023398   0.025532  0.916416  0.41130    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.353286     Adj. R2: 0.255037
                 Within R2: 0.218257
> print(summary(feols(notSingle ~ meanPPSF + slope  | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,124
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
          Estimate Std. Error   t value Pr(>|t|)    
meanPPSF -0.002356   0.000546 -4.314142 0.012505 *  
slope     0.017956   0.088029  0.203981 0.848326    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.353339     Adj. R2: 0.254816
                 Within R2: 0.218025
> print(summary(feols(notSingle ~ meanPPSF + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,124
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error  t value Pr(>|t|)    
meanPPSF                    -0.002030   0.000533 -3.80598 0.019006 *  
log(MB_total_finished_area) -0.106969   0.056477 -1.89400 0.131143    
log(LANDAREA)               -0.071974   0.024769 -2.90578 0.043863 *  
log(effectiveAge)            0.083172   0.021541  3.86113 0.018130 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.349011     Adj. R2: 0.271655
                 Within R2: 0.237064
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 166
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.002375   0.000454 -5.236790 0.0063542 ** 
slope                       -0.484377   0.344402 -1.406429 0.2323281    
log(MB_total_finished_area) -0.087928   0.105753 -0.831449 0.4524726    
log(LANDAREA)               -0.124460   0.077268 -1.610767 0.1825200    
log(effectiveAge)            0.055271   0.081700  0.676513 0.5358162    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.360047     Adj. R2: 0.391874
                 Within R2: 0.295034
> print(summary(feols(notSingle ~ meanPPSF+ log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 166
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.002589   0.000424 -6.102257 0.003649 ** 
log(MB_total_finished_area) -0.094987   0.096634 -0.982954 0.381282    
log(LANDAREA)               -0.110630   0.068580 -1.613166 0.182005    
log(effectiveAge)            0.038062   0.074658  0.509815 0.637022    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.361263     Adj. R2: 0.39166 
                 Within R2: 0.290265
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(48,56) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 166
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value  Pr(>|t|)    
meanPPSF                    -0.002322   0.000468 -4.960808 0.0077017 ** 
elasticity                  -0.116110   0.085989 -1.350289 0.2482662    
log(MB_total_finished_area) -0.089826   0.105243 -0.853509 0.4414749    
log(LANDAREA)               -0.127927   0.080413 -1.590878 0.1868466    
log(effectiveAge)            0.051772   0.080797  0.640771 0.5565383    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.359945     Adj. R2: 0.392219
                 Within R2: 0.295433
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(30,36) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 601
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001469   0.000472 -3.111235 0.035829 *  
slope                        0.392755   0.205194  1.914069 0.128144    
log(MB_total_finished_area)  0.034689   0.043950  0.789281 0.474100    
log(LANDAREA)               -0.001107   0.052176 -0.021222 0.984085    
log(effectiveAge)            0.140547   0.049353  2.847772 0.046500 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.303574     Adj. R2: 0.153027
                 Within R2: 0.115769
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[landWidth %between% c(30,36) & pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 601
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.001499   0.000469 -3.199410 0.032919 *  
elasticity                   0.106790   0.043595  2.449576 0.070477 .  
log(MB_total_finished_area)  0.032403   0.043211  0.749875 0.495027    
log(LANDAREA)                0.000420   0.051712  0.008127 0.993905    
log(effectiveAge)            0.139429   0.049393  2.822822 0.047691 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.3034     Adj. R2: 0.153999
               Within R2: 0.116784
> print(summary(feols(notSingle ~ meanPPSF+slope + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,124
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.002039   0.000540 -3.778330 0.019464 *  
slope                        0.031341   0.089281  0.351035 0.743271    
log(MB_total_finished_area) -0.108003   0.057610 -1.874731 0.134095    
log(LANDAREA)               -0.071388   0.024115 -2.960346 0.041540 *  
log(effectiveAge)            0.082753   0.020706  3.996663 0.016175 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.349006     Adj. R2: 0.271023
                 Within R2: 0.237086
> print(summary(feols(notSingle ~ meanPPSF+elasticity + log(MB_total_finished_area) + log(LANDAREA) + log(effectiveAge) | pYear,data=dtMerge[pYear %between% c(2021,2025)])))
OLS estimation, Dep. Var.: notSingle
Observations: 1,124
Fixed-effects: pYear: 5
Standard-errors: Clustered (pYear) 
                             Estimate Std. Error   t value Pr(>|t|)    
meanPPSF                    -0.002066   0.000533 -3.875505 0.017909 *  
elasticity                   0.023231   0.023656  0.982021 0.381689    
log(MB_total_finished_area) -0.110191   0.057594 -1.913248 0.128265    
log(LANDAREA)               -0.069750   0.023589 -2.956867 0.041684 *  
log(effectiveAge)            0.081786   0.020932  3.907278 0.017434 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.348959     Adj. R2: 0.271218
                 Within R2: 0.23729 
> 
> print(cor(dtMerge[effectiveAge>2,.(MB_total_finished_area/landWidth,effectiveAge,notSingle,meanPPSF)],use="complete.obs"))
                      V1 effectiveAge   notSingle   meanPPSF
V1            1.00000000   -0.3300689 -0.05673245  0.1623878
effectiveAge -0.33006893    1.0000000  0.16688364 -0.1108893
notSingle    -0.05673245    0.1668836  1.00000000 -0.4569165
meanPPSF      0.16238784   -0.1108893 -0.45691649  1.0000000
> print(dtMerge[order(effectiveAge),.(mean(notSingle,na.rm=TRUE),mean(maxSingle,na.rm=TRUE),.N),by=effectiveAge][1:50])
    effectiveAge        V1         V2     N
           <num>     <num>      <num> <int>
 1:           26 0.5000000 0.50000000     2
 2:           27 0.0000000 1.00000000     2
 3:           28 1.0000000 0.00000000     1
 4:           29 0.6666667 0.33333333     3
 5:           30 0.0000000 1.00000000     4
 6:           31 0.6000000 0.40000000    15
 7:           32 0.2222222 0.77777778     9
 8:           33 0.4000000 0.60000000     5
 9:           34 0.7000000 0.30000000    10
10:           35 0.7500000 0.25000000     8
11:           36 0.7692308 0.23076923    13
12:           37 0.6000000 0.40000000     5
13:           38 0.6000000 0.40000000     5
14:           39 0.6666667 0.33333333     6
15:           40 0.6153846 0.38461538    13
16:           41 0.6470588 0.35294118    17
17:           42 0.5000000 0.50000000     4
18:           43 0.2500000 0.75000000    12
19:           44 0.7619048 0.23809524    21
20:           45 0.6666667 0.33333333    18
21:           46 0.7222222 0.27777778    36
22:           47 0.6666667 0.33333333    18
23:           48 0.8000000 0.20000000    15
24:           49 0.7272727 0.27272727    22
25:           50 0.7600000 0.24000000    25
26:           51 0.7777778 0.22222222    27
27:           52 0.6470588 0.35294118    17
28:           53 0.6000000 0.40000000    15
29:           54 0.6969697 0.30303030    33
30:           55 0.7096774 0.29032258    31
31:           56 0.7049180 0.29508197    61
32:           57 0.7500000 0.25000000    48
33:           58 0.6896552 0.31034483    29
34:           59 0.8653846 0.13461538    52
35:           60 0.7142857 0.28571429    49
36:           61 0.6562500 0.34375000    64
37:           62 0.9523810 0.04761905    21
38:           63 0.8918919 0.10810811    37
39:           64 0.8947368 0.10526316    38
40:           65 0.7000000 0.30000000    50
41:           66 0.8400000 0.16000000    25
42:           67 0.9047619 0.09523810    21
43:           68 0.7647059 0.23529412    17
44:           69 0.7741935 0.22580645    31
45:           70 0.8823529 0.11764706    17
46:           71 0.8333333 0.16666667    24
47:           72 0.6521739 0.34782609    23
48:           73 0.8333333 0.16666667    24
49:           74 0.8000000 0.20000000    25
50:           75 0.9166667 0.08333333    24
    effectiveAge        V1         V2     N
> 
>   ##############
> 
> # aggregate
> dtAgg <- dtMerge[,.(nPermits=.N,
+                       nNotSingle=sum(use!="single" & use!="laneway"),
+                       meanPPSF=mean(meanPPSF,na.rm=TRUE),
+                       slope=mean(slope,na.rm=TRUE),
+                       elasticity=mean(elasticity,na.rm=TRUE),
+                       meanFinishedArea=mean(MB_total_finished_area,na.rm=TRUE),
+                       meanLandArea=mean(LANDAREA,na.rm=TRUE),
+                       meanEffectiveAge=mean(effectiveAge,na.rm=TRUE)),
+                   by=.(CTUID)]
> 
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 73
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)            0.165735   0.957976  0.173006 8.6315e-01    
meanPPSF              -0.002032   0.000226 -8.991999 3.0859e-13 ***
log(meanLandArea)     -0.098268   0.039568 -2.483548 1.5442e-02 *  
log(meanEffectiveAge)  0.505919   0.224090  2.257665 2.7134e-02 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.134903   Adj. R2: 0.658865
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + slope + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 73
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)            0.072709   0.975065  0.074568 9.4078e-01    
meanPPSF              -0.001979   0.000244 -8.115025 1.3546e-11 ***
slope                 -0.101500   0.170345 -0.595849 5.5325e-01    
log(meanLandArea)     -0.101578   0.040140 -2.530586 1.3707e-02 *  
log(meanEffectiveAge)  0.512649   0.225427  2.274119 2.6119e-02 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.134553   Adj. R2: 0.655646
> print(summary(feols(nNotSingle/nPermits ~ meanPPSF + elasticity + log(meanLandArea) + log(meanEffectiveAge) | 1,data=dtAgg)))
OLS estimation, Dep. Var.: nNotSingle/nPermits
Observations: 73
Standard-errors: IID 
                       Estimate Std. Error   t value   Pr(>|t|)    
(Intercept)            0.100039   0.970267  0.103105 9.1818e-01    
meanPPSF              -0.001975   0.000250 -7.902301 3.2972e-11 ***
elasticity            -0.021805   0.039711 -0.549081 5.8475e-01    
log(meanLandArea)     -0.102096   0.040376 -2.528640 1.3776e-02 *  
log(meanEffectiveAge)  0.510583   0.225393  2.265306 2.6683e-02 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
RMSE: 0.134605   Adj. R2: 0.655376
> 
> proc.time()
   user  system elapsed 
  2.978   0.610   1.741 
