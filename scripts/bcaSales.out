
R version 4.4.0 (2024-04-24) -- "Puppy Cup"
Copyright (C) 2024 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # bcaSales.R
> # R to use 2019 sales to get census-tract level coefficients on duplex vs single family and also square footage coefficients on ppsf
> # Tom Davidoff
> # 01/14/26
> 
> # strategy:
> # Get 2026 roll centroids, merge on roll/1000 (for subdivisions), confirm coverage for 2019 sales data (through 2018)
> # merge with census tract centroids
> # Regress coefficients, etc.
> 
> library(data.table)
Warning message:
package ‘data.table’ was built under R version 4.4.1 
> library(sf)
Linking to GEOS 3.11.0, GDAL 3.5.3, PROJ 9.1.0; sf_use_s2() is TRUE
> library(RSQLite)
> library(fixest)
> library(ggplot2)
> library(scales)

Attaching package: ‘scales’

The following object is masked from ‘package:fixest’:

    pvalue

> library(stringr)
> library(readxl)
> 
> BCA19    <- "~/OneDrive - UBC/dataRaw/REVD19_and_inventory_extracts.sqlite3"
> BCA26 <- "/Volumes/T7Office/bigFiles/bca_folios.gpkg"
> 
> # use 2026 data to get floor(roll number/1000) to get lot polygons -> centroid , maybe zoning 
> fRollLatLon <- "~/OneDrive - UBC/dataProcessed/bca26RollCensusTract.rds"
> fLaneway <-  "~/OneDrive - UBC/dataRaw/20231231_UBC_CustomLanewayReport.xlsx"
> 
> 
> if (!file.exists(fRollLatLon)) {
+   cat("Extracting lot centroids from BCA 2026 data...\n")
+   desc26 <- st_read(BCA26,
+       layer="WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_DESCRIPTIONS_SV",
+       query = "SELECT ROLL_NUMBER, geom FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_DESCRIPTIONS_SV WHERE JURISDICTION_CODE=='200' AND (ACTUAL_USE_DESCRIPTION IN ('Residential Dwelling with Suite','Single Family Dwelling') OR INSTR(ACTUAL_USE_DESCRIPTION, 'uplex') > 0)", 
+       quiet = TRUE
+   )
+   print(head(desc26))
+   stDesc <- st_crs(desc26)
+   roll_pt <- st_point_on_surface(desc26)
+ # convert geom to centroid
+ # --- 2021 Census Tracts (cartographic) via download
+   ct_file <- "~/OneDrive - UBC/dataRaw/lct_000b21a_e/lct_000b21a_e.shp"
+   sCT <- st_read(ct_file, quiet = TRUE)
+   # sCT: your census tract sf (currently 3347)
+   sCT <- st_make_valid(sCT)
+   sCT<- st_transform(sCT, stDesc)
+ 
+   roll_ct <- st_join( roll_pt, sCT[, c("CTUID", "DGUID", "CTNAME", "PRUID")], join = st_within, left = TRUE)
+   print(head(roll_ct))
+   saveRDS(roll_ct,fRollLatLon)
+ 
+ }
> 
> # Load BCA 2019 sales data (all residential)
> fSales <- "~/OneDrive - UBC/dataProcessed/bca19Sales.rds"
> if (!file.exists(fSales)) {
+   cat("Extracting BCA 2019 sales data...\n")
+   db <- dbConnect(SQLite(), BCA19)
+   dtBCA2019 <- as.data.table(dbGetQuery(db, "
+       SELECT s.folioID, s.conveyancePrice, s.conveyanceDate,
+              i.MB_effective_year, i.MB_total_finished_area, i.land_width, i.land_depth, i.land_area, i.roll_number, i.zoning,
+              d.actualUseDescription, d.neighbourhoodDescription, a.postalCode
+       FROM sales s
+       JOIN folio f ON s.folioID = f.folioID
+       JOIN residentialInventory i ON f.rollNumber = i.roll_number
+       JOIN folioDescription d ON f.folioID = d.folioID
+       JOIN address a ON f.folioID = a.folioID
+       WHERE s.conveyanceTypeDescription = 'Improved Single Property Transaction'
+         AND i.jurisdiction = 200
+         AND (d.actualUseDescription IN ('Residential Dwelling with Suite','Single Family Dwelling') OR INSTR(d.actualUseDescription, 'uplex') > 0)
+   "))
+   dbDisconnect(db)
+   saveRDS(dtBCA2019,fSales)
+   } 
> dtBCA2019 <- readRDS(fSales)
> print(head(dtBCA2019))
      folioID conveyancePrice conveyanceDate MB_effective_year
       <char>          <char>         <char>            <char>
1: A000000009         9450000     2014-06-16              2019
2: A00000000A         8800000     2013-02-08              1997
3: A00000000A         1700000     1991-07-09              1997
4: A00000000B         3850000     2006-12-04              1945
5: A00000000B          190000     1977-04-15              1945
6: A00000000C         2308000     1991-09-03              2011
   MB_total_finished_area land_width land_depth land_area     roll_number
                   <char>     <char>     <char>    <char>          <char>
1:                  11895                                 001019632060000
2:                   7760        195      251.9           001019632290000
3:                   7760        195      251.9           001019632290000
4:                   3215        150        250           001019632450000
5:                   3215        150        250           001019632450000
6:                   8673        150        250           001019632650000
   zoning   actualUseDescription neighbourhoodDescription postalCode
   <char>                 <char>                   <char>     <char>
1:    RS1 Single Family Dwelling               POINT GREY    V6T 1A9
2:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2
3:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2
4:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2
5:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2
6:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2
> 
> # merge back with census tract on roll number/1000
> dtRollLatLon <- as.data.table(readRDS(fRollLatLon))
> dtBCA2019[, roll_base := floor(as.numeric(roll_number) / 1000)]
> dtRollLatLon[, roll_base := floor(as.numeric(ROLL_NUMBER) / 1000)]
> dtBCA2019 <- merge(dtBCA2019, dtRollLatLon[, .(roll_base, CTUID, DGUID, CTNAME)], by = "roll_base", all.x = TRUE)
> print(table(is.na(dtBCA2019[, CTUID])))

 FALSE   TRUE 
165645   1204 
> print(table(dtBCA2019[is.na(CTUID), actualUseDescription]))

Duplex, Non-Strata Side by Side or Front / Back 
                                             43 
                   Duplex, Non-Strata Up / Down 
                                              2 
                    Duplex, Strata Front / Back 
                                             24 
                    Duplex, Strata Side by Side 
                                              7 
                Residential Dwelling with Suite 
                                            530 
                         Single Family Dwelling 
                                            598 
> print(table(dtBCA2019[!is.na(CTUID), actualUseDescription]))

2 Acres Or More (Single Family Dwelling, Duplex) 
                                              86 
 Duplex, Non-Strata Side by Side or Front / Back 
                                            2098 
                    Duplex, Non-Strata Up / Down 
                                             254 
                     Duplex, Strata Front / Back 
                                            8357 
                     Duplex, Strata Side by Side 
                                            4964 
                        Duplex, Strata Up / Down 
                                             478 
                 Residential Dwelling with Suite 
                                           79320 
                          Single Family Dwelling 
                                           70088 
> 
> 
> # Numeric conversion and cleaning
> cols <- c("conveyancePrice", "MB_effective_year", "MB_total_finished_area")
> dtBCA2019[, (cols) := lapply(.SD, as.numeric), .SDcols = cols]
> dtBCA2019 <- dtBCA2019[!is.na(MB_total_finished_area) & conveyancePrice > 100000]
> 
> # filter types to only single and duplex 
> # Metrics & Outliers
> CUT <- 0.05
> 
> print(names(dtBCA2019))
 [1] "roll_base"                "folioID"                 
 [3] "conveyancePrice"          "conveyanceDate"          
 [5] "MB_effective_year"        "MB_total_finished_area"  
 [7] "land_width"               "land_depth"              
 [9] "land_area"                "roll_number"             
[11] "zoning"                   "actualUseDescription"    
[13] "neighbourhoodDescription" "postalCode"              
[15] "CTUID"                    "DGUID"                   
[17] "CTNAME"                  
> print(head(dtBCA2019))
Key: <roll_base>
    roll_base    folioID conveyancePrice conveyanceDate MB_effective_year
        <num>     <char>           <num>         <char>             <num>
1: 1019632060 A000000009         9450000     2014-06-16              2019
2: 1019632290 A00000000A         8800000     2013-02-08              1997
3: 1019632290 A00000000A         1700000     1991-07-09              1997
4: 1019632450 A00000000B         3850000     2006-12-04              1945
5: 1019632450 A00000000B          190000     1977-04-15              1945
6: 1019632650 A00000000C         2308000     1991-09-03              2011
   MB_total_finished_area land_width land_depth land_area     roll_number
                    <num>     <char>     <char>    <char>          <char>
1:                  11895                                 001019632060000
2:                   7760        195      251.9           001019632290000
3:                   7760        195      251.9           001019632290000
4:                   3215        150        250           001019632450000
5:                   3215        150        250           001019632450000
6:                   8673        150        250           001019632650000
   zoning   actualUseDescription neighbourhoodDescription postalCode      CTUID
   <char>                 <char>                   <char>     <char>     <char>
1:    RS1 Single Family Dwelling               POINT GREY    V6T 1A9 9330044.00
2:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2 9330044.00
3:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2 9330044.00
4:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2 9330044.00
5:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2 9330044.00
6:    RS1 Single Family Dwelling               POINT GREY    V6T 1B2 9330044.00
                 DGUID  CTNAME
                <char>  <char>
1: 2021S05079330044.00 0044.00
2: 2021S05079330044.00 0044.00
3: 2021S05079330044.00 0044.00
4: 2021S05079330044.00 0044.00
5: 2021S05079330044.00 0044.00
6: 2021S05079330044.00 0044.00
> dtBCA2019[, `:=`(
+     age = year(conveyanceDate) - MB_effective_year, 
+     ppsf = conveyancePrice / MB_total_finished_area, 
+     dwelling_type = ifelse(grepl("uplex", actualUseDescription, ignore.case = TRUE), "duplex", "single")
+ )]
> 
> dtBCA2019 <- dtBCA2019[
+     age >= 0 &
+     MB_total_finished_area %between% quantile(MB_total_finished_area, c(CUT, 1-CUT))
+ ]
> 
> cat("BCA 2019 transactions loaded:", nrow(dtBCA2019), "\n")
BCA 2019 transactions loaded: 105145 
> cat("  Single:", dtBCA2019[dwelling_type == "single", .N], "\n")
  Single: 96345 
> cat("  Duplex:", dtBCA2019[dwelling_type == "duplex", .N], "\n")
  Duplex: 8800 
> 
> # ==========================================
> # Exclude from the sales homes with laneways in some (all?) specifications
> # ==========================================
> cat("\n=== PART 2: Loading BCA 2025 inventory for FSR analysis ===\n")

=== PART 2: Loading BCA 2025 inventory for FSR analysis ===
> # Load laneway data
> 
> dtLaneway <- as.data.table(read_excel(fLaneway, sheet = "DATA"))
> setnames(dtLaneway, "ROLL_NUM", "Roll_Number_char")
> dtLaneway[, `:=`(
+   Roll_Number = as.numeric(Roll_Number_char),
+   roll_base = floor(as.numeric(Roll_Number_char) / 1000)
+ )]
> print(head(dtLaneway))
   ROLLYEAR   AREA    JUR Roll_Number_char ACTUAL_USE_CODE
     <char> <char> <char>           <char>          <char>
1:     2024     09    200  001634020620000             000
2:     2024     09    200  001636019550000             000
3:     2024     09    200  001636022740000             032
4:     2024     09    200  001636036970000             000
5:     2024     09    200  001637022770000             000
6:     2024     09    200  001638037950000             000
                  MANUAL_CLASS_DESC YEAR_BUILT EFFECTIVE_YEAR
                             <char>      <num>          <num>
1: 1155 - 1 STY house - Semi-Custom       2021           2021
2: 1155 - 1 STY house - Semi-Custom       2021           2021
3: 1155 - 1 STY house - Semi-Custom       2022           2022
4: 1155 - 1 STY house - Semi-Custom       2021           2021
5: 1155 - 1 STY house - Semi-Custom       2022           2022
6: 1156 - 1.5 STY house-Semi-Custom       2021           2021
   TOTAL_FINISHED_AREA BASEMENT_AREA SLAB_AREA CRAWL_SPACE_AREA  Roll_Number
                 <num>         <num>     <num>            <num>        <num>
1:                 465             0        56              409 1.634021e+12
2:                 955             0         0              955 1.636020e+12
3:                 635           525         0              130 1.636023e+12
4:                 434             0       434                0 1.636037e+12
5:                 855             0       855                0 1.637023e+12
6:                 565             0       297                0 1.638038e+12
    roll_base
        <num>
1: 1634020620
2: 1636019550
3: 1636022740
4: 1636036970
5: 1637022770
6: 1638037950
> 
> dtBCA2019 <- merge(dtBCA2019,dtLaneway[,.(roll_base,lanewayBuilt=YEAR_BUILT)],by="roll_base",all.x=TRUE)
> dtBCA2019[, hasLaneway := !is.na(lanewayBuilt) & (year(conveyanceDate) >= lanewayBuilt) ]
> print(names(dtBCA2019))
 [1] "roll_base"                "folioID"                 
 [3] "conveyancePrice"          "conveyanceDate"          
 [5] "MB_effective_year"        "MB_total_finished_area"  
 [7] "land_width"               "land_depth"              
 [9] "land_area"                "roll_number"             
[11] "zoning"                   "actualUseDescription"    
[13] "neighbourhoodDescription" "postalCode"              
[15] "CTUID"                    "DGUID"                   
[17] "CTNAME"                   "age"                     
[19] "ppsf"                     "dwelling_type"           
[21] "lanewayBuilt"             "hasLaneway"              
> print(head(dtBCA2019))
Key: <roll_base>
    roll_base    folioID conveyancePrice conveyanceDate MB_effective_year
        <num>     <char>           <num>         <char>             <num>
1: 1019632450 A00000000B         3850000     2006-12-04              1945
2: 1019632450 A00000000B          190000     1977-04-15              1945
3: 1019635500 A00000000N         1550000     1999-07-29              1970
4: 1019636570 A00000000Z         8580000     2015-01-05              1965
5: 1019636570 A00000000Z         5490000     2010-11-30              1965
6: 1019636570 A00000000Z         2525000     2003-09-30              1965
   MB_total_finished_area land_width land_depth land_area     roll_number
                    <num>     <char>     <char>    <char>          <char>
1:                   3215        150        250           001019632450000
2:                   3215        150        250           001019632450000
3:                   3940                                 001019635500000
4:                   3599                                 001019636570000
5:                   3599                                 001019636570000
6:                   3599                                 001019636570000
   zoning            actualUseDescription neighbourhoodDescription postalCode
   <char>                          <char>                   <char>     <char>
1:    RS1          Single Family Dwelling               POINT GREY    V6T 1B2
2:    RS1          Single Family Dwelling               POINT GREY    V6T 1B2
3:    RS1          Single Family Dwelling               POINT GREY    V6T 1B6
4:    RS1 Residential Dwelling with Suite               POINT GREY    V6T 1B7
5:    RS1 Residential Dwelling with Suite               POINT GREY    V6T 1B7
6:    RS1 Residential Dwelling with Suite               POINT GREY    V6T 1B7
        CTUID               DGUID  CTNAME   age       ppsf dwelling_type
       <char>              <char>  <char> <num>      <num>        <char>
1: 9330044.00 2021S05079330044.00 0044.00    61 1197.51166        single
2: 9330044.00 2021S05079330044.00 0044.00    32   59.09798        single
3: 9330044.00 2021S05079330044.00 0044.00    29  393.40102        single
4: 9330044.00 2021S05079330044.00 0044.00    50 2383.99555        single
5: 9330044.00 2021S05079330044.00 0044.00    45 1525.42373        single
6: 9330044.00 2021S05079330044.00 0044.00    38  701.58377        single
   lanewayBuilt hasLaneway
          <num>     <lgcl>
1:           NA      FALSE
2:           NA      FALSE
3:           NA      FALSE
4:           NA      FALSE
5:           NA      FALSE
6:           NA      FALSE
> 
> MINYEAR <- 2014
> 
> dtBCA2019[,duplex:= ifelse(dwelling_type=="duplex",1,0)]
> dtBCA2019[,nDuplex:=sum(duplex),by=.(CTUID)]
> dtBCA2019 <- dtBCA2019[ grepl("RS",zoning)]
> dtbca2019 <- dtBCA2019[ neighbourhoodDescription %chin% c("SHAUGNESSY","WEST END")==FALSE]
> m_dwelling <- feols(ppsf ~ duplex + log(age + 1) | CTUID, data = dtBCA2019[hasLaneway==FALSE & year(conveyanceDate) >= MINYEAR])
NOTE: 91 observations removed because of NA values (Fixed-effects: 91).
> m_sf <- feols(ppsf ~ log(age + 1) + MB_total_finished_area | CTUID, data = dtBCA2019[hasLaneway==FALSE & year(conveyanceDate) >= MINYEAR & nDuplex>20])
NOTE: 91 observations removed because of NA values (Fixed-effects: 91).
> print(etable(m_dwelling,m_sf))
                            m_dwelling                m_sf
Dependent Var.:                   ppsf                ppsf
                                                          
duplex                 -87.63. (47.06)                    
log(age+1)             9.472** (2.971)     -16.14* (6.465)
MB_total_finished_area                 -0.1117*** (0.0162)
Fixed-Effects:         --------------- -------------------
CTUID                              Yes                 Yes
______________________ _______________ ___________________
S.E.: Clustered              by: CTUID           by: CTUID
Observations                    13,202               4,877
R2                             0.49615             0.49160
Within R2                      0.00290             0.06861
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> m_dwellingNbhd <- feols(ppsf ~ neighbourhoodDescription + duplex + neighbourhoodDescription:duplex + log(age + 1) | year(conveyanceDate) , data = dtBCA2019[hasLaneway==FALSE & year(conveyanceDate) >= MINYEAR])
The variables 'neighbourhoodDescriptionCOLLINGWOOD:duplex', 'neighbourhoodDescriptionGRANDVIEW:duplex', 'neighbourhoodDescriptionKERRISDALE:duplex', 'neighbourhoodDescriptionKNIGHT:duplex', 'neighbourhoodDescriptionMARINE DRIVE:duplex', 'neighbourhoodDescriptionMARPOLE:duplex' and 7 others have been removed because of collinearity (see $collin.var).
> 
> m_sqftNbhd <- feols(ppsf ~ neighbourhoodDescription + log(MB_total_finished_area) + neighbourhoodDescription:log(MB_total_finished_area) + log(age + 1) | year(conveyanceDate) , data = dtBCA2019[hasLaneway==FALSE & year(conveyanceDate) >= MINYEAR])
> print(etable(m_dwellingNbhd,m_sqftNbhd))
                                                                        m_dwellingNbhd
Dependent Var.:                                                                   ppsf
                                                                                      
neighbourhoodDescriptionCAMBIE                                          -42.52 (30.50)
neighbourhoodDescriptionCEDARCOTTAGE                                 -315.1*** (37.82)
neighbourhoodDescriptionCOLLINGWOOD                                  -463.5*** (42.74)
neighbourhoodDescriptionDUNBAR                                          -1.054 (6.518)
neighbourhoodDescriptionFRASERVIEW                                   -461.7*** (43.72)
neighbourhoodDescriptionGRANDVIEW                                    -396.2*** (38.65)
neighbourhoodDescriptionHASTINGSEAST                                 -451.6*** (42.00)
neighbourhoodDescriptionKERRISDALE                                   -72.37*** (9.411)
neighbourhoodDescriptionKILLARNEY                                    -431.4*** (38.65)
neighbourhoodDescriptionKITSILANO                                        14.51 (21.10)
neighbourhoodDescriptionKNIGHT                                       -443.1*** (41.77)
neighbourhoodDescriptionMAIN/FRASER                                  -339.3*** (33.70)
neighbourhoodDescriptionMARINEDRIVE                                  -500.6*** (37.91)
neighbourhoodDescriptionMARPOLE                                      -212.8*** (14.98)
neighbourhoodDescriptionOAKRIDGE                                        -86.17 (61.26)
neighbourhoodDescriptionPOINTGREY                                     195.8*** (14.52)
neighbourhoodDescriptionRENFREW                                      -462.8*** (35.91)
neighbourhoodDescriptionRENFREWHEIGHTS                               -458.1*** (37.44)
neighbourhoodDescriptionSHAUGHNESSY                                      66.42 (38.28)
neighbourhoodDescriptionSOUTHGRANVILLE                                 -88.97* (29.29)
neighbourhoodDescriptionSOUTHVANCOUVER                               -444.8*** (38.43)
neighbourhoodDescriptionSOUTHLANDS                                    -110.1** (23.81)
duplex                                                                -311.6** (52.46)
log(age+1)                                                              -6.070 (4.905)
neighbourhoodDescriptionCAMBIE x duplex                                 211.7* (78.57)
neighbourhoodDescriptionCEDARCOTTAGE x duplex                           132.7* (50.92)
neighbourhoodDescriptionDUNBAR x duplex                               634.9*** (66.66)
neighbourhoodDescriptionFRASERVIEW x duplex                            188.2** (46.38)
neighbourhoodDescriptionHASTINGSEAST x duplex                         513.1*** (45.95)
neighbourhoodDescriptionKILLARNEY x duplex                            318.9*** (46.27)
neighbourhoodDescriptionKITSILANO x duplex                              595.6. (252.6)
neighbourhoodDescriptionMAIN/FRASER x duplex                           350.6** (51.37)
neighbourhoodDescriptionPOINTGREY x duplex                               153.7 (95.65)
log(MB_total_finished_area)                                                           
neighbourhoodDescriptionCAMBIE x log(MB_total_finished_area)                          
neighbourhoodDescriptionCEDARCOTTAGE x log(MB_total_finished_area)                    
neighbourhoodDescriptionCOLLINGWOOD x log(MB_total_finished_area)                     
neighbourhoodDescriptionDUNBAR x log(MB_total_finished_area)                          
neighbourhoodDescriptionFRASERVIEW x log(MB_total_finished_area)                      
neighbourhoodDescriptionGRANDVIEW x log(MB_total_finished_area)                       
neighbourhoodDescriptionHASTINGSEAST x log(MB_total_finished_area)                    
neighbourhoodDescriptionKERRISDALE x log(MB_total_finished_area)                      
neighbourhoodDescriptionKILLARNEY x log(MB_total_finished_area)                       
neighbourhoodDescriptionKITSILANO x log(MB_total_finished_area)                       
neighbourhoodDescriptionKNIGHT x log(MB_total_finished_area)                          
neighbourhoodDescriptionMAIN/FRASER x log(MB_total_finished_area)                     
neighbourhoodDescriptionMARINEDRIVE x log(MB_total_finished_area)                     
neighbourhoodDescriptionMARPOLE x log(MB_total_finished_area)                         
neighbourhoodDescriptionOAKRIDGE x log(MB_total_finished_area)                        
neighbourhoodDescriptionPOINTGREY x log(MB_total_finished_area)                       
neighbourhoodDescriptionRENFREW x log(MB_total_finished_area)                         
neighbourhoodDescriptionRENFREWHEIGHTS x log(MB_total_finished_area)                  
neighbourhoodDescriptionSHAUGHNESSY x log(MB_total_finished_area)                     
neighbourhoodDescriptionSOUTHGRANVILLE x log(MB_total_finished_area)                  
neighbourhoodDescriptionSOUTHVANCOUVER x log(MB_total_finished_area)                  
neighbourhoodDescriptionSOUTHLANDS x log(MB_total_finished_area)                      
Fixed-Effects:                                                       -----------------
year(conveyanceDate)                                                               Yes
________________________________________                             _________________
S.E.: Clustered                                                      by: conveyanceD..
Observations                                                                    13,293
R2                                                                             0.60816
Within R2                                                                      0.52547

                                                                             m_sqftNbhd
Dependent Var.:                                                                    ppsf
                                                                                       
neighbourhoodDescriptionCAMBIE                                            894.5 (780.8)
neighbourhoodDescriptionCEDARCOTTAGE                                   -1,237.7 (671.7)
neighbourhoodDescriptionCOLLINGWOOD                                      -933.9 (745.3)
neighbourhoodDescriptionDUNBAR                                           -48.98 (449.4)
neighbourhoodDescriptionFRASERVIEW                                    -1,842.2* (608.8)
neighbourhoodDescriptionGRANDVIEW                                         4.842 (657.6)
neighbourhoodDescriptionHASTINGSEAST                                     -614.4 (660.9)
neighbourhoodDescriptionKERRISDALE                                        504.1 (409.8)
neighbourhoodDescriptionKILLARNEY                                        -755.4 (634.0)
neighbourhoodDescriptionKITSILANO                                         37.78 (370.6)
neighbourhoodDescriptionKNIGHT                                           -929.5 (678.5)
neighbourhoodDescriptionMAIN/FRASER                                      -170.4 (646.1)
neighbourhoodDescriptionMARINEDRIVE                                      -914.9 (961.0)
neighbourhoodDescriptionMARPOLE                                          -135.2 (461.7)
neighbourhoodDescriptionOAKRIDGE                                     3,271.4* (1,091.0)
neighbourhoodDescriptionPOINTGREY                                     -2,810.0* (736.8)
neighbourhoodDescriptionRENFREW                                          -443.0 (630.1)
neighbourhoodDescriptionRENFREWHEIGHTS                                   -339.5 (868.2)
neighbourhoodDescriptionSHAUGHNESSY                                     610.4 (1,307.2)
neighbourhoodDescriptionSOUTHGRANVILLE                                 1,226.9. (587.7)
neighbourhoodDescriptionSOUTHVANCOUVER                                 -1,005.5 (604.6)
neighbourhoodDescriptionSOUTHLANDS                                        168.2 (490.9)
duplex                                                                                 
log(age+1)                                                             -32.51** (6.110)
neighbourhoodDescriptionCAMBIE x duplex                                                
neighbourhoodDescriptionCEDARCOTTAGE x duplex                                          
neighbourhoodDescriptionDUNBAR x duplex                                                
neighbourhoodDescriptionFRASERVIEW x duplex                                            
neighbourhoodDescriptionHASTINGSEAST x duplex                                          
neighbourhoodDescriptionKILLARNEY x duplex                                             
neighbourhoodDescriptionKITSILANO x duplex                                             
neighbourhoodDescriptionMAIN/FRASER x duplex                                           
neighbourhoodDescriptionPOINTGREY x duplex                                             
log(MB_total_finished_area)                                             -300.3* (91.43)
neighbourhoodDescriptionCAMBIE x log(MB_total_finished_area)             -123.4 (96.14)
neighbourhoodDescriptionCEDARCOTTAGE x log(MB_total_finished_area)        106.0 (79.64)
neighbourhoodDescriptionCOLLINGWOOD x log(MB_total_finished_area)         49.52 (89.84)
neighbourhoodDescriptionDUNBAR x log(MB_total_finished_area)              2.829 (55.36)
neighbourhoodDescriptionFRASERVIEW x log(MB_total_finished_area)         169.0. (71.97)
neighbourhoodDescriptionGRANDVIEW x log(MB_total_finished_area)          -64.90 (79.44)
neighbourhoodDescriptionHASTINGSEAST x log(MB_total_finished_area)        7.930 (78.29)
neighbourhoodDescriptionKERRISDALE x log(MB_total_finished_area)         -71.97 (50.83)
neighbourhoodDescriptionKILLARNEY x log(MB_total_finished_area)           34.55 (75.03)
neighbourhoodDescriptionKITSILANO x log(MB_total_finished_area)          -9.272 (45.80)
neighbourhoodDescriptionKNIGHT x log(MB_total_finished_area)              51.11 (79.82)
neighbourhoodDescriptionMAIN/FRASER x log(MB_total_finished_area)        -34.82 (77.05)
neighbourhoodDescriptionMARINEDRIVE x log(MB_total_finished_area)         40.36 (118.2)
neighbourhoodDescriptionMARPOLE x log(MB_total_finished_area)            -16.56 (56.49)
neighbourhoodDescriptionOAKRIDGE x log(MB_total_finished_area)          -414.1* (129.6)
neighbourhoodDescriptionPOINTGREY x log(MB_total_finished_area)         374.9** (91.99)
neighbourhoodDescriptionRENFREW x log(MB_total_finished_area)            -12.45 (75.28)
neighbourhoodDescriptionRENFREWHEIGHTS x log(MB_total_finished_area)     -26.25 (105.5)
neighbourhoodDescriptionSHAUGHNESSY x log(MB_total_finished_area)        -58.99 (157.4)
neighbourhoodDescriptionSOUTHGRANVILLE x log(MB_total_finished_area)    -155.0. (70.01)
neighbourhoodDescriptionSOUTHVANCOUVER x log(MB_total_finished_area)      62.45 (71.48)
neighbourhoodDescriptionSOUTHLANDS x log(MB_total_finished_area)         -32.50 (60.13)
Fixed-Effects:                                                       ------------------
year(conveyanceDate)                                                                Yes
________________________________________                             __________________
S.E.: Clustered                                                      by: conveyanceDa..
Observations                                                                     13,293
R2                                                                              0.64740
Within R2                                                                       0.57299
---
Signif. codes: 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
> 
> print(dtBCA2019[ , mean(ppsf), by = .(neighbourhoodDescription, duplex) ])
     neighbourhoodDescription duplex        V1
                       <char>  <num>     <num>
 1:                POINT GREY      0 543.70607
 2:                POINT GREY      1 632.86780
 3:                 KITSILANO      0 436.90359
 4:                 KITSILANO      1 611.10110
 5:                    DUNBAR      0 450.67899
 6:                    DUNBAR      1 832.39986
 7: ARBUTUS/MACKENZIE HEIGHTS      0 471.78908
 8:                KERRISDALE      0 444.58940
 9:                KERRISDALE      1 317.56193
10:                SOUTHLANDS      0 415.63619
11:                SOUTHLANDS      1 549.37868
12:               SHAUGHNESSY      0 418.56770
13:               SHAUGHNESSY      1 643.45351
14:                    CAMBIE      0 420.97557
15:                    CAMBIE      1 490.65271
16:           SOUTH GRANVILLE      0 391.85445
17:                  OAKRIDGE      0 419.21456
18:                   MARPOLE      0 363.93268
19:                 GRANDVIEW      0 275.67121
20:                 GRANDVIEW      1 156.87019
21:             CEDAR COTTAGE      0 295.02656
22:             CEDAR COTTAGE      1 376.21119
23:               MAIN/FRASER      0 297.39198
24:               MAIN/FRASER      1 351.87554
25:           SOUTH VANCOUVER      0 261.26931
26:           SOUTH VANCOUVER      1 100.85227
27:              MARINE DRIVE      0 295.87315
28:              MARINE DRIVE      1 248.82751
29:                    KNIGHT      0 258.86853
30:                    KNIGHT      1  99.72106
31:             HASTINGS EAST      0 269.15234
32:             HASTINGS EAST      1 842.26491
33:                   RENFREW      0 256.54465
34:           RENFREW HEIGHTS      0 262.98531
35:               COLLINGWOOD      0 240.42179
36:                 KILLARNEY      0 255.50240
37:                 KILLARNEY      1 426.04627
38:                FRASERVIEW      0 251.43169
39:                FRASERVIEW      1 253.30289
     neighbourhoodDescription duplex        V1
> 
> print(dtBCA2019[,median(MB_total_finished_area),by=.(duplex)])
   duplex    V1
    <num> <num>
1:      0  2382
2:      1  1816
> 
> print(table(dtBCA2019[,.(zoning)]))
zoning
 RS05   RS1  RS1A  RS1B  RS1S   RS2   RS3  RS3A   RS4   RS5  RS5S   RS6   RS7 
    1 57968   219   428   102   163   336   138    21 14769     3  1172  2386 
> 
> q("no")
> proc.time()
   user  system elapsed 
 13.802   0.604   5.538 
