
R version 4.5.2 (2025-10-31) -- "[Not] Part in a Rumble"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # getBCAVancouverCentroids.csv
> # Extract Vancouver single family / duplex parcels from BCA 2026 GeoPackage
> # and save locally for faster loading
> # Tom Davidoff / Claude
> # 01/15/26
> 
> library(sf)
Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE
> library(RSQLite)
> library(data.table)
> 
> # ============================================================================
> # Configuration
> # ============================================================================
> bcaFile<- "/Volumes/T7Office/bigFiles/bca_folios_spatial_file_20251103/bca_folios.gpkg.gpkg"
> outFile   <- "~/OneDrive - UBC/dataProcessed/bca25Centroids.rds"
> 
> # ============================================================================
> # Extract Vancouver residential parcels
> # ============================================================================
> 
> cat("Loading Vancouver residential parcels from BCA \n")
Loading Vancouver residential parcels from BCA 
> cat("Source:", bcaFile, "\n")
Source: /Volumes/T7Office/bigFiles/bca_folios_spatial_file_20251103/bca_folios.gpkg.gpkg 
> 
> sBCA<- st_read(
+   bcaFile,
+   layer = "WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_DESCRIPTIONS_SV",
+   query = "SELECT ROLL_NUMBER, geom FROM WHSE_HUMAN_CULTURAL_ECONOMIC_BCA_FOLIO_DESCRIPTIONS_SV
+            WHERE JURISDICTION_CODE='200'",
+   quiet = TRUE
+ )
Warning message:
In CPL_read_ogr(dsn, layer, query, as.character(options), quiet,  :
  argument layer is ignored when query is specified
>            #AND (ACTUAL_USE_DESCRIPTION IN ('Residential Dwelling with Suite','Single Family Dwelling')
> 
> cat("Parcels loaded:", nrow(sBCA), "\n")
Parcels loaded: 223292 
> cat("CRS:", st_crs(sBCA)$epsg, "\n")
CRS: 3005 
> # 1) keep only the ID + polygon geometry
> cent_sf <- sBCA[, "ROLL_NUMBER"]              # sf with POLYGON geom, CRS 3005
> 
> # 2) compute centroids in 3005
> cent_sf$centroid <- st_centroid(st_geometry(cent_sf))
> 
> # 3) switch active geometry to centroid
> cent_sf <- st_set_geometry(cent_sf, "centroid")
> 
> # 4) drop the old polygon geometry column (now just points + ROLL_NUMBER)
> cent_sf$geom <- NULL                          # if your polygon column is named 'geom'
> # (If it's named differently, remove that column instead.)
> 
> # 5) transform the point geometry to lon/lat
> cent_ll <- st_transform(cent_sf, 4326)
> 
> # 6) extract lon/lat
> xy <- st_coordinates(cent_ll)
> 
> dt_out <- data.table(
+   ROLL_NUMBER = cent_ll$ROLL_NUMBER,
+   lon = xy[,1],
+   lat = xy[,2]
+ )
> 
> print(dt_out)
            ROLL_NUMBER       lon      lat
                 <char>     <num>    <num>
     1: 001025638140000 -123.2079 49.27005
     2: 001025638280000 -123.2076 49.27000
     3: 001025638480000 -123.2076 49.26974
     4: 001025638660000 -123.2076 49.26949
     5: 001025638920000 -123.2076 49.26926
    ---                                   
223288: 013645198400016 -123.0943 49.26502
223289: 011790156570014 -123.1227 49.22663
223290: 023718301400009 -123.0359 49.23964
223291: 008730135160000 -123.1364 49.24147
223292: 002640087630000 -123.1536 49.26841
> 
> saveRDS(dt_out,outFile)
> print("foo")
[1] "foo"
> 
> q("no")
> proc.time()
   user  system elapsed 
  3.795   0.594   4.381 
