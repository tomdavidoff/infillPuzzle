
R version 4.5.0 (2025-04-11) -- "How About a Twenty-Six"
Copyright (C) 2025 The R Foundation for Statistical Computing
Platform: aarch64-apple-darwin20

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> # mergeParcelPermits.R
> # R code to do the discrete task: Merge parcel data with permit data based on addresses.
> 
> # Load necessary libraries
> library(data.table)
> library(sf)
Linking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE
> 
> # Read headers
> directory <- "~/OneDrive - UBC/dataRaw"
> f_permit <- "vancouver_permits_full.csv"
> f_parcel <- "property-parcel-polygons.geojson"
> 
> # Read permit data
> dtPermits <- fread(file.path(directory,f_permit))#,select=c("permitnumber","address","))
> # Read parcel data
> parcels <- st_read(file.path(directory,f_parcel)) # is thjis best way to read geojson?
Reading layer `property-parcel-polygons' from data source 
  `/Users/tdavidof/Library/CloudStorage/OneDrive-UBC/dataRaw/property-parcel-polygons.geojson' 
  using driver `GeoJSON'
Simple feature collection with 99765 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -123.2297 ymin: 49.19939 xmax: -123.0233 ymax: 49.31407
Geodetic CRS:  WGS 84
> dtParcels <- as.data.table(parcels) # convert to data.table for easier manipulation
> dtPermits[,grouper:=paste0(yearmonth,applicant)]
> # convert geo_point_2d to lon, lat and then compute a simple within group distance
> dtPermits[, c("lat", "lon") := tstrsplit(geo_point_2d, ",\\s*", type.convert = TRUE)]
> dtPermits[, groupDistance := { lon_adj <- cos(mean(lat) * pi/180) 
+           sqrt(var(lat) + var(lon * lon_adj)) * 111000
+         }, by = grouper] # meters
> print(summary(dtPermits[,groupDistance]))
   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
    0.0    13.6   790.3  1692.9  3204.9  9357.0   24783 
> print(length(unique(dtPermits[,grouper])))
[1] 32434
> dtPermits[,nGroup:=.N,by=grouper]
> dtPermits[,group2:=grouper]
> dtPermits[groupDistance>25,group2:=paste0(grouper,runif(length(grouper)))]
> print(length(unique(dtPermits[,grouper])))
[1] 32434
> print(nrow(dtPermits))
[1] 49093
> 
> dtParcels[,address:=paste(civic_number,streetname)]
> dtParcels[,address:=toupper(address)] # make uppercase to match permit data
> # How to these subsequent shifts recognizing we dont want "STREET" -> "STREETEET"? But also recognizing "ST" often ends word, so gsub(" ST "," STREET ") wont catch those
> # What's below for parcels is good, but let's make a nice data.table or something and apply to both parcels and permits. Maybe a function? Your call
> streetRename <- data.table(
+   short = c(" ST"," AVE"," AV"," RD"," DR"," BLVD"," CRES"," HWY"," PL"," PLZ"),
+   long = c(" STREET"," AVENUE"," AVENUE"," ROAD"," DRIVE"," BOULEVARD"," CRESCENT"," HIGHWAY"," PLACE"," PLAZA")
+ )
> # Apply renaming to parcels
> for (i in 1:nrow(streetRename)) {
+   short <- streetRename$short[i]
+   long <- streetRename$long[i]
+   dtParcels[,address:=gsub(paste0(short,"$"), long, address)] # standardize street type at end of string
+   dtParcels[,address:=gsub(paste0(short," "), paste0(long," "), address)] # standardize street type
+   dtPermits[,address:=gsub(paste0(short,"$"), long, address)] # standardize street type at end of string
+   dtPermits[,address:=gsub(paste0(short," "), paste0(long," "), address)] # standardize street type
+ }
> dtPermits[,address:=gsub(", Vancouver, BC","",address)] # remove city and province
> # delete last 7 characters (postal code) if present
> # detect a postal code of form " V#V #V#" at end of string
> # This failed dtPermits[,address:=gsub(" V[0-9][A-Z][0-9] [0-9][A-Z][0-9]$","",address)]
> dtPermits[,address:=gsub(" V[0-9][A-Z] [0-9][A-Z][0-9]$","",address)]
> 
> 
> print(head(dtParcels))
   civic_number     streetname tax_coord   site_id
         <char>         <char>    <char>    <char>
1:         4875     HEATHER ST  73015907 032529686
2:          375      E 33RD AV  73019575  EPS10489
3:         4763  COMMERCIAL ST  24472675  EPS11578
4:         4429      W 13TH AV  68302467 032545592
5:         3415 SEAFORTH DRIVE  69430049  EPS11591
6:         2552      E 11TH AV  66527160 032551827
                                                geo_point_2d
                                                      <char>
1: { "lon": -123.12209884815704, "lat": 49.242031082674288 }
2:   { "lon": -123.097486205344, "lat": 49.240837965447966 }
3:  { "lon": -123.0684260171443, "lat": 49.242064771116986 }
4:    { "lon": -123.2070648698195, "lat": 49.2613218519813 }
5: { "lon": -123.03197426086219, "lat": 49.253802339521435 }
6: { "lon": -123.05366607019535, "lat": 49.259827585051205 }
                         geometry                address
               <sfc_MULTIPOLYGON>                 <char>
1: MULTIPOLYGON (((-123.1234 4...    4875 HEATHER STREET
2: MULTIPOLYGON (((-123.0976 4...      375 E 33RD AVENUE
3: MULTIPOLYGON (((-123.0687 4... 4763 COMMERCIAL STREET
4: MULTIPOLYGON (((-123.2072 4...     4429 W 13TH AVENUE
5: MULTIPOLYGON (((-123.0322 4...    3415 SEAFORTH DRIVE
6: MULTIPOLYGON (((-123.0538 4...     2552 E 11TH AVENUE
> print("PP")
[1] "PP"
> print(head(dtPermits))
    permitnumber permitnumbercreateddate  issuedate permitelapseddays
          <char>                  <IDat>     <IDat>             <int>
1: DB-2016-02175              2016-09-02 2017-02-14               165
2: DB-2018-00356              2018-01-23 2018-02-06                14
3: BP-2017-05803              2017-11-09 2018-01-25                77
4: BP-2018-00904              2018-02-20 2020-01-03               682
5: BP-2017-05422              2017-10-18 2018-05-28               222
6: DB-2018-03761              2018-07-11 2018-08-29                49
   projectvalue            typeofwork              address
          <num>                <char>               <char>
1:       160000 Addition / Alteration 429 GRANVILLE STREET
2:       404200 Addition / Alteration     126 W 3RD AVENUE
3:       125000 Addition / Alteration      3668 W BROADWAY
4:       200000 Addition / Alteration  579 DUNSMUIR STREET
5:        70000 Addition / Alteration 608 W CORDOVA STREET
6:       120000 Addition / Alteration     120 W 3RD AVENUE
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      projectdescription
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <char>
1: High Density Housing / Commercial - Addition / Alteration - Exterior and interior alterations to provide tenant improvement for a new tenant in the existing Restaurant - Class 1 suite in this existing commercial building. Scope of work includes installation new sliding full height windows on east and north sides of the suite, a new kitchen canopy with a mechanical unit hanging from the ceiling and  exterior mechanical duct and kitchen exhaust through the lower roof located at the southwest. \r\n\r\nOK for DB and for new stacked glazed sliding panels with a 18"" modesty panel as per Howie Chow and Jason Olinek on Aug.11, 2016.\r\n\r\nOK for Kitchen exhaust location at the lower roof as per Jason Olinek on Dec. 15, 2016.\r\n\r\nOccupant Load = max 60 persons (50 seats + 10 staff)\r\n\r\nNotes Kitchen contains both Class 1 and Class 5 cooking operations:\r\n\r\nClass 1:\r\n1. Class 1 cooking operations (Grease-Laden Vapours).\r\n2. Commercial kitchen exhaust system to NFPA 96 (Type 1 hood).\r\n\r\nClass 5:\r\n1. Class 5 Cooking Operations (No Hood):  \r\n2. Appliances are less than or equal to 6 kW (Cooking procedures producing significant grease laden vapours, or significant heat or steam are not permitted from these appliances).                               \r\n\r\nBuilding Review Branch Note:\r\n- The suite must be separated by a fire separation with 2h FRR as per VBBL 3.3.1.1.(5) & 3.4.4.1. The architect to verify the suite separation to District Building Inspector.\r\n- A permanent sign with the occupant load should be posted in a conspicuous location.\r\n- Outdoor or sidewalk patio is NOT permitted unless an additional washroom is proposed.\r\n\r\nREVISION #1(Jul 27, 2017):\r\n1. Removed originally proposed storefront glazing.\r\n2. Reconfigured lighting layout.\r\n3. Interior changes at service counter & added an under counter freezer.\r\n4. Added 1h FRR wall around cooler.\r\n5. Updated seating layout.
2:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     Field Review - Addition / Alteration - #100 - 126 W 3rd Av\r\n\r\nTo provide interior and exterior alterations on the ground floor of this existing industrial building.\r\n\r\nScope of work: new non-load-bearing partition, new loading bay doors and new washrooms.\r\n\r\nOK for Field review per DBI I. Mackie Jan 23/2018\r\nOk for proposed exterior work on rear elevation as per Grace Jiang\r\n\r\nL2 - Lighting - Upgrade to incorporate Automatic Lighting Shutoff (per 9.4.1.1 of ASHRAE 90.1 - 2010).\r\n\r\nProcessed through CRC
3:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Field Review - Addition / Alteration - Interior alterations and change of use from Retail Store 'shell' (E) to Health Care Office (D) at 3668 West Broadway of this existing mixed-use commercial and residential building. \r\n\r\nScope of work includes: validating the shower adjacent to the handicapped washroom. \r\n\r\nScheduled Submitted by: \r\nA/B (Architectural) by Christopher P. R. Gowing, Architect, 604.484.8285 ext. 103.\r\nB (Mechanical) by Charles W. Powell, P.Eng., 604.595.4869\r\nB (Electrical) by Brennan Town, P.Eng., 604.516.9878\r\n\r\nOK for field review as per Howie Chow, November 9, 2017.\r\n\r\nNote: \r\n1) Storefront glazing is to remain clear and unobstructed. No translucent or opaque film, artwork, shelving, display case, curtains or similar elements are to be installed on or directly outside or inside of the approved glazing.
4:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 High Density Housing / Commercial - Addition / Alteration - Building Permit for DP-2017-00811 \r\nInterior alterations to address work without permit changes made pursuant prior development permit DE416911.\r\nProposed work includes restoration of fire separation at exit stair, validation of kitchen equipment layout and reconfiguration of the interior layout. \r\n\r\nBuilding Review Branch Notes:\r\nSee related BP-2018-00356 for exterior rooftop patio application. \r\n\r\n1. Class 2 and Class 4 Cooking Operation.\r\n2. Grease laden vapour shall not be generated by the Class 2 cooking equipment.\r\nPost a sign on the hood, ""Cooking causing grease-laden vapours is not allowed Exhaust system is designed for steam and heat removal only"".\r\n\r\nType II Hoods (Heat and Steam Removal Only) to be design, constructed, and installed in accordance with VBBL and referenced standards.\r\n\r\n3. Class 4 cooking operations (Grease-Laden Vapours).\r\n4. Commercial kitchen exhaust system to NFPA 96 (Type 1 Self-contained hood).
5:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Field Review - Addition / Alteration - 608 W Cordova\r\n\r\nInterior alterations to provide improvements for a new office tenant in this office (shell) at 608 W Cordova on the ground floor of this existing commercial building on this site.\r\n\r\nScope of work is to include partial demolition of existing partitions and to build new partitions.\r\n\r\nChange of use approved under DP-2017-00793, 2 Oct 2017\r\n\r\nOK for field review per W.Wong, October 18, 2017.\r\n\r\nNote: No Energy trigger required BOMA BEST building\r\n\r\nRevision #1- Storage room\r\n*Revise suite layout\r\n*Revise storage room and area\r\n*Reconfigure non-loadbearing partitions\r\n*Revise lighting layout\r\n*Submit ASHARE (L2 - Lighting upgrade to incorporate automatic lighting shutoff per (9.4.1.1 of ASHARE 90.1 - 2010) and Lighting Compliance
6:                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       Field Review - Addition / Alteration - Exterior alterations to replace existing 3' fabric awning with a new 1'-5"" faux wood awning band on the North and East elevations of this mixed-use (industrial and commercial) building.\r\n\r\nScope of Work:\r\n- construct new fixed projection and new exterior lights \r\n\r\nOK for field review as per Brad Marsh, July 11, 2018\r\n\r\nNote: \r\n1. OK for DB for exterior alterations as per Karen Campbell.\r\n2. Separate permit(s) will be required for new signage.\r\n\r\nLetter of Assurance Submitted:\r\nSchedule (A) Commitment by Owner & Professional by Michael Hungerford, Agent of 120 W 3rd Ave Properties Ltd. Partnership & Peter J. Mallen, Architect, 604.484.8285\r\nSchedule (B) Architectural by Peter J. Mallen, Architect, 604.484.8285\r\nSchedule (B) Structural by Robert Holding, P.Eng., 604.294.6662\r\nSchedule (D-1) Building Envelope by Peter J. Mallen, Architect, 604.484.8285\r\n\r\nEnergy Upgrade Exempted: Site/ External Alterations
                                          permitcategory
                                                  <char>
1:                                                      
2: Renovation - Commercial/ Mixed Use - Lower Complexity
3: Renovation - Commercial/ Mixed Use - Lower Complexity
4:                                                      
5: Renovation - Commercial/ Mixed Use - Lower Complexity
6: Renovation - Commercial/ Mixed Use - Lower Complexity
                                                        applicant
                                                           <char>
1: Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
2: Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
3: Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
4: Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
5: Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
6: Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
                                     applicantaddress              propertyuse
                                               <char>                   <char>
1: #300 - 7 East 6th Avenue\r\nVancouver, BC  V5T 1J3             Service Uses
2: #300 - 7 East 6th Avenue\r\nVancouver, BC  V5T 1J3             Service Uses
3: #300 - 7 East 6th Avenue\r\nVancouver, BC  V5T 1J3              Office Uses
4: #300 - 7 East 6th Avenue\r\nVancouver, BC  V5T 1J3             Service Uses
5: #300 - 7 East 6th Avenue\r\nVancouver, BC  V5T 1J3              Office Uses
6: #300 - 7 East 6th Avenue\r\nVancouver, BC  V5T 1J3 Office Uses,Service Uses
                             specificusecategory
                                          <char>
1:                          Restaurant - Class 1
2:                Production or Rehearsal Studio
3:                            Health Care Office
4:                    Neighbourhood Public House
5:                                General Office
6: General Office,Production or Rehearsal Studio
                  buildingcontractor
                              <char>
1: Pacific Solutions Contracting Ltd
2:                                  
3:                                  
4:                                  
5:           Mercury Contracting Ltd
6:        Mara Industries (2015) Ltd
                               buildingcontractoraddress issueyear
                                                  <char>     <int>
1:           1376 WILLIAM ST  \r\nVancouver, BC  V5L 2P5      2017
2:                                                            2018
3:                                                            2018
4:                                                            2020
5: 788 BEATTY ST  \r\nUnit 303\r\nVancouver, BC  V6B 2M1      2018
6:    1815 Paul's Place  \r\nQualicum Beach, BC  V9K 2S3      2018
     geolocalarea
           <char>
1:       Downtown
2: Mount Pleasant
3:      Kitsilano
4:       Downtown
5:       Downtown
6: Mount Pleasant
                                                                 geom yearmonth
                                                               <char>    <char>
1: {""coordinates"": [-123.1123788, 49.2862375], ""type"": ""Point""}   2017-02
2:  {""coordinates"": [-123.107197, 49.2683183], ""type"": ""Point""}   2018-02
3: {""coordinates"": [-123.1849691, 49.2640851], ""type"": ""Point""}   2018-01
4: {""coordinates"": [-123.1152237, 49.2829154], ""type"": ""Point""}   2020-01
5: {""coordinates"": [-123.1119964, 49.2853748], ""type"": ""Point""}   2018-05
6: {""coordinates"": [-123.1070745, 49.2680779], ""type"": ""Point""}   2018-08
               geo_point_2d
                     <char>
1: 49.2862375, -123.1123788
2:  49.2683183, -123.107197
3: 49.2640851, -123.1849691
4: 49.2829154, -123.1152237
5: 49.2853748, -123.1119964
6: 49.2680779, -123.1070745
                                                                 grouper
                                                                  <char>
1: 2017-02Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
2: 2018-02Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
3: 2018-01Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
4: 2020-01Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
5: 2018-05Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
6: 2018-08Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
        lat       lon groupDistance nGroup
      <num>     <num>         <num>  <int>
1: 49.28624 -123.1124     2110.9395      2
2: 49.26832 -123.1072            NA      1
3: 49.26409 -123.1850     3387.9698      2
4: 49.28292 -123.1152     4321.3303      2
5: 49.28537 -123.1120      754.4932      4
6: 49.26808 -123.1071      895.8116      3
                                                                                   group2
                                                                                   <char>
1: 2017-02Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.0.420218077488244
2:                  2018-02Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.
3: 2018-01Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.0.104522982845083
4: 2020-01Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.0.376459347549826
5: 2018-05Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.0.333352208370343
6: 2018-08Mallen Gowing Berzins Architecture Incorporated DBA: MGBA Inc.0.680323438253254
> dtMerge <- merge(dtParcels,dtPermits,by="address",all.y=TRUE)
> print(table(is.na(dtMerge$site_id))) # check how many permits did not find a matching parcel

FALSE  TRUE 
39053 17253 
> dtMerge[,maxMerge:=max(!is.na(site_id)),by=grouper]
> print(table(dtMerge$maxMerge)) # check how many permit groups had at least one successful merge

    0     1 
11384 44922 
> print(dtMerge[maxMerge==0,mean(propertyuse=="Dwelling Uses",na.rm=TRUE)]) # fraction of permits in groups with no successful merges that are dwelling uses
[1] 0.5526177
> print(dtMerge[maxMerge==1,mean(propertyuse=="Dwelling Uses",na.rm=TRUE)]) # fraction of permits in groups with no successful merges that are dwelling uses
[1] 0.6638173
> print(names(dtMerge))
 [1] "address"                   "civic_number"             
 [3] "streetname"                "tax_coord"                
 [5] "site_id"                   "geo_point_2d.x"           
 [7] "geometry"                  "permitnumber"             
 [9] "permitnumbercreateddate"   "issuedate"                
[11] "permitelapseddays"         "projectvalue"             
[13] "typeofwork"                "projectdescription"       
[15] "permitcategory"            "applicant"                
[17] "applicantaddress"          "propertyuse"              
[19] "specificusecategory"       "buildingcontractor"       
[21] "buildingcontractoraddress" "issueyear"                
[23] "geolocalarea"              "geom"                     
[25] "yearmonth"                 "geo_point_2d.y"           
[27] "grouper"                   "lat"                      
[29] "lon"                       "groupDistance"            
[31] "nGroup"                    "group2"                   
[33] "maxMerge"                 
> print(table(dtMerge[maxMerge==0 & propertyuse=="Dwelling Uses",specificusecategory]))

                                              1FD w/ Family Suite 
                                                                1 
                              2FD on Sites w/ Mult Principal Bldg 
                                                                1 
                                                        Apartment 
                                                                6 
                                              Apartment,Townhouse 
                                                                1 
                                                           Duplex 
                                                              214 
                                         Duplex w/Secondary Suite 
                                                               43 
                         Duplex w/Secondary Suite,Secondary Suite 
                                                                6 
                                            Duplex,Lock -off Unit 
                                                                1 
                                           Duplex,Secondary Suite 
                                                                1 
                                                    Dwelling Unit 
                                                              314 
                                       Dwelling Unit w/ Other Use 
                                                               11 
                     Dwelling Unit,Mixed-Use Residential Building 
                                                                1 
                                  Dwelling Unit,Multiple Dwelling 
                                                                1 
                                                Freehold Rowhouse 
                                                                1 
                                                           Infill 
                                                               10 
                                                    Infill Duplex 
                                                                1 
                                         Infill Multiple Dwelling 
                                                                1 
                                     Infill Single Detached House 
                                                               35 
        Infill Single Detached House,Multiple Conversion Dwelling 
                                                                2 
                                       Infill Two-Family Dwelling 
                                                                2 
                                                    Laneway House 
                                                             1572 
                                                   Micro Dwelling 
                                                                3 
                                   Mixed-Use Residential Building 
                                                                7 
                                     Multiple Conversion Dwelling 
                                                               51 
                                                Multiple Dwelling 
                                                             2432 
Multiple Dwelling,Residential Unit Associated w/ an Artist Studio 
                                                                1 
                                                   Not Applicable 
                                                                5 
                  Residential Unit Associated w/ an Artist Studio 
                                                                3 
                                        Residential/Business Unit 
                                                                1 
                                                    Rooming House 
                                                                3 
                                                  Secondary Suite 
                                                                1 
                              Seniors Supportive/Assisted Housing 
                                                                4 
                                            Single Detached House 
                                                             1215 
                                Single Detached House w/Sec Suite 
                                                              308 
          Single Detached House,Single Detached House w/Sec Suite 
                                                                1 
                                        Temporary Modular Housing 
                                                                6 
                                                        Townhouse 
                                                               25 
> print(table(dtMerge[maxMerge==1 & propertyuse=="Dwelling Uses",specificusecategory]))

                                                                                
                                                                              1 
                               1FD on Sites w/ More Than One Principal Building 
                                                                              1 
                                                            1FD w/ Family Suite 
                                                                              9 
                                            2FD on Sites w/ Mult Principal Bldg 
                                                                              2 
                                                                      Apartment 
                                                                             57 
                                                            Apartment,Townhouse 
                                                                              7 
                                                                         Duplex 
                                                                           1842 
                                                       Duplex w/Secondary Suite 
                                                                            652 
                                        Duplex w/Secondary Suite,Lock -off Unit 
                                                                              8 
                                       Duplex w/Secondary Suite,Secondary Suite 
                                                                            182 
                 Duplex w/Secondary Suite,Secondary Suite,Single Detached House 
                                                                              1 
                                                                  Duplex,Infill 
                                                                              1 
                                                          Duplex,Lock -off Unit 
                                                                             29 
                                          Duplex,Lock -off Unit,Secondary Suite 
                                                                              1 
                                            Duplex,Multiple Conversion Dwelling 
                                                                              1 
                                                   Duplex,Single Detached House 
                                                                              5 
                                                                  Dwelling Unit 
                                                                            644 
                                                     Dwelling Unit w/ Other Use 
                                                                              4 
                                            Dwelling Unit,Single Detached House 
                                                                              3 
                                                              Freehold Rowhouse 
                                                                              9 
                                                              Housekeeping Unit 
                                                                              2 
                                                                         Infill 
                                                                             25 
                                                                  Infill Duplex 
                                                                              5 
                                                       Infill Multiple Dwelling 
                                                                              6 
                                                   Infill Single Detached House 
                                                                            172 
                      Infill Single Detached House,Multiple Conversion Dwelling 
                                                                              3 
Infill Single Detached House,Multiple Conversion Dwelling,Single Detached House 
                                                                              6 
                             Infill Single Detached House,Single Detached House 
                                                                              2 
                 Infill Single Detached House,Single Detached House w/Sec Suite 
                                                                              2 
                                                     Infill Two-Family Dwelling 
                                                                             18 
                   Infill Two-Family Dwelling,Single Detached House w/Sec Suite 
                                                                              1 
                                            Infill,Infill Single Detached House 
                                                                              1 
                                            Infill,Multiple Conversion Dwelling 
                                                                              1 
                      Infill,Multiple Conversion Dwelling,Single Detached House 
                                                                              2 
                                 Infill,Multiple Dwelling,Single Detached House 
                                                                              2 
                                                   Infill,Single Detached House 
                                                                              1 
                                                                  Laneway House 
                                                                           2477 
                                            Laneway House,Single Detached House 
                                                                              2 
                                                                 Micro Dwelling 
                                                                             11 
                                                 Mixed-Use Residential Building 
                                                                             32 
                                         Multiple Conv Dwelling w/ Family Suite 
                                                                              1 
                                            Multiple Conv Dwelling w/ Sec Suite 
                                                                              1 
                                                   Multiple Conversion Dwelling 
                                                                            325 
                                 Multiple Conversion Dwelling,Multiple Dwelling 
                                                                              2 
                                    Multiple Conversion Dwelling,Not Applicable 
                                                                              1 
                             Multiple Conversion Dwelling,Single Detached House 
                                                                              4 
                 Multiple Conversion Dwelling,Single Detached House w/Sec Suite 
                                                                              1 
                                                              Multiple Dwelling 
                                                                           5133 
              Multiple Dwelling,Residential Unit Associated w/ an Artist Studio 
                                                                              1 
                                                Multiple Dwelling,Rooming House 
                                                                              1 
                                        Multiple Dwelling,Single Detached House 
                                                                              1 
                                    Multiple Dwelling,Temporary Modular Housing 
                                                                              3 
                                                                 Not Applicable 
                                                                             72 
                                           Not Applicable,Single Detached House 
                                                                              1 
                                             Principal Dwelling Unit w/Lock Off 
                                                                              8 
                                Residential Unit Associated w/ an Artist Studio 
                                                                              1 
                                                      Residential/Business Unit 
                                                                              1 
                                                                  Rooming House 
                                                                             44 
                                                                Secondary Suite 
                                                                              4 
                              Secondary Suite,Single Detached House w/Sec Suite 
                                                                              1 
                                            Seniors Supportive/Assisted Housing 
                                                                             36 
                                                          Single Detached House 
                                                                          12275 
                                              Single Detached House w/Sec Suite 
                                                                           5596 
                        Single Detached House,Single Detached House w/Sec Suite 
                                                                             34 
                                                                  Sleeping Unit 
                                                                              3 
                                                      Temporary Modular Housing 
                                                                             20 
                                                                      Townhouse 
                                                                             20 
> print(table(dtMerge[maxMerge==0 & propertyuse=="Dwelling Uses",mean(grepl("uplex",specificusecategory))]))

0.0422826259736131 
                 1 
> print(table(dtMerge[maxMerge==1 & propertyuse=="Dwelling Uses",mean(grepl("uplex",specificusecategory))]))

0.0914486921529175 
                 1 
> print(table(dtMerge[maxMerge==0 & propertyuse=="Dwelling Uses",mean(grepl("Single Detached",specificusecategory))]))

0.248132252424098 
                1 
> print(table(dtMerge[maxMerge==1 & propertyuse=="Dwelling Uses",mean(grepl("Single Detached",specificusecategory))]))

0.607511737089202 
                1 
> # Note: looks like no selection!
> q("no")
> proc.time()
   user  system elapsed 
  7.021   1.419   4.982 
